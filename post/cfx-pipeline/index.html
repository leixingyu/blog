<!DOCTYPE html>
<html lang=en>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  <meta name="google-site-verification" content="JbZa4ImuZ4DDxP3Xfget7xyU27AAmp0zaRWteLcT3Wo" />
  
  
  <title>CFX Cloth Pipeline | Tech Art Learning</title><meta name="robots" content="noindex">
  <meta name="description" content="Me and CFX Dynamics are the coolest thing ever, you place some geo in the scene, put in some parameters, and the machine will handle the rest. When I started learning dynamics, I thought why do we ev">
<meta property="og:type" content="article">
<meta property="og:title" content="CFX Cloth Pipeline">
<meta property="og:url" content="http://xingyuleicom/post/cfx-pipeline/index.html">
<meta property="og:site_name" content="Tech Art Learning">
<meta property="og:description" content="Me and CFX Dynamics are the coolest thing ever, you place some geo in the scene, put in some parameters, and the machine will handle the rest. When I started learning dynamics, I thought why do we ev">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-08-21T04:00:00.000Z">
<meta property="article:modified_time" content="2021-09-03T03:25:26.625Z">
<meta property="article:author" content="Xingyu Lei">
<meta property="article:tag" content="cfx">
<meta name="twitter:card" content="summary">
  <!-- Canonical links -->
  <link rel="canonical" href="http://xingyuleicom/post/cfx-pipeline/index.html">
  
    <link rel="alternate" href="/atom.xml" title="Tech Art Learning" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
  
<meta name="generator" content="Hexo 5.3.0"></head>


<body class="main-center theme-blue" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="https://github.com/leixingyu" target="_blank">
          <img class="img-circle img-rotate" src="/images/avatar.png" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">Xingyu Lei</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md">Technical Artist</h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> California, US</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="Search" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="Type something..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav ">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">Home</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-about">
          <a href="/about">
            
            <i class="icon icon-cup-fill"></i>
            
            <span class="menu-title">About</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-repository">
          <a href="/repository">
            
            <i class="icon icon-project"></i>
            
            <span class="menu-title">Repository</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">Archives</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/leixingyu" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      
  <div class="widget">
    <h3 class="widget-title">Categories</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/learning-log/">learning log</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/maya-python-api/">maya python api</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/model-view-programming/">model view programming</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/tech-summary/">tech summary</a><span class="category-list-count">12</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget-body tagcloud">
      <a href="/tags/c/" style="font-size: 13.5px;">c#</a> <a href="/tags/git/" style="font-size: 13px;">git</a> <a href="/tags/maya/" style="font-size: 13.5px;">maya</a> <a href="/tags/pyqt/" style="font-size: 14px;">pyqt</a> <a href="/tags/python/" style="font-size: 14px;">python</a> <a href="/tags/style/" style="font-size: 13.5px;">style</a> <a href="/tags/template/" style="font-size: 13.75px;">template</a> <a href="/tags/unity/" style="font-size: 13.25px;">unity</a> <a href="/tags/version-control/" style="font-size: 13px;">version control</a>
    </div>
  </div>

    
      
  <div class="widget">
    <h3 class="widget-title">Archive</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>


    
  </div>
</aside>

  
  
<main class="main" role="main">
  <div class="content">
  <article id="post-cfx-pipeline" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      CFX Cloth Pipeline
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/post/cfx-pipeline/" class="article-date">
	  <time datetime="2021-08-21T04:00:00.000Z" itemprop="datePublished">2021-08-21</time>
	</a>
</span>
        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    
  </span>

        
  <span class="article-tag">
    <i class="icon icon-tags"></i>
	
  </span>


        

        <span class="post-comment"><i class="icon icon-comment"></i> <a href="/post/cfx-pipeline/#comments" class="article-comment-link">Comments</a></span>
        
	
	
		<span class="post-readcount hidden-xs" itemprop="timeRequired">Read Count: 8(minutes)</span>
	

      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <h3 id="me-and-cfx"><a class="markdownIt-Anchor" href="#me-and-cfx"></a> Me and CFX</h3>
<p>Dynamics are the coolest thing ever, you place some geo in the scene, put in some parameters, and<br />
the machine will handle the rest. When I started learning dynamics, I thought why do we even<br />
need artist, the algorithm seems to handle everything nicely.</p>
<p>Throughout the learning process, I feel more comfortable but also more confused after dividing into nCloth and Qualoth in Maya.<br />
I feel lack of control. The result out of the box is very convincing for me at that time,<br />
I have a hard time figuring out how to improve the look and little idea on how anyone would spend<br />
their entire career on something that is pre-determined by algorithms.</p>
<p>My logic is this: it’s difficult to have artistic control by adjusting physical parameters in the solver or cloth setting.<br />
And after each adjustment, you would wait for the solver which takes a long time.<br />
So, it is safe to say the most time-consuming part of the process is waiting on it.</p>
<p>I then started to mess around with Marvelous Designer, creating and stitching patterns to make a virtual<br />
clothes. The real-time simulation in Marvelous is already very accurate to me, which added my doubt on<br />
what do cfx artist actually do. Later on I found out that grooming or designing cloth is mostly handled by<br />
modelers in character art/design department. Lesser work for cfx.</p>
<p>Finally, I begin my professional cfx career, stayed a lot of overtime to meet delivery deadlines, the experience is quite insane.</p>
<hr />
<h3 id="overview"><a class="markdownIt-Anchor" href="#overview"></a> Overview</h3>
<p>Below, I summarized the high level overview of the cfx pipeline, this is based off limited knowledge in the<br />
industry, but it is logically correct.</p>
<h4 id="pre-cfx-stage"><a class="markdownIt-Anchor" href="#pre-cfx-stage"></a> Pre CFX Stage</h4>
<ol>
<li>
<p>Character team creates the character model: including costume and hair</p>
</li>
<li>
<p>Rigging team rig the character model:</p>
<ul>
<li>the rig can be easily extracted to joint and separated meshes (body, cloth and hair)</li>
<li>cloth is usually wrapped around the character body mesh</li>
<li>hair is usually static curves on character’s scalp</li>
</ul>
</li>
<li>
<p>Animation team finish the body animation</p>
</li>
<li>
<p>A pre-process step where joint animation is extracted, this is later used for T-pose blending</p>
</li>
</ol>
<h4 id="cfx-stage"><a class="markdownIt-Anchor" href="#cfx-stage"></a> CFX Stage</h4>
<ol>
<li>Cloth/Hair Rig Building</li>
<li>Cloth/Hair Sim</li>
</ol>
<h4 id="post-cfx-stage"><a class="markdownIt-Anchor" href="#post-cfx-stage"></a> Post CFX Stage</h4>
<p>Everything is sent to Scene Assembly department, including:</p>
<ul>
<li>Final body mesh is exported as cache (Note: character joint animation<br />
must remain the same as animation but body mesh can be modified to avoid penetration to cloth)</li>
<li>Clothes final cache</li>
<li>Hair final curves</li>
</ul>
<hr />
<h3 id="cloth-rig-building"><a class="markdownIt-Anchor" href="#cloth-rig-building"></a> Cloth Rig Building</h3>
<p>Each character has its own set of costumes, in different scenes and sequences. Sim is performed on<br />
a sequence level (so it is important to keep sim continuity), same as animation. And cfx artists would bring in the<br />
corresponding cloth rig over and over, so the rig building part is very important.</p>
<p>As the upstream dependency for cloth sim, the better cloth rig created, the easier<br />
down the line for other cfx artists to sim.</p>
<p>The rig building contains the following part:</p>
<h4 id="set-up-lods"><a class="markdownIt-Anchor" href="#set-up-lods"></a> Set Up LODs</h4>
<p>The full resolution geo that character team contains millions vertices/faces which is used for rendering.<br />
It is generally not a good idea to sim the full rez geo as the sim would take forever. Ideally,<br />
we want higher resolution geo, as the crease is more detail and collisions are more accurate.</p>
<p>The first step is for cfx artist to create low/mid/high rez three levels of LODs to represent the original clothes.<br />
The same goes for character mesh, low/mid/high rez LODs for setting up collision purpose.</p>
<p>Common techniques:</p>
<ul>
<li>
<p>give more poly count to higher deformed area.</p>
</li>
<li>
<p>single layer mesh for simulation.</p>
</li>
<li>
<p>re-use meshes from previous project with similar clothes design</p>
</li>
</ul>
<h4 id="set-up-parameters"><a class="markdownIt-Anchor" href="#set-up-parameters"></a> Set Up Parameters</h4>
<p>the rig is being built up with basic settings, the artists would then decide based on the complexity<br />
of the cloth (material, length, layers) to adjust cloth settings such as density, compress/stretch, drag and so on.<br />
there’s also solver settings, as solver will get imported to seperate shots, parameters like max iteration and sub steps are important.</p>
<p>also include: adding different type of constraints, adjusting collider attribute and more,<br />
later may include more advance use such as wind/turbulance.</p>
<p>general technique: based on the material, parameters can be re-used</p>
<ol start="3">
<li>test and iterate</li>
</ol>
<p>the master cloth rig is set up for each character and each costume, then comes the basic testing:</p>
<p>animation will provide a walk cycle to test the cloth sim result. the cloth rig will be used on this walk<br />
cycle animation. lead and sups will make feedbacks and artists will adjust the parameters. this is a ongoing<br />
process: as later on during production, the rig will be exposed to real animation and probably other artist<br />
will point out ways to improve.</p>
<h3 id="cloth-simulation"><a class="markdownIt-Anchor" href="#cloth-simulation"></a> Cloth Simulation</h3>
<h4 id="run-sim-evaluation-and-adjust"><a class="markdownIt-Anchor" href="#run-sim-evaluation-and-adjust"></a> run sim, evaluation and adjust</h4>
<p>evaluate character animation and see if body penetration is happening (arm pit, arm penetrating leg)</p>
<p>each sim can vary, some sim could be fast within a hour with good result out of the box, some sim<br />
may take a whole night and still be jittering and completely useless. it could be cloth rig<br />
not optimal</p>
<p>to fix things, you need to consider is it worth it to change parameter and re-sim or the current result<br />
is good to clean up. re-sim usually the same process all over again, jittering can be fixed by adjusting<br />
sub step/max iteration. sometimes even though body aren’t penetrating, the space between them aren’t enough<br />
for cloth to settle down.</p>
<p>advance:<br />
blending, paint map<br />
scene specific parameters, constraint may be used</p>
<h4 id="clean-up"><a class="markdownIt-Anchor" href="#clean-up"></a> clean up</h4>
<p>small penetration, can be pull out, or push down skin to hide</p>
<p>craze creases can be smoothed</p>
<p>crazy movement can be toned down by blending back to skinned cloth with animation</p>
<p>submit and review</p>
<h3 id="pipeline"><a class="markdownIt-Anchor" href="#pipeline"></a> pipeline</h3>
<p>workflow</p>
<p>the cfx pipeline can be divided into 3 stages</p>
<h4 id="pre-processing-animation-aka-t-pose-tranisition"><a class="markdownIt-Anchor" href="#pre-processing-animation-aka-t-pose-tranisition"></a> Pre-processing animation aka. t pose tranisition</h4>
<p>the reason for this is: character in t pose or neutral pose have no intersecting body part, thus gives the most relaxed cloth result</p>
<p>process</p>
<p>alembic/pc2 point</p>
<ol>
<li>
<p>the character starts at t pose and the cloth is also in the t pose relaxed pose</p>
</li>
<li>
<p>the character transition to start of the animation, this is the animation transitioning, the cloth will slowly move along<br />
and begins to settle as gravity kick in</p>
</li>
<li>
<p>the animation start frame then holds for a couple more frames, this is for letting cloth to settle completely</p>
</li>
</ol>
<h4 id="sim"><a class="markdownIt-Anchor" href="#sim"></a> sim</h4>
<p>the pre processed animation cache and the cloth rig both get imported in the second stage, the file contains<br />
all the necessary cloth setup (cloth, collider, constraint, dynamics etc) which is the latest from the<br />
master cloth rig. everything is kept very clean so that the sim would run smoother.</p>
<p>when the result is bad, adjust setup and re-run, this should take 30 minutes or so.</p>
<h4 id="clean-up-2"><a class="markdownIt-Anchor" href="#clean-up-2"></a> clean up</h4>
<p>the result sim cache gets exported to the next stage, the cloth reads cache and the original full rez<br />
clothes is wrapped onto the cloth. at this point, the simulation is acceptable and thus no re-sim is needed</p>
<p>the wrapping is important as it’s basically serving as a upscale resolution purpose. the algorithm is essential<br />
as wrapping evaluation happens everyframe so it affects the playback speed.</p>
<p>clean up tools mostly are related to deformer that could affect the shape of the cloth (mostly smooth)<br />
also a tool that proves to be helpful is that a lot of the cases the cloth looks slight jitter and unstabled (due to multiple layers)<br />
this can be solved by locking a frame of the cloth sim and then wrap that result on to the other frames,</p>
<h4 id="more-tool-ideas"><a class="markdownIt-Anchor" href="#more-tool-ideas"></a> more tool ideas</h4>
<p>sim in batch mode: since we always need the sim to go through to see the result, running the simulation without having<br />
the gui open would speed up the process. if we want to record the playblast, remeber to add a snapshot function<br />
in the batch script to capture everyframe</p>
<p>qualoth io: use for import/export qualoth settings that worked well with your previous scene, this could be<br />
shared to other cfx artist, it can also be useful just for inspection from leads not needing to opening<br />
your file and find all the nodes</p>
<!-- flag of hidden posts -->
      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
  
    
    <li class="post-copyright-link hidden-xs">
      <strong>Shared Link：</strong>
      <a href="http://xingyuleicom/post/cfx-pipeline/" title="CFX Cloth Pipeline" target="_blank" rel="external">http://xingyuleicom/post/cfx-pipeline/</a>
    </li>
    
	
    <li class="post-copyright-license">
      <strong>Copyright Notice： </strong> This post is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/deed.en" target="_blank" rel="external">Creative Commons Attribution 4.0 International License </a>. Please give appropriate credit.
    </li>
	
  </ul>
</blockquote>



<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/leixingyu" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.png" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/leixingyu" target="_blank"><span class="text-dark">Xingyu Lei</span><small class="ml-1x">Technical Artist</small></a></h3>
        <div>Problem solver; Game and film enthusiast;</div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    
  <section id="comments">
  	
  </section>


  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  
  
  <div class="bar-right">
    
  </div>
  </div>
</nav>
  


</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/leixingyu" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        &copy; 2021 Xingyu Lei
        
        <!-- <div class="publishby">
        	Theme by <a href="https://github.com/cofess" target="_blank"> cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.
        </div> -->
    </div>
	
</footer>
  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>






   




   






</body>
</html>