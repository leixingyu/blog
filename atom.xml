<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Tech Art Learning</title>
  
  
  <link href="https://www.xingyulei.com/atom.xml" rel="self"/>
  
  <link href="https://www.xingyulei.com/"/>
  <updated>2023-11-03T03:42:22.359Z</updated>
  <id>https://www.xingyulei.com/</id>
  
  <author>
    <name>Xingyu Lei</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Write Metadata in Unreal: Blueprint-Driven Workflows</title>
    <link href="https://www.xingyulei.com/post/ue-metadata/"/>
    <id>https://www.xingyulei.com/post/ue-metadata/</id>
    <published>2023-10-13T07:00:00.000Z</published>
    <updated>2023-11-03T03:42:22.359Z</updated>
    
    <content type="html"><![CDATA[<h2 id="introduction"><a class="markdownIt-Anchor" href="#introduction"></a> Introduction</h2><p>In the world of digital workflows, handling metadata is a common practice.In most CG pipelines, metadata is stored in external text files,allowing tools to easily read and write data. But when dealing with Unreal Engine,which operates predominantly in real-time,the challenge arises to access metadata through Blueprint scripting,requiring the metadata to be in Unreal’s native format.</p><p>After some research, I came across a proposal from a staff member in the UnrealDeveloper Community. In this article,we’ll explore the different methods from the proposal anddiscuss the approach I’ve settled on.</p><h2 id="data-table"><a class="markdownIt-Anchor" href="#data-table"></a> Data Table</h2><p>Data tables offer a flexible way to structure data.However, it’s important to note that you need to define the data structurein advance to use them effectively</p><p>To have a working data table we need to first create adata structure where each entry of the data table will conform to.</p><p><img src="https://i.imgur.com/E3CUgEy.png" alt="data table and data structure" />Data Table (left) with corresponding Data Structure (right)</p><h3 id="how-to-read-data-table"><a class="markdownIt-Anchor" href="#how-to-read-data-table"></a> How to Read Data Table</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unreal</span><br><span class="line"></span><br><span class="line">dt_path = <span class="string">r&#x27;/Game/Cinematics/Metadata/DT_TestMetadata.DT_TestMetadata&#x27;</span></span><br><span class="line"></span><br><span class="line">dt = unreal.EditorAssetLibrary.find_asset_data(dt_path).get_asset()</span><br><span class="line"></span><br><span class="line">col_name = <span class="string">&quot;Version&quot;</span>    </span><br><span class="line">row_names = unreal.DataTableFunctionLibrary.get_data_table_row_names(dt)</span><br><span class="line">positions = unreal.DataTableFunctionLibrary.get_data_table_column_as_string(dt, col_name)</span><br><span class="line"><span class="keyword">for</span> idx, col <span class="keyword">in</span> <span class="built_in">enumerate</span>(positions):</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;row_names[idx]&#125;</span> - <span class="subst">&#123;col_name&#125;</span>: <span class="subst">&#123;col&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># entry1 - Version: 2</span></span><br><span class="line"><span class="comment"># entry2 - Version: 0</span></span><br></pre></td></tr></table></figure><h3 id="how-to-write-data-table"><a class="markdownIt-Anchor" href="#how-to-write-data-table"></a> How to Write Data Table</h3><p>It seems like data tables are ready-only at first, as there are only <code>get_data</code> function sets:<a href="https://forums.unrealengine.com/t/set-data-table-row/85844">https://forums.unrealengine.com/t/set-data-table-row/85844</a></p><p>However, there are in fact a way to write to data table, and that is with the use of.csv or .json.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">unreal.DataTableFunctionLibrary.fill_data_table_from_json_file(data_table, json_file_path, data_structure)</span><br><span class="line">unreal.EditorAssetLibrary.save_loaded_asset(data_table, <span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>I won’t go into how to update .csv or .json files, but do note that the formatting ofthe text file is important, and you can get a reference ofwhat the file would look at by simply export out the data table with some test data like so:</p><p><img src="https://i.imgur.com/2eFGgas.png" alt="export option" /></p><h2 id="metadata"><a class="markdownIt-Anchor" href="#metadata"></a> Metadata</h2><p>To access metadat for each asset, you can do a right-click “Asset Actions”, “Show Metadata”.</p><p><img src="https://i.imgur.com/OhmFOSY.png" alt="asset action" /></p><p>This is quite handy since, based on our need, it can be bound to an asset.</p><p>And if we want to separate the binding between the asset and the data,we can also do so by creatingan empty blueprint asset and use it as a central container to store metadata.</p><p>The limitation however is that all the values are string type.</p><h3 id="how-to-read-metadata"><a class="markdownIt-Anchor" href="#how-to-read-metadata"></a> How to Read Metadata</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unreal</span><br><span class="line"></span><br><span class="line">u_asset_path = <span class="string">r&#x27;/Game/LevelPrototyping/Meshes/SM_ChamferCube.SM_ChamferCube&#x27;</span></span><br><span class="line">asset = unreal.EditorAssetLibrary.find_asset_data(u_asset_path).get_asset()</span><br><span class="line"></span><br><span class="line"><span class="built_in">map</span> = unreal.EditorAssetLibrary.get_metadata_tag_values(asset)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">map</span>)</span><br><span class="line"><span class="comment"># &#123;&quot;version&quot;: &quot;4&quot;&#125;</span></span><br><span class="line"></span><br><span class="line">value = unreal.EditorAssetLibrary.get_metadata_tag(asset, <span class="string">&quot;version&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(value)</span><br><span class="line"><span class="comment"># 4</span></span><br></pre></td></tr></table></figure><p><img src="https://i.imgur.com/vJ4P1H2.png" alt="show metadata" /></p><h3 id="how-to-write-metadata"><a class="markdownIt-Anchor" href="#how-to-write-metadata"></a> How to Write Metadata</h3><p>We can also easily set and remove the metadata tag and values like so.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">unreal.EditorAssetLibrary.set_metadata_tag(asset, <span class="string">&quot;version&quot;</span>, <span class="string">&quot;4&quot;</span>)</span><br><span class="line">unreal.EditorAssetLibrary.save_asset(u_asset_path)</span><br><span class="line"></span><br><span class="line">unreal.EditorAssetLibrary.remove_metadata_tag(asset, <span class="string">&quot;version&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="blueprint-variable"><a class="markdownIt-Anchor" href="#blueprint-variable"></a> Blueprint Variable</h2><p>And lastly, I want to introduce the approach I ended up with:map variable in a custom blueprint asset.</p><p>We first create a Blueprint asset using the basic Object class, and then add ourcustom ‘Version’ variable as a string: integer mapthis is basically equivalent to:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;Version&quot;</span>: &#123;<span class="built_in">str</span>: <span class="built_in">int</span>&#125;</span><br></pre></td></tr></table></figure><p><img src="https://i.imgur.com/zYKf2l8.png" alt="variable-1" /></p><p><img src="https://i.imgur.com/645AMpd.png" alt="variable-2" /></p><p>Through scripting, we first need to get the default class object of the blueprint,which can be achieved like so:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unreal</span><br><span class="line"></span><br><span class="line">u_bp_path = <span class="string">r&#x27;/asset_path&#x27;</span></span><br><span class="line">u_bp = unreal.EditorAssetLibrary.find_asset_data(u_bp_path).get_asset()</span><br><span class="line"></span><br><span class="line"><span class="comment"># generated class</span></span><br><span class="line">u_bp_generated = unreal.load_object(<span class="literal">None</span>, u_bp.generated_class().get_path_name())</span><br><span class="line"></span><br><span class="line"><span class="comment"># dco</span></span><br><span class="line">u_bp_dco = unreal.get_default_object(u_bp_generated)</span><br></pre></td></tr></table></figure><p>The advantage here lies in having a single blueprint asset capable of storingnumerous variables, each natively typed to Unreal.Nevertheless, I haven’t yet attempted to create variables solely through code.</p><h3 id="how-to-read-blueprint-variable"><a class="markdownIt-Anchor" href="#how-to-read-blueprint-variable"></a> How to Read Blueprint Variable</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_version</span>(<span class="params">dco, name</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        version = dco.get_editor_property(<span class="string">&#x27;version&#x27;</span>)[name]</span><br><span class="line">    <span class="keyword">except</span> KeyError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;no &#123;&#125; key&#x27;</span>.<span class="built_in">format</span>(name))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> version</span><br></pre></td></tr></table></figure><h3 id="how-to-write-blueprint-variable"><a class="markdownIt-Anchor" href="#how-to-write-blueprint-variable"></a> How to Write Blueprint Variable</h3><p>Note that we use the <code>get_editor_property()</code> to set the metadata</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">set_version</span>(<span class="params">dco, name, version</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        u_bp_dco.get_editor_property(<span class="string">&#x27;version&#x27;</span>)[name] = version</span><br><span class="line">    <span class="keyword">except</span> TypeError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;TypeError: &#123;&#125; of &#123;&#125; incorrect, &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">type</span>(version), version, e))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    unreal.EditorAssetLibrary.save_asset(bp_path)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure><h3 id="example"><a class="markdownIt-Anchor" href="#example"></a> Example</h3><p>Since, this approach is the one I have experimented the furthest along,here’s an example on how I access it in another Blueprint:</p><p><img src="https://i.imgur.com/8FhwmLA.png" alt="bp" /></p><p>Another way is to use ‘Get Class Default Object’ and ‘Cast To BP Test Metadata’ whichreturn ‘As BP Test Metadata’ and can then access the “Version” variable.</p><h2 id="references"><a class="markdownIt-Anchor" href="#references"></a> References</h2><p><a href="https://forums.unrealengine.com/t/how-to-store-text-data-with-python/688813">Unreal Forum - How to store text data with Python?</a></p><p><a href="https://forums.unrealengine.com/t/reimport-datatable-csv-with-python/567768">Unreal Forum - Reimport DataTable(csv) with python</a></p><p><a href="https://forums.unrealengine.com/t/reading-a-datatables-values-with-python/232300">Unreal Forum - Reading a DataTable’s Values with Python</a></p>]]></content>
    
    
    <summary type="html">Explore the seamless integration of metadata in Unreal Engine, and learn how to access and utilize native metadata within Blueprint-driven workflows. Unleash the full potential of Unreal Engine with this in-depth guide.</summary>
    
    
    
    <category term="learning log" scheme="https://www.xingyulei.com/categories/learning-log/"/>
    
    
    <category term="unreal" scheme="https://www.xingyulei.com/tags/unreal/"/>
    
    <category term="python" scheme="https://www.xingyulei.com/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>Customize Windows 10/11 Right-click Context Menu</title>
    <link href="https://www.xingyulei.com/post/py-win-contextmenu/"/>
    <id>https://www.xingyulei.com/post/py-win-contextmenu/</id>
    <published>2023-08-29T07:00:00.000Z</published>
    <updated>2023-09-02T17:57:40.751Z</updated>
    
    <content type="html"><![CDATA[<h2 id="introduction"><a class="markdownIt-Anchor" href="#introduction"></a> Introduction</h2><p>It’s been a while, today we have a pretty awesome content to explorethat is how we can create the right-click context menu in Windows.</p><p>I found that there’s not a lot of comprehensive and up-to-date tutorial onthis subject for tech artists, but this would be a really powerful tool tospeed up any types of workflow that involves going into Windows Explorer.(for example, right-click on a file and have a shortcut to get its perforce depot info)</p><p>And the best thing is: it’s super easy to follow, certainly much easier than learning how to create a context menu in Qt.</p><p><img src="https://i.imgur.com/YGnh1VC.gif" alt="result" /></p><h2 id="registry-setup"><a class="markdownIt-Anchor" href="#registry-setup"></a> Registry Setup</h2><p>Everything regards to the Windows context menu setup is donewithin the Windows Registry Editor.</p><h3 id="hierarchy"><a class="markdownIt-Anchor" href="#hierarchy"></a> Hierarchy</h3><p>First I’m gonna do an example of manual implementation.</p><ol><li><p>we’ll want to navigate to this path for now: <code>HKEY_CURRENT_USER\Software\Classes\directory\Background\shell</code> (we’ll explain this later <a href="#target-type">here</a>)</p><ul><li>right-click on the ‘Background’ key/folder and create a new ‘key’ named ‘shell’ if there isn’t one already</li></ul></li><li><p>create a key under ‘shell’ (I named mine ‘test_menu’) and then create a key under it called ‘command’</p></li></ol><p><img src="https://i.imgur.com/ENk9JDP.png" alt="test menu" /></p><h3 id="field"><a class="markdownIt-Anchor" href="#field"></a> Field</h3><p>Next we’ll want to modify the field of those keys, in the menu item key(in my case the ‘test_menu’) there are some optional fields we can add customizethe appearance of our menu item.</p><p>The following are some optional String Field:</p><p>(To add field, right-click on the right panel, ‘New’ - ‘String Value’)</p><ul><li>MUIVerb: The display name of the menu item, if this is not set, the name will defaultto the key name (i.e. “test_menu” in our case)</li><li>Icon: For displaying icon, the data should be set as the icon path, common format for the iconsare .ico and .dll</li><li>Position: changes the location of the menu item, e.g. “Top”, “Bottom”</li></ul><p><img src="https://i.imgur.com/wJxCBvL.png" alt="test menu field" /></p><p><img src="https://i.imgur.com/0AxLphb.png" alt="result" /></p><h2 id="setting-up-command"><a class="markdownIt-Anchor" href="#setting-up-command"></a> Setting up Command</h2><p>Finally, we’ll want to modify the command key’s field, so it can actually performcustom operations.</p><p>Go to the {Default} and edit the Data to whatever operation we would like to performwhen clicking this menu item. The syntax would be an execution command similarto ones we would put in command prompt or a .bat file.</p><h3 id="running-python-script"><a class="markdownIt-Anchor" href="#running-python-script"></a> Running Python Script</h3><p>Here’s an example to run python script:</p><p>In the Data section we would put: <code>&quot;path to python.exe&quot; &quot;path to python script.py&quot;</code></p><h3 id="passing-argument"><a class="markdownIt-Anchor" href="#passing-argument"></a> Passing Argument</h3><p>In order to pass in arguments, such as<br />the directory or the file where the menu was initiated.</p><p>We add <code>%v</code> for directory and <code>%1</code> for file path at the end of the command Data:</p><ul><li>e.g. <code>&quot;D:/python39/python.exe&quot; &quot;D:/p4clipboard.py&quot; &quot;%1&quot;</code></li><li>be aware of the slashes</li><li>if you would like to debug your python script and not make it close immediately after execution simplyadd <code>-i</code> flag after the <code>&quot;python.exe&quot;</code></li></ul><p>And within the <code>p4clipboard.py</code> file, we can parse the argument passed in as such:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># converts the selected file to its perforce depot path and add to clipboard</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> p4Util  <span class="comment"># this is a mock p4 module</span></span><br><span class="line"><span class="keyword">import</span> winUtil  <span class="comment"># also a mock module</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">   selected_file = sys.argv[<span class="number">1</span>]</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">with</span> p4Util.connect():</span><br><span class="line">       p4_path = p4Util.get_depot_path(selected_file)</span><br><span class="line">       winUtil.copy_to_clip(p4_path)</span><br></pre></td></tr></table></figure><h2 id="python-registry-automation"><a class="markdownIt-Anchor" href="#python-registry-automation"></a> Python Registry Automation</h2><p>The above examples are very cool, but requires a lot of manual set up, we canleverage Python to set up the registry entries for us.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># example from: https://github.com/seddie95/folder_organizer/blob/master/make_key.py</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> winreg <span class="keyword">as</span> reg</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">python_exe = sys.executable</span><br><span class="line">script_path = <span class="string">r&quot;D:\test.py&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">reg_root_path = <span class="string">r&#x27;Directory\\Background\\shell&#x27;</span></span><br><span class="line"></span><br><span class="line">reg_root = reg.OpenKey(reg.HKEY_CLASSES_ROOT, reg_root_path, <span class="number">0</span>, reg.KEY_ALL_ACCESS)</span><br><span class="line">reg_menu = reg.CreateKey(reg_root, <span class="string">r&quot;test_menu\\&quot;</span>)</span><br><span class="line">reg.SetValue(reg_menu, <span class="string">&#x27;MUIVerb&#x27;</span>, reg.REG_SZ, <span class="string">&#x27;this is my test menu&#x27;</span>)</span><br><span class="line">reg.CloseKey(reg_menu)</span><br><span class="line"></span><br><span class="line">reg_root = reg.OpenKey(reg.HKEY_CLASSES_ROOT, reg_root_path, <span class="number">0</span>, reg.KEY_ALL_ACCESS)</span><br><span class="line">reg_menu_command = reg.CreateKey(reg_root, <span class="string">r&quot;test_menu\\command&quot;</span>)</span><br><span class="line">reg.SetValue(reg_menu_command, <span class="string">&#x27;&#x27;</span>, reg.REG_SZ, <span class="string">&quot;&#123;&#125; &#123;&#125; %v&quot;</span>.<span class="built_in">format</span>(python_exe, script_path))</span><br><span class="line">reg.CloseKey(reg_menu_command)</span><br></pre></td></tr></table></figure><h2 id="reg-file"><a class="markdownIt-Anchor" href="#reg-file"></a> Reg File</h2><p>Another way to transfer out the registry setup is by exportingout from registry editor directly to a <code>.reg</code> file.</p><p>This can be done by simply selecting the top key and right-clickand select ‘Export’; the <code>.reg</code> file is a text based file.</p><h3 id="cascade-menu"><a class="markdownIt-Anchor" href="#cascade-menu"></a> Cascade Menu</h3><p><img src="https://i.imgur.com/7f8imK0.png" alt="cascade result" /></p><p>How should we go about implementing a multi-layered menu?I found a lot of examples online that are either complicated/messyor not working at all.</p><p>Eventually I’ve come across this blog explaining what I thinkis the ideal way to implement Cascading menu. It keeps everythingin one place, has this clean and easy to understand hierarchy, andvery easy.</p><p>Essentially, we only need to add one additional field on thetop level menu item called: <code>subcommands</code>, and we then keepall the children menu item nested within it like what we have previously done.</p><p><img src="https://i.imgur.com/ZmeMdAI.png" alt="cascade menu field" />(An example of the full hierarchy breakdown)</p><h2 id="target-type"><a class="markdownIt-Anchor" href="#target-type"></a> Target Type</h2><p>Different context menu triggering condition requires editing different registry keys,This goes the same for different user group (registration visible to the current user vs. affecting globally to the machine).</p><p><strong>Background:</strong> when right-click on the backdrop of the explorer or desktop</p><p>if you are administrator</p><ul><li><code>HKEY_CLASSES_ROOT\Directory\Background\shell</code></li></ul><p>if you are a normal user</p><ul><li><code>HKEY_CURRENT_USER\Software\Classes\directory\Background\shell</code></li></ul><p><strong>Folder</strong>: when right-click on a folder in the explorer or desktop</p><p>if you are administrator</p><ul><li><code>HKEY_CLASSES_ROOT\Directory\shell</code></li></ul><p>if you are a normal user</p><ul><li><code>HKEY_CURRENT_USER\Software\Classes\directory\shell</code></li></ul><p><strong>File</strong>: when right-click on a file in the explorer or desktop</p><p>if you are administrator</p><ul><li><code>HKEY_CLASSES_ROOT\*\shell</code></li></ul><p>if you are a normal user</p><ul><li><code>HKEY_CURRENT_USER\Software\Classes\*\shell</code></li></ul><p><strong>File Type Association</strong>: when right-click on a specific file type:</p><p>if you are administrator:</p><ul><li><code>HKEY_LOCAL_MACHINE\Software\Classes\SystemFileAssociations\&#123;.format&#125;\shell</code></li></ul><p>if you are a normal user:</p><ul><li><code>HKEY_CURRENT_USER\Software\Classes\SystemFileAssociations\&#123;.format&#125;\shell</code></li></ul><h2 id="noteworthy-mentions"><a class="markdownIt-Anchor" href="#noteworthy-mentions"></a> Noteworthy Mentions</h2><p>To further customize the context menu, we might be interestedwith adding separators between menu items, also having specific order ormenu items. These can all be achieved quite easily described in Sverrir’s Blog whichI’ve linked below.</p><p>Furthermore, there are also menu item with toggle box or check box; these arenot explored as of now.</p><h2 id="references"><a class="markdownIt-Anchor" href="#references"></a> References</h2><p><a href="https://stackoverflow.com/questions/20449316/how-add-context-menu-item-to-windows-explorer-for-folders">Stack Overflow - How add context menu item to Windows Explorer for folders</a></p><p><a href="https://www.notion.so/Creating-a-context-menu-with-sub-menu-for-Windows-for-a-specific-file-extension-61d5a0d696ed4b1db52f043656f936d6">Notion - Creating a context menu with sub-menu for Windows for a specific file extension</a></p><p><a href="https://stackoverflow.com/questions/2123762/add-menu-item-to-windows-context-menu-only-for-specific-filetype/47745854#47745854">Stack Overflow - Add menu item to Windows context menu only for specific filetype</a></p><p><a href="https://blog.sverrirs.com/2014/05/creating-cascading-menu-items-in.html">Sverrir’s Blog - Creating Cascading Menu Items in Windows Explorer 7, 8, 8.1 &amp; 10</a></p><p><a href="https://learn.microsoft.com/en-us/archive/blogs/andrew_richards/enhancing-the-open-command-prompt-here-shift-right-click-context-menu-experience">Microsoft - Enhancing the “Open Command Prompt here” Context Menu experience</a></p>]]></content>
    
    
    <summary type="html">Discover how to personalize the Windows right-click context menu using registry tweaks and automation techniques. Elevate your Windows journey with expert insights and step-by-step guides.</summary>
    
    
    
    <category term="learning log" scheme="https://www.xingyulei.com/categories/learning-log/"/>
    
    
    <category term="python" scheme="https://www.xingyulei.com/tags/python/"/>
    
    <category term="windows" scheme="https://www.xingyulei.com/tags/windows/"/>
    
  </entry>
  
  <entry>
    <title>Run Maya Batch Mode in 2023!</title>
    <link href="https://www.xingyulei.com/post/maya-batch-mode-2/"/>
    <id>https://www.xingyulei.com/post/maya-batch-mode-2/</id>
    <published>2023-05-06T07:00:00.000Z</published>
    <updated>2023-09-02T17:52:23.962Z</updated>
    
    <content type="html"><![CDATA[<p>I’m reviving a post from exactly 4 years ago ⌛️. It was severely flawed since it wasone of my earliest post while I’m still learning my ways around Maya.</p><h2 id="standalone-module"><a class="markdownIt-Anchor" href="#standalone-module"></a> Standalone Module</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> maya.standalone</span><br><span class="line">maya.standalone.initialize(name=<span class="string">&#x27;python&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="using-mayapy-interpreter"><a class="markdownIt-Anchor" href="#using-mayapy-interpreter"></a> Using <code>mayapy</code> Interpreter</h3><blockquote><p>I strongly recommend using <code>mayapy</code> in order to stay consistent with the behaviourof GUI maya.</p></blockquote><p>Prefer using <code>mayapy</code>: Maya’s own python interpreter, this ensuresall the libraries and plugins are compatible, it also saves some trouble configuringenvironments.</p><h3 id="using-external-python-interpreter"><a class="markdownIt-Anchor" href="#using-external-python-interpreter"></a> Using External Python Interpreter</h3><p>When using external interpreter for whatever reason, we’ll need to check:</p><ul><li><p>The python interpreter should match the maya python version</p><ul><li>e.g. (<em>python27</em> for Maya 2018)</li></ul></li><li><p>System environment variable will need to set up in order to find maya modules</p><ul><li>Otherwise, we may encounter the following:</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ImportError: No module named maya.standalone</span><br></pre></td></tr></table></figure></li></ul><p>To configure the environment for our external interpreter:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MAYA_LOCATION = <span class="string">&quot;C:/Program Files/Autodesk/Maya2018&quot;</span></span><br><span class="line">PYTHON_LOCATION = MAYA_LOCATION + <span class="string">&quot;/Python/Lib/site-packages&quot;</span></span><br><span class="line"></span><br><span class="line">os.environ[<span class="string">&quot;MAYA_LOCATION&quot;</span>] = MAYA_LOCATION</span><br><span class="line">os.environ[<span class="string">&quot;PYTHONPATH&quot;</span>] = PYTHON_LOCATION</span><br><span class="line"></span><br><span class="line">sys.path.append(MAYA_LOCATION)</span><br><span class="line">sys.path.append(PYTHON_LOCATION)</span><br><span class="line">sys.path.append(MAYA_LOCATION+<span class="string">&quot;/bin&quot;</span>)</span><br><span class="line">sys.path.append(MAYA_LOCATION+<span class="string">&quot;/lib&quot;</span>)</span><br><span class="line">sys.path.append(MAYA_LOCATION+<span class="string">&quot;/Python&quot;</span>)</span><br><span class="line">sys.path.append(MAYA_LOCATION+<span class="string">&quot;/Python/DLLs&quot;</span>)</span><br><span class="line">sys.path.append(MAYA_LOCATION+<span class="string">&quot;/Python/Lib&quot;</span>)</span><br><span class="line">sys.path.append(MAYA_LOCATION+<span class="string">&quot;/Python/Lib/plat-win&quot;</span>)</span><br><span class="line">sys.path.append(MAYA_LOCATION+<span class="string">&quot;/Python/Lib/lib-tk&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;\n&#x27;</span>.join(sys.path))</span><br></pre></td></tr></table></figure><h2 id="making-our-first-standalone-script"><a class="markdownIt-Anchor" href="#making-our-first-standalone-script"></a> Making Our First Standalone Script</h2><p>After <code>maya.standalone</code> has initialized, we can import <code>maya.cmds</code> as usual.</p><p>Let’s add a test function to our standalone script.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> maya.cmds <span class="keyword">as</span> cmds</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>():</span><br><span class="line">    maya_file_to_open = <span class="string">r&quot;C:\Users\Lei\Desktop\test.ma&quot;</span></span><br><span class="line">    cmds.file(maya_file_to_open, o=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># import a file and rename</span></span><br><span class="line">    maya_file_to_import = <span class="string">r&quot;C:\Users\Lei\Desktop\import.ma&quot;</span></span><br><span class="line">    cmds.file(maya_file_to_import, i=<span class="literal">True</span>, <span class="built_in">type</span>=<span class="string">&quot;mayaAscii&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    temp_name = <span class="string">r&quot;C:\Users\Lei\Desktop\temp.ma&quot;</span></span><br><span class="line">    cmds.file(rename=temp_name)</span><br><span class="line">    cmds.file(force=<span class="literal">True</span>, save=<span class="literal">True</span>, options=<span class="string">&#x27;v=1;p=17&#x27;</span>, <span class="built_in">type</span>=<span class="string">&#x27;mayaBinary&#x27;</span>)</span><br></pre></td></tr></table></figure><p>This test function opens a maya file on my desktop and import a maya fileand save out as another file.</p><h2 id="execution"><a class="markdownIt-Anchor" href="#execution"></a> Execution</h2><p>Here I’m using <code>mayapy</code> as example, we can of course using the external pythoninterpreter, but again, it takes extra steps.</p><p><strong>Execute from Command Line</strong></p><ul><li><p>make sure to add <code>mayapy</code> to our system environment variable.</p><ul><li>in system variable: add <code>C:\Program Files\Autodesk\Maya2018\bin</code> to <code>Path</code></li></ul></li><li><p>open command prompt, and enter <code>mayapy [directoryTo/firstStandalone.py]</code></p></li></ul><p><strong>Execute using <code>subprocess</code></strong></p><p>We can do it without going to command line, but by executing another <code>.py</code> using subprocess</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">mayapy = <span class="string">r&#x27;C:\Program Files\Autodesk\Maya2018\bin\mayapy.exe&#x27;</span></span><br><span class="line">script = <span class="string">r&#x27;[directory/firstStandalone.py]&#x27;</span></span><br><span class="line"></span><br><span class="line">process = subprocess.Popen(</span><br><span class="line">    [mayapy, script],</span><br><span class="line">    stdout=subprocess.PIPE,</span><br><span class="line">    stderr=subprocess.STDOUT,</span><br><span class="line">    env=env</span><br><span class="line">)</span><br><span class="line">out, error = process.communicate()</span><br></pre></td></tr></table></figure><p>Here I’m removing the environment setup in <code>firstStandlone.py</code>, and add a wrapper:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> traceback</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> maya.standalone</span><br><span class="line">maya.standalone.initialize(name=<span class="string">&#x27;python&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> maya.cmds <span class="keyword">as</span> cmds</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>():</span><br><span class="line">    maya_file_to_open = <span class="string">r&quot;C:\Users\Lei\Desktop\test.ma&quot;</span></span><br><span class="line">    cmds.file(maya_file_to_open, o=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># import a file and rename</span></span><br><span class="line">    maya_file_to_import = <span class="string">r&quot;C:\Users\Lei\Desktop\import.ma&quot;</span></span><br><span class="line">    cmds.file(maya_file_to_import, i=<span class="literal">True</span>, <span class="built_in">type</span>=<span class="string">&quot;mayaAscii&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    temp_name = <span class="string">r&quot;C:\Users\Lei\Desktop\temp.ma&quot;</span></span><br><span class="line">    cmds.file(rename=temp_name)</span><br><span class="line">    cmds.file(force=<span class="literal">True</span>, save=<span class="literal">True</span>, options=<span class="string">&#x27;v=1;p=17&#x27;</span>, <span class="built_in">type</span>=<span class="string">&#x27;mayaBinary&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        cmds.evalDeferred(runMode)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        logging.error(traceback.print_exc())</span><br></pre></td></tr></table></figure><h2 id="standalone-script-with-arguments"><a class="markdownIt-Anchor" href="#standalone-script-with-arguments"></a> Standalone Script with Arguments</h2><p>Sometimes, we would want to pass arguments to our standalone script</p><h3 id="using-sysargv"><a class="markdownIt-Anchor" href="#using-sysargv"></a> Using <code>sys.argv</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">file_path = sys.argv[<span class="number">1</span>]</span><br><span class="line">file_name = sys.argv[<span class="number">2</span>]</span><br></pre></td></tr></table></figure><p>Example from Toadstorm Nerdblog:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">maya_path = <span class="string">&#x27;directory/mayapy.exe&#x27;</span>  <span class="comment"># mayapy or full path to mayapy.exe</span></span><br><span class="line">script_path = <span class="string">&#x27;directory/firstStandalone.py&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_layer</span>(<span class="params">file_names,layer_name</span>):</span><br><span class="line">    <span class="keyword">for</span> file_name <span class="keyword">in</span> file_names:</span><br><span class="line">        command = <span class="string">r&#x27;mayapy &#123;&#125; &#123;&#125; &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(</span><br><span class="line">            script_path, file_name, layer_name</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        process = subprocess.Popen(</span><br><span class="line">            command,</span><br><span class="line">            stdout=subprocess.PIPE,</span><br><span class="line">            stderr=subprocess.PIPE</span><br><span class="line">        )</span><br><span class="line">        process.wait()</span><br><span class="line">        <span class="built_in">print</span>(process.returncode)  <span class="comment"># this return the message from cmd</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># define a list of filenames to iterate through</span></span><br><span class="line">    files = [<span class="string">&#x27;file1&#x27;</span>, <span class="string">&#x27;file2&#x27;</span>, <span class="string">&#x27;file3&#x27;</span>]</span><br><span class="line">    render_layer = <span class="string">&#x27;a new render layer&#x27;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment"># run procedure, assuming you&#x27;ve already defined it</span></span><br><span class="line">    add_layer(files, render_layer)</span><br></pre></td></tr></table></figure><h3 id="using-argparser"><a class="markdownIt-Anchor" href="#using-argparser"></a> Using <code>argparser</code></h3><p>In the commandline launch script, add argment:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">scene = <span class="string">r&quot;C:\Users\Lei\Desktop\test.ma&quot;</span></span><br><span class="line"></span><br><span class="line">process = subprocess.Popen(</span><br><span class="line">    [mayapy, script, <span class="string">&#x27;scene=&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(scene)],</span><br><span class="line">    stdout=subprocess.PIPE,</span><br><span class="line">    stderr=subprocess.STDOUT,</span><br><span class="line">    env=env</span><br><span class="line">)</span><br><span class="line">out, error = process.communicate()</span><br></pre></td></tr></table></figure><p>And then in the wrapper, use the <code>ArgumentParser()</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"></span><br><span class="line">parser = argparse.ArgumentParser()</span><br><span class="line">parser.add_argument(<span class="string">&#x27;scene&#x27;</span>)</span><br><span class="line"></span><br><span class="line">command_line_args = parser.parse_args()</span><br><span class="line">SCENE = command_line_args.scene</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">example</span>():</span><br><span class="line">    cmds.file(SCENE, <span class="built_in">open</span>=<span class="literal">True</span>, force=<span class="literal">True</span>)</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><h2 id="bonus-integrate-ui-elements-from-qt"><a class="markdownIt-Anchor" href="#bonus-integrate-ui-elements-from-qt"></a> Bonus: Integrate UI Elements from Qt</h2><p>It is easy to integrate UI in a standalone tool by creating a <code>QApplication</code> instance,and for Maya GUI, Maya has <code>QApplication</code> instance already created.</p><p>but for maya standalone script, we need to make sure to create a <code>QApplication</code> instancebefore the standalone initialization:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Qt <span class="keyword">import</span> QtWidgets</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = QtWidgets.QApplication(sys.argv)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> maya.standalone</span><br><span class="line">maya.standalone.initialize()</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>Depending on our tool need, usually standalone script wouldn’t block themain event loop, so we just exit when finished, therefore, no need to add <code>sys.exit(app.exec_())</code></p><h2 id="bonus-copying-gui-maya-environment"><a class="markdownIt-Anchor" href="#bonus-copying-gui-maya-environment"></a> Bonus: Copying GUI Maya Environment</h2><p>To get the exact environment as the GUI Maya version (this could be useful if there’s anystartup scripts that modifies the environment)</p><p>In the maya session, parse out the environment and save it as a dictionary:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">env_dict = <span class="built_in">dict</span>(os.environ)</span><br></pre></td></tr></table></figure><p>And in the commandline setup .py, apply the environment from the dictionary:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">env_dict_copy_from_maya = &#123;<span class="string">&#x27;TEST&#x27;</span>: <span class="string">&#x27;THIS IS A TEST&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">current_env = os.environ.copy()</span><br><span class="line"><span class="keyword">for</span> key, value <span class="keyword">in</span> env_dict_copy_from_maya.items():</span><br><span class="line">    current_env[key] = value</span><br><span class="line"></span><br><span class="line">process = subprocess.Popen(</span><br><span class="line">    ...,</span><br><span class="line">    env=current_env</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="reference"><a class="markdownIt-Anchor" href="#reference"></a> Reference</h2><p><a href="https://www.xingyulei.com/post/maya-batch-mode/">Xingyu Lei - Save Time and Boost Efficiency: Learn to Run Maya in Batch Mode</a></p><p><a href="https://stackoverflow.com/questions/68062715/maya-standalone-with-pyside2">Stack Overflow - maya standalone with pyside2</a></p><p><a href="http://discourse.techart.online/t/import-maya-standalone-problem/1437">Tech-Artist Org - Import maya.standalone problem</a></p><p><a href="https://stackoverflow.com/questions/27437733">Stack Overflow - use external python script to open maya and run another script inside maya</a></p><p><a href="https://stackoverflow.com/questions/17500157">Stack Overflow - How to use an external interpreter for Maya?</a></p><p><a href="https://www.toadstorm.com/blog/?p=136">Toadstorm Nerdblog - Python in Maya Standalone</a></p>]]></content>
    
    
    <summary type="html">Learn how to run Maya in batch mode for animation and game development with our step-by-step tutorial. Streamline your workflow and save time with this efficient method for rendering large scenes and complex animations. Join our community of artists and game developers today and take your projects to the next level with Maya!</summary>
    
    
    
    <category term="tech summary" scheme="https://www.xingyulei.com/categories/tech-summary/"/>
    
    
    <category term="maya" scheme="https://www.xingyulei.com/tags/maya/"/>
    
    <category term="python" scheme="https://www.xingyulei.com/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>Beginner&#39;s Guide to Object-Oriented Design for Scalable Application</title>
    <link href="https://www.xingyulei.com/post/general-oo-design/"/>
    <id>https://www.xingyulei.com/post/general-oo-design/</id>
    <published>2023-04-02T07:00:00.000Z</published>
    <updated>2023-11-03T03:43:39.734Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>This blog is a second processed product/summary of the tutorial series:<a href="https://www.linkedin.com/learning/topics/object-oriented-programming">Linkedin Learning: Object-Oriented Programming</a>.Bullet points extracted by me and reformatted with help from ChatGPT.</p></blockquote><p>Object-oriented design is a fundamental concept in software development thatfocuses on modeling the behavior and characteristics of real-world objects in a program.By understanding the basics of object identity, properties and attributes, behavior, and class, developers can create well-designed, efficient, and maintainable software.</p><h2 id="introduction"><a class="markdownIt-Anchor" href="#introduction"></a> Introduction</h2><p><strong>Object Identity:</strong>Objects are unique entities within a program that are separate and distinguishable from one another, even if they belong to the same class or type. Each object has a unique identifier that differentiates it from other objects, and this identity is essential for managing and manipulating objects within a program.</p><p><strong>Properties and Attributes:</strong>Objects have properties or attributes that define their characteristics, such as size, weight, color, and shape. These attributes are essential for representing real-world objects in a program and can be used to distinguish between different objects of the same type.</p><p><strong>Behavior:</strong>Objects have behavior or actions that they can perform, such as filling, swimming, or ringing. Behavior is typically defined as methods or functions that manipulate an object’s attributes or interact with other objects in the program.</p><p>One of the challenges of object-oriented design is <strong>identifying what can be an objectin a program</strong>. In general, objects should be represented by nouns and not verbs,and they should have a unique identity, attributes, and behavior. The focus should be on identifying the main objects in the program and their interactions with one another.</p><p>A class is a template for creating objects in a program. It defines the name, type, attributes, and behavior of objects that belong to that class. A class can be used to create multiple objects of the same type and is an essential component of object-oriented design.</p><h3 id="steps-for-object-oriented-design"><a class="markdownIt-Anchor" href="#steps-for-object-oriented-design"></a> Steps for Object-Oriented Design</h3><p>The process of object-oriented design involves analyzing and designing the program before writing the code.This includes gathering requirements, describing the application, identifying the main objects, describing the interactions between objects, and creating a class diagram using Unified Modeling Language (UML).</p><h2 id="softwaresystem-requirements"><a class="markdownIt-Anchor" href="#softwaresystem-requirements"></a> Software/System Requirements</h2><p>In object-oriented design, understanding the software/system requirements is essential for creating awell-designed, efficient, and maintainable program.</p><h3 id="sets-of-requirements"><a class="markdownIt-Anchor" href="#sets-of-requirements"></a> Sets of Requirements</h3><p>Software/system requirements can be divided into two sets of questions:</p><ul><li>what does it need to do?</li><li>how should it do it?</li></ul><p>The first set of questions refers to the functionality of the program, while the second set refers to performance, legal, support, and security requirements.</p><ul><li><p><strong>Function Requirements:</strong>refer to what the system/application must do. These requirements capture the bare necessities of the program and define the core functionality that the program needs to provide.</p></li><li><p><strong>Non-Functional Requirements:</strong>define how the system/application should do something. These requirements are concerned with aspects such as usability, reliability, performance, supportability, design, implementation, interface, and physical constraints.</p></li></ul><h3 id="furps-requirement-model"><a class="markdownIt-Anchor" href="#furps-requirement-model"></a> FURPS Requirement Model</h3><p>The FURPS requirement model is a framework for thinking about software/system requirements.FURPS stands for functionality, usability, reliability, performance, and supportability.</p><ul><li><p><strong>Functionality</strong>refers to the capabilities of the system, while the other four elements are non-functional requirements.</p></li><li><p><strong>Usability</strong>focuses on the user and include factors such as human factors UI and documentation.The usability of the program is essential for ensuring that users can efficiently and effectively use the system.</p></li><li><p><strong>Reliability</strong>is concerned with predictability, availability, and failure rate.These requirements ensure that the program operates consistently and reliably.</p></li><li><p><strong>Performance</strong>relates to speed, efficiency, and limitations. These requirements ensure that the program operates efficiently and effectively, even when processing large amounts of data.</p></li><li><p><strong>Supportability</strong>is concerned with extensibility, configurability, and testability. These requirements ensure that the program can be maintained and updated over time.</p></li></ul><p>Design, Implementation, Interface, and Physical ConstraintsIn addition to the FURPS requirements, other non-functional requirements include design (how the program is built), implementation (the programming language used and standards to follow), interface (the ability of the program to interface with other systems), and physical constraints (the hardware limitations of the system).</p><h2 id="use-case"><a class="markdownIt-Anchor" href="#use-case"></a> Use Case</h2><p>The use case is a scenario that outlines a particular goal of an actor (user) with the system. It consists of the following elements:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[Title] </span><br><span class="line">    Short and simple goal</span><br><span class="line">[Primary Actor] </span><br><span class="line">    The user who desires to achieve the goal</span><br><span class="line">[Success Scenario] </span><br><span class="line">    Steps or paragraphs describing how to achieve the goal</span><br></pre></td></tr></table></figure><p>To create a use case,identify the actors who interact with the system and separate them by their roles in the use case, not job titles.Focus on the intent of the goal and not go into too specific steps or too broad a goal.The scenario should be concise and avoid detailed technical implementation or UI elements.Focus on the “sunny-day” scenario and avoid including rarely encountered scenarios.Avoid needless words and keep the scenario short and concise.</p><h2 id="conceptual-model"><a class="markdownIt-Anchor" href="#conceptual-model"></a> Conceptual Model</h2><p>In object-oriented design, creating a conceptual model is acrucial step in developing a software or system.A conceptual model helps to identify the objects and their relationships that will form the backbone of the software.Here are the steps involved in creating a conceptual model.</p><ul><li><p><strong>Identify Objects:</strong>The first step is to identify the objects that will be used as class objects in the system.This can be done by looking at the user story or use case and picking out the relevant <strong>nouns.</strong></p><ul><li>For example, in a user story about ordering a meal, the relevant objects might include “customer,” “menu,” and “order.”</li></ul></li><li><p><strong>Identify Class Relationships:</strong>Once the objects have been identified, the next step is to connect them with lines to show their relationships.It is important to write down the <strong>verbs</strong> on each line to avoid using generic words like “use.”Instead, use verbs that describe the relationship between the objects.</p><ul><li>For example, in the meal ordering system, the “customer” might “place” an “order” from the “menu.”</li></ul></li><li><p><strong>Figure Out Class Responsibilities:</strong>The final step is to figure out the responsibilities of each class.This involves identifying the behaviors or actions that each class will perform.This can be done by looking at the user story or use case and picking out the relevant verbs.</p><ul><li>For example, in the meal ordering system, the “menu” class might have the responsibility of “displaying” the available items while the “order” class might have the responsibility of “calculating” the total cost of the meal.</li></ul></li></ul><p>It is important to note that each behavior should belong to the class that is most responsible for it.A behavior usually involves multiple objects, but each object should be responsible for itself.Avoid putting too much responsibility on a single object, which can lead to a “god object” that controls everything in the system.</p><p>In addition to these steps, another useful tool for creating a conceptual model is CRC (Class Responsibility Collaboration) cards.These cards can be used to organize the classes and their responsibilities, making it easier to visualize the system and identify any potential issues.</p><h2 id="class-diagram-and-class-relationship"><a class="markdownIt-Anchor" href="#class-diagram-and-class-relationship"></a> Class Diagram and Class Relationship</h2><p>In object-oriented design, UML class diagrams are used to represent the structure of a system’s classes and the relationships between them.Here are some important considerations when creating UML class diagrams.</p><p>Each class in a UML class diagram should have a name, attributes, and behaviors.When creating classes, it’s important to focus on the behaviors of the objects,rather than just their attributes. This is because objects are meant to do things,not just hold data.In general, it’s recommended to keep as many class attributes and methods as private as possible,only making them public if we are certain that other objects will need to use them.</p><p><strong>Constructor:</strong></p><p>Constructors are considered as behavior and should be treated as such when creating UML class diagrams.In UML, a constructor is represented as a method with the same name as the class.</p><p><strong>Interface:</strong></p><p>In UML, abstract classes and interfaces are represented as types.Abstract classes are used to represent a general category of objects,while interfaces are used to represent shared capabilities or behaviors.For example, a draw() interface can be shared between different types of objects that can be drawn on a screen.While objects of different types cannot be categorized under the same abstract class,they can all share the draw() interface to be able to draw on the screen.A system can iterate through all objects and call the draw() interface to update the screen.</p><h2 id="principles-and-patterns"><a class="markdownIt-Anchor" href="#principles-and-patterns"></a> Principles and Patterns</h2><p>There are several principles and patterns that can help make our software development more efficient and effective.</p><ol><li><p>Single Responsibility Principle: A class should have only one responsibility. Avoid creating god objects that try to do everything. Instead, split responsibilities into multiple classes.</p></li><li><p>Don’t Repeat Yourself (DRY): Avoid duplicating code. Reuse code and extract common functionality into methods or classes.</p></li><li><p>You Ain’t Gonna Need It (YAGNI): Don’t overdo it. Only add features that are necessary and useful. Avoid adding unnecessary complexity.</p></li><li><p>Error Handling and Prompt to Guide Users: Design our software to handle errors gracefully and provide clear prompts to guide users. Good error handling can improve the user experience and prevent bugs.</p></li><li><p>Software Testing: Testing is an important part of software development. Write automated tests to ensure that our code is working as intended and to catch regressions.</p></li><li><p>Design Patterns: Design patterns are reusable solutions to common software design problems.</p></li></ol><h3 id="design-pattern"><a class="markdownIt-Anchor" href="#design-pattern"></a> Design Pattern</h3><p>They provide a template to help structure our code around.One of the most well-known books on design patterns is <em>“Design Patterns: Elements of Reusable Object-Oriented Software”</em>by the “Gang of Four”, which describes 23 patterns.</p><ul><li><p><strong>Creational Patterns:</strong>These patterns deal with the instantiation of objects. Examples include Abstract Factory, Builder, Factory Method, Prototype, and Singleton.</p></li><li><p><strong>Structural Patterns:</strong>These patterns deal with how classes are designed and composed. Examples include Adapter, Bridge, Composite, Decorator, Facade, Flyweight, and Proxy.</p></li><li><p><strong>Behavioral Patterns:</strong>These patterns deal with communication between objects. Examples include Chain of Responsibility, Command, Interpreter, Iterator, Mediator, Memento, Observer, State, Strategy, Template Method, and Visitor.</p></li></ul><p>By following these principles and patterns, we can create software that is more modular, maintainable, and scalable.</p>]]></content>
    
    
    <summary type="html">Learn about important principles and techniques in Object-Oriented Design in this comprehensive guide. Discover how to create a conceptual model, use UML class diagrams, and apply software development principles and design patterns. Improve your software development skills and create efficient, reusable code with these essential tips and best practices.</summary>
    
    
    
    <category term="learning log" scheme="https://www.xingyulei.com/categories/learning-log/"/>
    
    
    <category term="pipeline" scheme="https://www.xingyulei.com/tags/pipeline/"/>
    
  </entry>
  
  <entry>
    <title>Unreal Distributed Rendering Server Handbook: Render Farm Implementation</title>
    <link href="https://www.xingyulei.com/post/ue-rendering-remote-farm/"/>
    <id>https://www.xingyulei.com/post/ue-rendering-remote-farm/</id>
    <published>2023-02-04T08:00:00.000Z</published>
    <updated>2023-03-29T21:43:22.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="introduction"><a class="markdownIt-Anchor" href="#introduction"></a> Introduction</h2><blockquote><p>Previous blogs that you may find relevant</p><ul><li><a href="https://www.xingyulei.com/post/ue-rendering-basic/">Learn to Automate Unreal Rendering Using Python</a></li><li><a href="https://www.xingyulei.com/post/ue-rendering-custom-executor/">Unreal Movie Render Queue (MRQ) Custom Executor</a></li><li><a href="https://www.xingyulei.com/post/py-http-server/">Building HTTP Server with REST API in Python</a></li></ul></blockquote><blockquote><p>GitHub link to the complete project code:<a href="https://github.com/leixingyu/unrealRenderFarm">Unreal Render Farm</a></p></blockquote><p>The first thing to do when creating a distributed remote render farm is to establishits framework. I personally have not much experience using render farm, not tomention designing one. (It is not surprising since I don’t see anyone would builda render farm for personal use). Nevertheless, it’s still such an interestingtopic that I couldn’t resist exploring.</p><p><strong>Important: the following is a simple implementation of a distributed rendering server/render farm with dummy functionalities and are meant to be substituted based on project needs.</strong></p><h2 id="distributed-rendering-framework"><a class="markdownIt-Anchor" href="#distributed-rendering-framework"></a> Distributed Rendering Framework</h2><p>Here are two examples of how other farm system is structured</p><blockquote><p>Update: I noticed Epic Games <strong>just</strong> posted a new blog which introduces anoverview of setting up the render farm. It is worth the read.Moreover, it also includes the source code of remote renderingin Deadline, the code is not hard to follow but it’s different from my implementation.See more details here: <a href="https://dev.epicgames.com/community/learning/tutorials/xY9O/overview-of-setting-up-a-render-farms-with-unreal-engine">Overview of Setting Up A Render Farms With Unreal Engine</a></p></blockquote><h3 id="blender-network-rendering"><a class="markdownIt-Anchor" href="#blender-network-rendering"></a> Blender Network Rendering</h3><p>This is a blender legacy network rendering system. It consists of three roles:</p><ul><li>Regular client:<ul><li>client, sends render requests</li></ul></li><li>Slave:<ul><li>also a client, used to process render job</li></ul></li><li>Master:<ul><li>server, coordinate (process requests from clients and assign jobs to slave)</li></ul></li></ul><p>The clients need to pre-configure server address in order to talk to master.For both types of clients, they have the ability to send request to update job status (add, delete, modify).A regular client can also request information about the currently active slaves connectedto the server.</p><h3 id="unreal-swarm-farm"><a class="markdownIt-Anchor" href="#unreal-swarm-farm"></a> Unreal Swarm Farm</h3><p>This is an Unreal farm system to build lighting. There are two components:</p><ul><li>Swarm agent:<ul><li>client, an agent can send light map bake request, it also can process light map bake from the server</li></ul></li><li>Swarm coordinator:<ul><li>server, used to coordinate light map bake request</li></ul></li></ul><p>Similarly, the swarm agent initialize connection by pinging coordinator using apre-configured address. The swarm agent role can be split into two which exactlymaps to the role of a regular client and a slave in the Blender Network RenderingExample.</p><p>There is still one question remains: how does the server sends job to client?</p><ul><li>the client send request for jobs periodically</li><li>a listener server on client side that the server pings to</li><li>broadcast</li><li><a href="https://blog.oddbit.com/post/2013-11-23-long-polling-with-ja/">long polling</a></li></ul><p>I decided to go with the easiest setup: client request for jobs periodically.</p><h3 id="summary"><a class="markdownIt-Anchor" href="#summary"></a> Summary</h3><p><img src="https://i.imgur.com/h6BqZBP.jpg" alt="framework" /></p><p>So, finally I have my Unreal remote rendering framework like above:</p><ul><li><p>Manager: server, used to host the HTTP server, stores job requestinformation connected to a database, and coordinates/manages request among render nodes</p></li><li><p>Submitter: client, connect to the manager and submit render job request</p><ul><li>since the submitter only need to send request, this could be entirely web-based</li></ul></li><li><p>Worker: client, connect to manager, periodically pings for new jobto process, renders the job and periodically pings to update current render progress</p><ul><li><strong>requires Unreal installed, capable for rendering jobs</strong></li></ul></li></ul><h2 id="render-job-request-data-structure"><a class="markdownIt-Anchor" href="#render-job-request-data-structure"></a> Render Job Request Data Structure</h2><h3 id="structure"><a class="markdownIt-Anchor" href="#structure"></a> Structure</h3><p>Here’s a data class I’ve made for representing a render job request, which fundamentallyis a dictionary structure:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RenderRequest</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params"></span></span><br><span class="line"><span class="params">            self,</span></span><br><span class="line"><span class="params">            uid=<span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="params">            name=<span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="params">            owner=<span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="params">            worker=<span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="params">            time_created=<span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="params">            priority=<span class="number">0</span>,</span></span><br><span class="line"><span class="params">            category=<span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="params">            tags=[],</span></span><br><span class="line"><span class="params">            status=<span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="params">            umap_path=<span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="params">            useq_path=<span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="params">            uconfig_path=<span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="params">            output_path=<span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="params">            width=<span class="number">0</span>,</span></span><br><span class="line"><span class="params">            height=<span class="number">0</span>,</span></span><br><span class="line"><span class="params">            frame_rate=<span class="number">0</span>,</span></span><br><span class="line"><span class="params">            <span class="built_in">format</span>=<span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="params">            start_frame=<span class="number">0</span>,</span></span><br><span class="line"><span class="params">            end_frame=<span class="number">0</span>,</span></span><br><span class="line"><span class="params">            time_estimate=<span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="params">            progress=<span class="number">0</span></span></span><br><span class="line"><span class="params">    </span>):</span><br><span class="line">        self.uid = uid <span class="keyword">or</span> <span class="built_in">str</span>(uuid.uuid4())[:<span class="number">4</span>]</span><br><span class="line">        self.name = name</span><br><span class="line">        self.owner = owner <span class="keyword">or</span> socket.gethostname()</span><br><span class="line">        self.worker = worker</span><br><span class="line">        self.time_created = time_created <span class="keyword">or</span> datetime.now().strftime(<span class="string">&quot;%m/%d/%Y, %H:%M:%S&quot;</span>)</span><br><span class="line">        self.priority = priority <span class="keyword">or</span> <span class="number">0</span></span><br><span class="line">        self.category = category</span><br><span class="line">        self.tags = tags</span><br><span class="line">        self.status = status <span class="keyword">or</span> RenderStatus.unassigned</span><br><span class="line">        self.umap_path = umap_path</span><br><span class="line">        self.useq_path = useq_path</span><br><span class="line">        self.uconfig_path = uconfig_path</span><br><span class="line">        self.output_path = output_path</span><br><span class="line">        self.width = width <span class="keyword">or</span> <span class="number">1280</span></span><br><span class="line">        self.height = height <span class="keyword">or</span> <span class="number">720</span></span><br><span class="line">        self.frame_rate = frame_rate <span class="keyword">or</span> <span class="number">30</span></span><br><span class="line">        self.<span class="built_in">format</span> = <span class="built_in">format</span> <span class="keyword">or</span> <span class="string">&#x27;JPG&#x27;</span></span><br><span class="line">        self.start_frame = start_frame <span class="keyword">or</span> <span class="number">0</span></span><br><span class="line">        self.end_frame = end_frame <span class="keyword">or</span> <span class="number">0</span></span><br><span class="line">        self.length = self.end_frame - self.start_frame</span><br><span class="line">        self.time_estimate = time_estimate</span><br><span class="line">        self.progress = progress</span><br></pre></td></tr></table></figure><h3 id="database"><a class="markdownIt-Anchor" href="#database"></a> Database</h3><p>For the time-being and testing purpose, I didn’t deploy an actual database. Instead,I used localized .json files for render job request storage.A render request’s unique <code>uid</code> serves as the primary key.</p><p>Each render request is serialized as a .json file mimicing each row of a database,therefore, making each render job independent:a GET method queries one .json file (an entry) or all .json files in the ‘database’;a POST method creates a .json file;a PUT method updates a .json file;and a DELETE method removes a .json file.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">remove_db</span>(<span class="params">uid</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Remove a RenderRequest object from the database</span></span><br><span class="line"><span class="string">    :param uid: str. request uid</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    os.remove(<span class="string">&#x27;&#123;&#125;.json&#x27;</span>.<span class="built_in">format</span>(uid))</span><br></pre></td></tr></table></figure><h2 id="manager"><a class="markdownIt-Anchor" href="#manager"></a> Manager</h2><p>I’m using flask - a micro web framework in Python to host my HTTP server with REST API,which makes it easier for my client to communicate with the manager.For more information on that, check out my previous blog: <a href="https://www.xingyulei.com/post/py-http-server/#using-flask">Building HTTP Server with REST API in Python</a></p><h3 id="rest-api"><a class="markdownIt-Anchor" href="#rest-api"></a> REST API</h3><p>For the server communication part, I implemented four methods:</p><ul><li>GET: api for a render job(s) query request from the clients (submitter or worker)</li><li>POST: api for a new render job creation request from the submitter</li><li>PUT: api for a render job update request from the worker</li><li>DELETE: api for a render job deletion request from the clients</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.delete(<span class="params"><span class="string">&#x27;/api/delete/&lt;uid&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete_request</span>(<span class="params">uid</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Server DELETE api response, delete render request from database</span></span><br><span class="line"><span class="string">    :param uid: str. render request uid</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    renderRequest.remove_db(uid)</span><br></pre></td></tr></table></figure><h3 id="job-coordination"><a class="markdownIt-Anchor" href="#job-coordination"></a> Job Coordination</h3><p>Another important role of the manager is to coordinate jobs among the availableworker/render node. This is obviously a complex problem to solve on its own andis not the focus of my simple render farm implementation, thus, I currently haveit automatically assign any new job to a specific worker:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">new_request_trigger</span>(<span class="params">rrequest</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Triggers when a client posts a new render request to the server</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> rrequest.worker:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># currently, as a test, assigns all job to one worker</span></span><br><span class="line">    worker = <span class="string">&#x27;RENDER_MACHINE_01&#x27;</span></span><br><span class="line">    assign_request(rrequest, worker)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># if multiple jobs came in at once, interval between each assignment</span></span><br><span class="line">    time.sleep(<span class="number">4</span>)</span><br><span class="line">    LOGGER.info(<span class="string">&#x27;assigned job %s to %s&#x27;</span>, rrequest.uid, worker)</span><br></pre></td></tr></table></figure><h3 id="render-html-landing-page"><a class="markdownIt-Anchor" href="#render-html-landing-page"></a> Render HTML Landing Page</h3><p>I experimented with rendering the index page to display the all render jobrequests in the database, which looks like this:</p><p><img src="https://i.imgur.com/nk6CKQY_d.jpg?maxwidth=520&amp;shape=thumb&amp;fidelity=high" alt="index-page" /></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index_page</span>():</span><br><span class="line">    rrequests = renderRequest.read_all()</span><br><span class="line">    jsons = [rrequest.to_dict() <span class="keyword">for</span> rrequest <span class="keyword">in</span> rrequests]</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, requests=jsons)</span><br></pre></td></tr></table></figure><p>The tables are generated using a javascript where the columns can be customized</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createTable</span>(<span class="params">list</span>)&#123;</span><br><span class="line">    <span class="comment">// header row</span></span><br><span class="line">    cols = [<span class="string">&#x27;uid&#x27;</span>, <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;owner&#x27;</span>, <span class="string">&#x27;worker&#x27;</span>, <span class="string">&#x27;time_created&#x27;</span>, <span class="string">&#x27;status&#x27;</span>, <span class="string">&#x27;priority&#x27;</span>, <span class="string">&#x27;time_estimate&#x27;</span>, <span class="string">&#x27;progress&#x27;</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> table = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;table&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> tr = table.<span class="title function_">insertRow</span>(-<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; cols.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="comment">// header th elements</span></span><br><span class="line">        <span class="keyword">var</span> theader = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;th&quot;</span>);</span><br><span class="line">        theader.<span class="property">innerHTML</span> = cols[i];</span><br><span class="line">        tr.<span class="title function_">appendChild</span>(theader);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// data rows</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; list.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> trow = table.<span class="title function_">insertRow</span>(-<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">var</span> uid = list[i][<span class="string">&#x27;uid&#x27;</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; cols.<span class="property">length</span>; j++) &#123;</span><br><span class="line">            <span class="keyword">var</span> cell = trow.<span class="title function_">insertCell</span>(-<span class="number">1</span>);</span><br><span class="line">            cell.<span class="property">innerHTML</span> = list[i][cols[j]];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> el = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;table&quot;</span>);</span><br><span class="line">    el.<span class="property">innerHTML</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    el.<span class="title function_">appendChild</span>(table);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>For the progress bar render</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add id tag to specific cells for ajax</span></span><br><span class="line"><span class="keyword">if</span> (cols[j] == <span class="string">&#x27;progress&#x27;</span>)&#123;</span><br><span class="line">    <span class="comment">// container</span></span><br><span class="line">    cell.<span class="property">innerHTML</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    cell.<span class="property">style</span>.<span class="property">width</span> = <span class="string">&#x27;200px&#x27;</span>;</span><br><span class="line">    <span class="keyword">var</span> container = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">    cell.<span class="title function_">appendChild</span>(container);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// bar</span></span><br><span class="line">    <span class="keyword">var</span> bar = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">    container.<span class="title function_">appendChild</span>(bar);</span><br><span class="line">    bar.<span class="property">style</span>.<span class="property">width</span> = list[i][<span class="string">&#x27;progress&#x27;</span>] + <span class="string">&#x27;%&#x27;</span>;</span><br><span class="line">    bar.<span class="property">innerHTML</span> = list[i][<span class="string">&#x27;progress&#x27;</span>] + <span class="string">&#x27;%&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="asynchronous-update-using-ajax"><a class="markdownIt-Anchor" href="#asynchronous-update-using-ajax"></a> Asynchronous Update using AJAX</h3><p>To update data on the index page asynchronously with the PUT method, I opted infor AJAX (Asynchronous JavaScript and XML).</p><p>I’ve attached ids to specific HTML elements and set it upso the webpage updates the <em>render status</em>, <em>time remaining estimated</em> and<em>overall progress</em> every given period of time.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="variable language_">document</span>).<span class="title function_">ready</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="built_in">setInterval</span>(</span><br><span class="line">        <span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="title function_">ajaxRequest</span>()&#125;,</span><br><span class="line">        <span class="number">2000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ajaxRequest</span>(<span class="params"></span>)&#123;</span><br><span class="line">    $.<span class="title function_">getJSON</span>(<span class="string">&#x27;/api/get&#x27;</span>, <span class="keyword">function</span>(<span class="params">data</span>)&#123;</span><br><span class="line">        <span class="title function_">updateProgress</span>(data);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">updateProgress</span>(<span class="params">data</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> requests = data.<span class="property">results</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; requests.<span class="property">length</span>; i++)&#123;</span><br><span class="line">        <span class="keyword">var</span> uid = requests[i][<span class="string">&#x27;uid&#x27;</span>];</span><br><span class="line">        <span class="keyword">var</span> progress = requests[i][<span class="string">&#x27;progress&#x27;</span>];</span><br><span class="line">        <span class="keyword">var</span> time_estimate = requests[i][<span class="string">&#x27;time_estimate&#x27;</span>];</span><br><span class="line">        <span class="keyword">var</span> status = requests[i][<span class="string">&#x27;status&#x27;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> bar = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(uid + <span class="string">&#x27;_progress&#x27;</span>);</span><br><span class="line">        bar.<span class="property">style</span>.<span class="property">width</span> = progress + <span class="string">&#x27;%&#x27;</span>;</span><br><span class="line">        bar.<span class="property">innerHTML</span> = progress + <span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(uid + <span class="string">&#x27;_estimate&#x27;</span>).<span class="property">innerHTML</span> = time_estimate;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(uid + <span class="string">&#x27;_status&#x27;</span>).<span class="property">innerHTML</span> = status;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="submitter"><a class="markdownIt-Anchor" href="#submitter"></a> Submitter</h2><p>Since the server side is established, the submitter part is actually quiteeasy. All we need to do is to pass a data with render request data structureand use the POST method (I’m also using the <code>requests</code> standard library)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_request</span>(<span class="params">d</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = requests.post(SERVER_API_URL+<span class="string">&#x27;/post&#x27;</span>, json=d)</span><br><span class="line">    <span class="keyword">except</span> requests.exceptions.ConnectionError:</span><br><span class="line">        LOGGER.error(<span class="string">&#x27;failed to connect to server %s&#x27;</span>, SERVER_API_URL)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> RenderRequest.from_dict(response.json())</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    test_job = &#123;</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;test&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;owner&#x27;</span>: <span class="string">&#x27;TEST_SUBMITTER_01&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;umap_path&#x27;</span>: <span class="string">&#x27;/Game/Cinematics/Street/Level_Cin_Street.Level_Cin_Street&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;useq_path&#x27;</span>: <span class="string">&#x27;/Game/Cinematics/Street/LS_Master_Street.LS_Master_Street&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;uconfig_path&#x27;</span>: <span class="string">&#x27;/Game/Cinematics/Preset/Test.Test&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    rrequest = add_request(test_job)</span><br><span class="line">    <span class="keyword">if</span> rrequest:</span><br><span class="line">        LOGGER.info(<span class="string">&#x27;request %s sent to server&#x27;</span>, rrequest.uid)</span><br></pre></td></tr></table></figure><h2 id="worker"><a class="markdownIt-Anchor" href="#worker"></a> Worker</h2><p>Each worker represents a render node; The render node unlike other render machine,is a full-fledged PC with the complete Unreal Engine installed. In order to renderthe requested job, it also needs to have the corresponding Unreal project installed.</p><p>Before a worker starts rendering a job, it first needs to fetch the latest changeof the Unreal project, this can be done using the versioning system supported byUnreal, like Unreal Game Sync with Perforce.</p><p>When a worker is brought online, it continuously works on the job assigned to it,then periodically pings the server for new jobs.</p><p>When a job is available, the worker launches an Unreal render process from thecommand line and calls for the custom Unreal Python executor.</p><h3 id="unreal-custom-executor"><a class="markdownIt-Anchor" href="#unreal-custom-executor"></a> Unreal Custom Executor</h3><p>An Unreal custom executor instance is created using command line, for more detailplease read the blog regarding <a href="https://www.xingyulei.com/post/ue-rendering-custom-executor/">Unreal Movie Render Queue (MRQ) Custom Executor</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">render</span>(<span class="params">uid, umap_path, useq_path, uconfig_path</span>):</span><br><span class="line">    command = [</span><br><span class="line">        UNREAL_EXE,</span><br><span class="line">        UNREAL_PROJECT,</span><br><span class="line">        umap_path,</span><br><span class="line">        <span class="string">&quot;-JobId=&#123;&#125;&quot;</span>.<span class="built_in">format</span>(uid),</span><br><span class="line">        <span class="string">&quot;-LevelSequence=&#123;&#125;&quot;</span>.<span class="built_in">format</span>(useq_path),</span><br><span class="line">        <span class="string">&quot;-MoviePipelineConfig=&#123;&#125;&quot;</span>.<span class="built_in">format</span>(uconfig_path),</span><br><span class="line">        <span class="string">&quot;-game&quot;</span>,</span><br><span class="line">        <span class="string">&quot;-MoviePipelineLocalExecutorClass=/Script/MovieRenderPipelineCore.MoviePipelinePythonHostExecutor&quot;</span>,</span><br><span class="line">        <span class="string">&quot;-ExecutorPythonClass=/Engine/PythonTypes.MyExecutor&quot;</span>,</span><br><span class="line">    ]</span><br><span class="line">    env = os.environ.copy()</span><br><span class="line">    env[<span class="string">&quot;UE_PYTHONPATH&quot;</span>] = MODULE_PATH</span><br><span class="line">    proc = subprocess.Popen(</span><br><span class="line">        command,</span><br><span class="line">        stdout=subprocess.PIPE,</span><br><span class="line">        stderr=subprocess.PIPE,</span><br><span class="line">        env=env</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> proc.communicate()</span><br></pre></td></tr></table></figure><p>Within the executor class, a PUT request is sent to the server afterevery frame render with the latest time remaining estimate and overallpipeline progress.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@unreal.uclass()</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyExecutor</span>(unreal.MoviePipelinePythonHostExecutor):</span><br><span class="line">  </span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"><span class="meta">    @unreal.ufunction(<span class="params">override=<span class="literal">True</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_begin_frame</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(MyExecutor, self).on_begin_frame()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.pipeline:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        status = renderRequest.RenderStatus.in_progress</span><br><span class="line">        progress = <span class="number">100</span> * unreal.MoviePipelineLibrary.\</span><br><span class="line">            get_completion_percentage(self.pipeline)</span><br><span class="line">        time_estimate = unreal.MoviePipelineLibrary.\</span><br><span class="line">            get_estimated_time_remaining(self.pipeline)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> time_estimate:</span><br><span class="line">            time_estimate = unreal.Timespan.MAX_VALUE</span><br><span class="line"></span><br><span class="line">        days, hours, minutes, seconds, _ = time_estimate.to_tuple()</span><br><span class="line">        time_estimate = <span class="string">&#x27;&#123;&#125;h:&#123;&#125;m:&#123;&#125;s&#x27;</span>.<span class="built_in">format</span>(hours, minutes, seconds)</span><br><span class="line"></span><br><span class="line">        self.send_http_request(</span><br><span class="line">            <span class="string">&#x27;&#123;&#125;/put/&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(client.SERVER_API_URL, self.job_id),</span><br><span class="line">            <span class="string">&quot;PUT&quot;</span>,</span><br><span class="line">            <span class="string">&#x27;&#123;&#125;;&#123;&#125;;&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(progress, time_estimate, status),</span><br><span class="line">            unreal.Map(<span class="built_in">str</span>, <span class="built_in">str</span>)</span><br><span class="line">        )</span><br></pre></td></tr></table></figure><h2 id="conclusion"><a class="markdownIt-Anchor" href="#conclusion"></a> Conclusion</h2><p>And that’s concludes the break-down of my dummy distributed rendering system; onceagain the complete project source code can be found <a href="https://github.com/leixingyu/unrealRenderFarm">here</a>along with a <a href="https://youtu.be/4pGhaMQACy8">video demo</a></p><p>There are still lots of components that can be expanded further, namely the jobcoordination functionality, the web application implementation(can replace the submitter), the database implementation and actually testingthis across multiple machines in a network. Unfortunately, I don’t have theresources to touch upon these.</p><p>Hope this is useful and see you in the next blog!</p><h2 id="references"><a class="markdownIt-Anchor" href="#references"></a> References</h2><p><a href="https://youtu.be/30AtJT8yoR8">YouTube - UE4 | Creating a Swarm Farm</a></p><p><a href="https://youtu.be/FNhUnPWzVaw">YouTube - DIY Renderfarm Building Tutorial for Distributed Blender Rendering</a></p><p><a href="https://www.cgdirector.com/how-to-build-your-own-render-farm/">CG Director - How to Build your own Render Farm [Ultimate Guide]</a></p>]]></content>
    
    
    <summary type="html">Get started with implementing an Unreal Distributed Rendering Server for your render farm using our comprehensive handbook. Our step-by-step guide provides practical examples and best practices for setting up a scalable and efficient rendering environment that meets your specific needs. Whether you&#39;re a beginner or an advanced user, our handbook will help you master the techniques needed to implement an Unreal Distributed Rendering Server and streamline your rendering pipeline</summary>
    
    
    
    <category term="unreal cinematic" scheme="https://www.xingyulei.com/categories/unreal-cinematic/"/>
    
    
    <category term="rendering" scheme="https://www.xingyulei.com/tags/rendering/"/>
    
    <category term="unreal" scheme="https://www.xingyulei.com/tags/unreal/"/>
    
    <category term="python" scheme="https://www.xingyulei.com/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>Render with Unreal Custom Movie Render Queue (MRQ) Executors</title>
    <link href="https://www.xingyulei.com/post/ue-rendering-custom-executor/"/>
    <id>https://www.xingyulei.com/post/ue-rendering-custom-executor/</id>
    <published>2023-01-16T08:00:00.000Z</published>
    <updated>2023-11-03T04:05:12.323Z</updated>
    
    <content type="html"><![CDATA[<h2 id="introduction"><a class="markdownIt-Anchor" href="#introduction"></a> Introduction</h2><p>In an earlier blog: <a href="https://www.xingyulei.com/post/ue-rendering-basic/">Learn to Automate Unreal Rendering Using Python</a>I mentioned how Unreal Movie Render Queue (MRQ) is more powerful than the legacyMovie Scene Capture but didn’t really have time to show it.</p><p>In this blog,I will create a customized Unreal Python executor using the Movie Render PipelinePlugin; The example script provided by Epic can be found here:<em>“Engine\Plugins\MovieScene\MovieRenderPipeline\Content\Python\<a href="http://MoviePipelineExampleRuntimeExecutor.py">MoviePipelineExampleRuntimeExecutor.py</a>”</em></p><h2 id="walk-through"><a class="markdownIt-Anchor" href="#walk-through"></a> Walk-through</h2><p>We can find the example code provided by Epic mentioned above, orfrom my render farm tool located <a href="https://www.xingyulei.com/post/ue-rendering-remote-farm">here</a></p><h3 id="executor-class"><a class="markdownIt-Anchor" href="#executor-class"></a> Executor Class</h3><blockquote><p>An “executor,” which is responsible for deciding how a queueis rendered, giving you complete control over the before, during,and after of each render.</p></blockquote><p>The Python class inherit from the <code>unreal.MoviePipelinePythonHostExecutor</code>,is a class override which allows us to make an executor that can process renderjobs in an Unreal standalone commandline launch with ‘-game’ flag;It also providesasync HTTP request functionality, which can be useful in implementing remote rendering.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unreal</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@unreal.uclass()</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyExecutor</span>(unreal.MoviePipelinePythonHostExecutor):</span><br><span class="line"> </span><br><span class="line">    pipeline = unreal.uproperty(unreal.MoviePipeline)</span><br><span class="line">    queue = unreal.uproperty(unreal.MoviePipelineQueue)</span><br><span class="line">    job_id = unreal.uproperty(unreal.Text)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_post_init</span>(<span class="params">self</span>):</span><br><span class="line">        self.pipeline = <span class="literal">None</span></span><br><span class="line">        self.queue = <span class="literal">None</span></span><br><span class="line">        self.job_id = <span class="literal">None</span></span><br></pre></td></tr></table></figure><p>Instead of using <code>__init__()</code> function in Python, the <code>_post_init()</code> gets called when created by C++ or Python.</p><p>Per the example provided by Unreal, this is also how we declare class properties/variables,which we have to specify the type.</p><blockquote><p>Python classes are transient, to allow C++ to spawn a Pythontype, we have to specify the type as a member variable. There is specialcode in C++ which checks that type and spawns that type (instead of the default)</p></blockquote><h3 id="executed-delayed"><a class="markdownIt-Anchor" href="#executed-delayed"></a> Executed Delayed</h3><p>The <code>execute_delayed()</code> is called once the map has finished loading and theexecutor has fully instantiated.</p><p>This is the best place to parse commandline arguments and connect to socket,and also where we can initialize a render job using the commandline arguments.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@unreal.ufunction(<span class="params">override=<span class="literal">True</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">execute_delayed</span>(<span class="params">self, queue</span>):</span><br><span class="line">    <span class="comment"># parse commandline</span></span><br><span class="line">    (cmd_tokens, cmd_switches, cmd_parameters) = unreal.SystemLibrary.\</span><br><span class="line">        parse_command_line(unreal.SystemLibrary.get_command_line())</span><br><span class="line"></span><br><span class="line">    self.map_path = cmd_tokens[<span class="number">0</span>]</span><br><span class="line">    self.job_id = cmd_parameters[<span class="string">&#x27;JobId&#x27;</span>]</span><br><span class="line">    self.seq_path = cmd_parameters[<span class="string">&#x27;LevelSequence&#x27;</span>]</span><br><span class="line">    self.preset_path = cmd_parameters[<span class="string">&#x27;MoviePipelineConfig&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># initialize pipeline</span></span><br><span class="line">    self.pipeline = unreal.new_object(</span><br><span class="line">        self.target_pipeline_class,</span><br><span class="line">        outer=self.get_last_loaded_world(),</span><br><span class="line">        base_type=unreal.MoviePipeline</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># initialize queue</span></span><br><span class="line">    self.queue = unreal.new_object(unreal.MoviePipelineQueue, outer=self)</span><br><span class="line">    job = self.queue.allocate_new_job(unreal.MoviePipelineExecutorJob)</span><br><span class="line">    job.<span class="built_in">map</span> = unreal.SoftObjectPath(self.map_path)</span><br><span class="line">    job.sequence = unreal.SoftObjectPath(self.seq_path)</span><br><span class="line"></span><br><span class="line">    preset_path = unreal.SoftObjectPath(self.preset_path)</span><br><span class="line">    u_preset = unreal.SystemLibrary.\</span><br><span class="line">        conv_soft_obj_path_to_soft_obj_ref(preset_path)</span><br><span class="line">    job.set_configuration(u_preset)</span><br><span class="line">    self.pipeline.initialize(job)</span><br></pre></td></tr></table></figure><h3 id="add-callbacks"><a class="markdownIt-Anchor" href="#add-callbacks"></a> Add Callbacks</h3><p>In the <code>execute_delayed()</code> method, we can add callback functionswhen the current pipeline job has finished and when the entire pipeline has finished.We even havecontrol over when the pipeline has finished processing individual shots ofa render job’s sequence using: <code>on_movie_pipeline_shot_work_finished_delegate</code>.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">self.pipeline.on_movie_pipeline_finished_delegate.add_function_unique(</span><br><span class="line">    self,</span><br><span class="line">    <span class="string">&quot;on_job_finished&quot;</span></span><br><span class="line">)</span><br><span class="line">self.pipeline.on_movie_pipeline_work_finished_delegate.add_function_unique(</span><br><span class="line">    self,</span><br><span class="line">    <span class="string">&quot;on_pipeline_finished&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>There are also callback functions for socket message received: <code>socket_message_recieved_delete</code> andhttp response received: <code>http_response_recieved_delegate</code>. We couldregister those in the <code>_post_init()</code> method.</p><p>The <code>on_begin_frame()</code> built-in callback function is called once every frame,which can be used to update elapse time, remaining time and the completion percentage of the pipeline.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@unreal.ufunction(<span class="params">override=<span class="literal">True</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">on_begin_frame</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="built_in">super</span>(MyExecutor, self).on_begin_frame()        </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> self.pipeline:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">    unreal.log(unreal.MoviePipelineLibrary.get_completion_percentage(self.pipeline))</span><br></pre></td></tr></table></figure><h4 id="pipeline-finished-callbacks"><a class="markdownIt-Anchor" href="#pipeline-finished-callbacks"></a> Pipeline Finished Callbacks</h4><p>Here’s how I implement the job finished callback<code>on_movie_pipeline_finished_delegate</code> and pipeline finished callback <code>on_movie_pipeline_work_finished_delegate</code>.</p><p>After a job has finished, I manually called the <code>on_executor_finished_impl()</code>which marks the end of the render;But if there were more than one job to process per execution (for example, a multi-passrender), we should processthe next job of a render pass during this callback function instead of ending it.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@unreal.ufunction(<span class="params">ret=<span class="literal">None</span>, params=[unreal.MoviePipeline, <span class="built_in">bool</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">on_job_finished</span>(<span class="params">self, pipeline, error</span>):</span><br><span class="line">    self.pipeline = <span class="literal">None</span></span><br><span class="line">    unreal.log(<span class="string">&quot;Finished rendering movie!&quot;</span>)</span><br><span class="line">    self.on_executor_finished_impl()</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="meta">@unreal.ufunction(<span class="params">ret=<span class="literal">None</span>, params=[unreal.MoviePipelineOutputData]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">on_pipeline_finished</span>(<span class="params">self, results</span>):</span><br><span class="line">    output_data = results</span><br><span class="line">    <span class="keyword">if</span> output_data.success:</span><br><span class="line">        <span class="keyword">for</span> shot_data <span class="keyword">in</span> output_data.shot_data:</span><br><span class="line">            render_pass_data = shot_data.render_pass_data</span><br><span class="line">            <span class="keyword">for</span> k, v <span class="keyword">in</span> render_pass_data.items():</span><br><span class="line">                <span class="keyword">if</span> k.name == <span class="string">&#x27;FinalImage&#x27;</span>:</span><br><span class="line">                    outputs = v.file_paths</span><br><span class="line">                    <span class="comment"># get all final output images</span></span><br><span class="line">                    unreal.log(outputs)</span><br></pre></td></tr></table></figure><h3 id="using-commandline"><a class="markdownIt-Anchor" href="#using-commandline"></a> Using Commandline</h3><p>In the <code>init_unreal.py</code> Unreal startup script, we should include the module where we declaredthe customized python class.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># init_unreal.py</span></span><br><span class="line"><span class="keyword">import</span> myExecutor</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># myExecutor.py</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyExecutor</span>(unreal.MoviePipelinePythonHostExecutor):</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p>Now in the commandline, we need to include<code>-MoviePipelineLocalExecutorClass=/Script/MovieRenderPipelineCore.MoviePipelinePythonHostExecutor</code>and then<code>-ExecutorPythonClass=/Engine/PythonTypes.MyExecutor</code> which isthe custom python executor class.</p><p>An example of the full commandline arguments can be found as follows,I also included the “-JobId” custom flag which we are able to parse above.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">command = [</span><br><span class="line">    UNREAL_EXE,</span><br><span class="line">    UNREAL_PROJECT,</span><br><span class="line"></span><br><span class="line">    umap_path,</span><br><span class="line">    <span class="string">&quot;-JobId=a5qo3e80&quot;</span>,</span><br><span class="line">    <span class="string">&quot;-LevelSequence=&#123;&#125;&quot;</span>.<span class="built_in">format</span>(useq_path),</span><br><span class="line">    <span class="string">&quot;-MoviePipelineConfig=&#123;&#125;&quot;</span>.<span class="built_in">format</span>(uconfig_path),</span><br><span class="line"></span><br><span class="line">    <span class="comment"># required</span></span><br><span class="line">    <span class="string">&quot;-game&quot;</span>,</span><br><span class="line">    <span class="string">&quot;-MoviePipelineLocalExecutorClass=/Script/MovieRenderPipelineCore.MoviePipelinePythonHostExecutor&quot;</span>,</span><br><span class="line">    <span class="string">&quot;-ExecutorPythonClass=/Engine/PythonTypes.MyExecutor&quot;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># render preview</span></span><br><span class="line">    <span class="string">&quot;-windowed&quot;</span>,</span><br><span class="line">    <span class="string">&quot;-resX=1280&quot;</span>,</span><br><span class="line">    <span class="string">&quot;-resY=720&quot;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># logging</span></span><br><span class="line">    <span class="string">&quot;-StdOut&quot;</span>,</span><br><span class="line">    <span class="string">&quot;-FullStdOutLogOutput&quot;</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="preset"><a class="markdownIt-Anchor" href="#preset"></a> Preset</h3><p>For convenience, I created a custom Unreal render preset classto easily overwrite configuration settings by passing in custom flags.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unreal</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@unreal.uclass()</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyPreset</span>(unreal.MoviePipelineMasterConfig):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, preset</span>):</span><br><span class="line">        <span class="built_in">super</span>(MyPreset, self).__init__(preset)</span><br><span class="line">        self.copy_from(preset)</span><br><span class="line"></span><br><span class="line">        self.set_flush_disk()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @unreal.ufunction(<span class="params">ret=<span class="literal">None</span>, params=[]</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_flush_disk</span>(<span class="params">self</span>):</span><br><span class="line">        u_setting = self.find_setting_by_class(</span><br><span class="line">            unreal.MoviePipelineOutputSetting</span><br><span class="line">        )</span><br><span class="line">        u_setting.flush_disk_writes_per_shot = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_base_preset</span>(<span class="params">cls</span>):</span><br><span class="line">        u_preset = unreal.MoviePipelineMasterConfig()</span><br><span class="line">        u_setting = u_preset.find_setting_by_class(</span><br><span class="line">            unreal.MoviePipelineOutputSetting</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># A job should have a render pass and a file output.</span></span><br><span class="line">        u_setting.output_resolution = unreal.IntPoint(<span class="number">1280</span>, <span class="number">720</span>)</span><br><span class="line"></span><br><span class="line">        render_pass = u_preset.find_or_add_setting_by_class(</span><br><span class="line">            unreal.MoviePipelineDeferredPassBase</span><br><span class="line">        )</span><br><span class="line">        render_pass.disable_multisample_effects = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        u_preset.find_or_add_setting_by_class(</span><br><span class="line">            unreal.MoviePipelineImageSequenceOutput_PNG</span><br><span class="line">        )</span><br><span class="line">        u_preset.initialize_transient_settings()</span><br><span class="line">        <span class="keyword">return</span> cls(u_preset)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">output_path</span>(<span class="params">self</span>):</span><br><span class="line">        u_setting = self.find_setting_by_class(</span><br><span class="line">            unreal.MoviePipelineOutputSetting</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">return</span> u_setting.get_editor_property(<span class="string">&#x27;output_directory&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @unreal.ufunction(<span class="params">ret=<span class="literal">None</span>, params=[<span class="built_in">str</span>]</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_output_path</span>(<span class="params">self, path</span>):</span><br><span class="line">        u_setting = self.find_setting_by_class(</span><br><span class="line">            unreal.MoviePipelineOutputSetting</span><br><span class="line">        )</span><br><span class="line">        u_setting.set_editor_property(</span><br><span class="line">            <span class="string">&#x27;output_directory&#x27;</span>,</span><br><span class="line">            unreal.DirectoryPath(path)</span><br><span class="line">        )</span><br></pre></td></tr></table></figure><p>This can be used like such, the benefit of this is that it will use a base preset.uasset and create a temporary copy of it to overwrite settings. Once used, thepreset created are discarded.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@unreal.ufunction(<span class="params">override=<span class="literal">True</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">execute_delayed</span>(<span class="params">self, queue</span>):</span><br><span class="line">    <span class="comment"># parse commandline</span></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    self.preset_path = cmd_parameters[<span class="string">&#x27;MoviePipelineConfig&#x27;</span>]</span><br><span class="line">    self.output_path = cmd_parameters[<span class="string">&#x27;OutputDirectory&#x27;</span>]</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    preset_path = unreal.SoftObjectPath(self.preset_path)</span><br><span class="line">    u_preset = unreal.SystemLibrary.conv_soft_obj_path_to_soft_obj_ref(preset_path)</span><br><span class="line">    my_preset = MyPreset(u_preset)</span><br><span class="line">    my_preset.set_output_path(self.output_path)</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><h2 id="reference"><a class="markdownIt-Anchor" href="#reference"></a> Reference</h2><p><a href="https://dev.epicgames.com/community/learning/tutorials/nZ2e/command-line-rendering-with-unreal-engine-movie-render-queue">Unreal Forum - Command Line Rendering With Unreal Engine Movie Render Queue</a></p>]]></content>
    
    
    <summary type="html">Take your Unreal movie renders to the next level with our tutorial on custom MRQ executors. Learn how to optimize your rendering workflow, improve efficiency, and achieve better results with our step-by-step guide. Whether you&#39;re a beginner or an advanced user, our practical examples and best practices will help you master the techniques needed to create stunning movie renders using Unreal and custom MRQ executors.</summary>
    
    
    
    <category term="unreal cinematic" scheme="https://www.xingyulei.com/categories/unreal-cinematic/"/>
    
    
    <category term="pipeline" scheme="https://www.xingyulei.com/tags/pipeline/"/>
    
    <category term="rendering" scheme="https://www.xingyulei.com/tags/rendering/"/>
    
    <category term="unreal" scheme="https://www.xingyulei.com/tags/unreal/"/>
    
    <category term="python" scheme="https://www.xingyulei.com/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>Python REST API: Build and Deploy Custom Server</title>
    <link href="https://www.xingyulei.com/post/py-http-server/"/>
    <id>https://www.xingyulei.com/post/py-http-server/</id>
    <published>2023-01-07T08:00:00.000Z</published>
    <updated>2023-11-03T03:53:32.861Z</updated>
    
    <content type="html"><![CDATA[<h2 id="http-server-basic"><a class="markdownIt-Anchor" href="#http-server-basic"></a> HTTP Server Basic</h2><p>In a client-server model, HTTP server plays the role of a server and implementsusing HTTP/HTTPS network protocol. HTTP runs on a socket and uses TCP/IP connection,but is a higher-level connection that takes care of the send and receive processin a predefined format.</p><h3 id="request-and-respond"><a class="markdownIt-Anchor" href="#request-and-respond"></a> Request and Respond</h3><p>An HTTP request contains a URL, a method, a header and a body;“POST” and “GET” are the two most common request methods:</p><ul><li><strong>&quot;POST&quot;</strong>: from the client submits information to the server</li><li><strong>&quot;GET&quot;</strong>: from the client expect information back from the server</li></ul><p>A response is what the client receives from the server in answer to the HTTPrequest. An HTTP response contains a status code, a header and a body</p><h3 id="rest-api"><a class="markdownIt-Anchor" href="#rest-api"></a> Rest API</h3><p>A REST (also known as RESTful) API is a web API that conforms to the constraints ofREST (representational state transfer) architectural style and allows for interaction with RESTful web services.</p><p>When a client request is made via a RESTful API,it transfers a representation of the state of the resource to the requester or endpoint.</p><p>The touch point of this request/communication is the endpoint. Each endpoint isthe location (URL of a service) from which APIs can access the resources they need to carry out theirfunction. The resource or information is delivered in one of several formats via HTTP(JSON being the most popular).</p><h2 id="using-httpserver"><a class="markdownIt-Anchor" href="#using-httpserver"></a> Using <code>http.server</code></h2><p>To build a simple HTTP Server with “POST” and “GET” methods:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> http.server <span class="keyword">import</span> BaseHTTPRequestHandler, HTTPServer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LocalData</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    records = &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HTTPRequestHandler</span>(<span class="title class_ inherited__">BaseHTTPRequestHandler</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">do_POST</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> re.search(<span class="string">&#x27;/api/post/*&#x27;</span>, self.path):</span><br><span class="line">            length = <span class="built_in">int</span>(self.headers.get(<span class="string">&#x27;content-length&#x27;</span>))</span><br><span class="line">            data = self.rfile.read(length).decode(<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">            record_id = self.path.split(<span class="string">&#x27;/&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">            LocalData.records[record_id] = data</span><br><span class="line"></span><br><span class="line">            logging.info(<span class="string">&quot;add record %s: %s&quot;</span>, record_id, data)</span><br><span class="line">            self.send_response(<span class="number">200</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.send_response(<span class="number">403</span>)</span><br><span class="line">        self.end_headers()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">do_GET</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> re.search(<span class="string">&#x27;/api/get/*&#x27;</span>, self.path):</span><br><span class="line">            record_id = self.path.split(<span class="string">&#x27;/&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">            <span class="keyword">if</span> record_id <span class="keyword">in</span> LocalData.records:</span><br><span class="line">                self.send_response(<span class="number">200</span>)</span><br><span class="line">                self.send_header(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;application/json&#x27;</span>)</span><br><span class="line">                self.end_headers()</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Return json, even though it came in as POST URL params</span></span><br><span class="line">                data = json.dumps(LocalData.records[record_id]).encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">                logging.info(<span class="string">&quot;get record %s: %s&quot;</span>, record_id, data)</span><br><span class="line">                self.wfile.write(data)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.send_response(<span class="number">404</span>, <span class="string">&#x27;Not Found: record does not exist&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.send_response(<span class="number">403</span>)</span><br><span class="line">        self.end_headers()</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    server = HTTPServer((<span class="string">&#x27;localhost&#x27;</span>, <span class="number">8000</span>), HTTPRequestHandler)</span><br><span class="line">    logging.info(<span class="string">&#x27;Starting httpd...\n&#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        server.serve_forever()</span><br><span class="line">    <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    server.server_close()</span><br><span class="line">    logging.info(<span class="string">&#x27;Stopping httpd...\n&#x27;</span>)</span><br></pre></td></tr></table></figure><p>On the client side, we’re utilizing the <code>requests</code> module for sending requests:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="built_in">id</span> = <span class="string">&#x27;test&#x27;</span></span><br><span class="line">data = &#123;<span class="string">&#x27;key&#x27;</span>: <span class="string">&#x27;value&#x27;</span>&#125;</span><br><span class="line">r = requests.post(<span class="string">&#x27;http://localhost:8000/api/post/&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">id</span>), json=data)</span><br></pre></td></tr></table></figure><p>Here, we send a “POST” method request to access the <code>http://localhost:8000/api/post</code>endpoint which added a dictionarytype data payload. The data has an id of <code>test</code> and content of <code>&#123;'key': 'value'&#125;</code>.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">id</span> = <span class="string">&#x27;test&#x27;</span></span><br><span class="line">r = requests.get(<span class="string">&#x27;http://localhost:8000/api/get/&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">id</span>))</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure><p>Then, we can send a “GET” request to retrieve the data we just addedby accessing another endpoint <code>http://localhost:8000/api/get/</code>;this can be done either through a browser with the corresponding id(<a href="http://localhost:8000/api/get/test">http://localhost:8000/api/get/test</a>), or by sending an HTTP “GET” request using<code>requests</code> module.</p><p>The response from the server gives the output: <code>&#123;'key': 'value'&#125;</code></p><p><img src="https://i.imgur.com/qNFlDFS.jpg" alt="result" /></p><h2 id="using-flask"><a class="markdownIt-Anchor" href="#using-flask"></a> Using <code>flask</code></h2><blockquote><p>Flask is a micro web framework written in Python</p></blockquote><p>I am going to re-created the HTTP server above with “POST” and “GET” endpointsusing <code>flask</code>, this is much simpler:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LocalData</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    records = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># POST endpoint</span></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&#x27;/api/post/&lt;id&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_entry</span>(<span class="params"><span class="built_in">id</span></span>):</span><br><span class="line">    data = request.get_json(force=<span class="literal">True</span>)</span><br><span class="line">    LocalData.records[<span class="built_in">id</span>] = data</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># GET endpoint</span></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&#x27;/api/get/&lt;id&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_record</span>(<span class="params"><span class="built_in">id</span></span>):</span><br><span class="line">    <span class="keyword">return</span> LocalData.records[<span class="built_in">id</span>]</span><br></pre></td></tr></table></figure><p>Now to run the server, we run the following command <code>flask --app &lt;appName.py&gt; run</code>;Additional <code>--debug</code> flag can be added before <code>run</code> to auto reload the latest scriptchange when debugging.</p><h3 id="rendering-webpage"><a class="markdownIt-Anchor" href="#rendering-webpage"></a> Rendering Webpage</h3><p>One of the common cases, when hosting an HTML server, is that users have the abilityaccess our endpoint with their browser. Instead of spitting out raw data, we oftenwant to format it to a nice HTML page.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index_page</span>():</span><br><span class="line">    datas = get_all_local_datas()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> datas:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Welcome!&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, jsons=datas)</span><br></pre></td></tr></table></figure><p>Here we are specifying an ‘index.html’ landing page using the root path (’’),then a dummpy function that gets all the data from our storage (e.g. database).</p><p><strong>For HTML</strong></p><ul><li><p>We can pass in the datas to a variable named <code>json</code> which is defined in the .html:</p>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;jsons&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>Note: it is required that the .html files rest in a folder called “templates”,unless we overwrite that configuration.</p></li></ul><p><strong>For JavaScript</strong></p><ul><li><p>In javascript, we need to use a <code>jinja2</code> filter:</p>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-handlebars"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">    myfunc( </span><span class="template-variable">&#123;&#123;<span class="name">jsons</span>|tojson|safe&#125;&#125;</span><span class="language-xml"> );</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="linking-external-files"><a class="markdownIt-Anchor" href="#linking-external-files"></a> Linking External Files</h3><p>If you would like to include additional external <code>.js</code> or <code>.css</code> files,they all need to rest in a folder called “static”.</p><p>Linking the files can then be done as such:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span> = <span class="string">&#123;&#123;url_for(</span>&#x27;<span class="attr">static</span>&#x27;, <span class="attr">filename</span>=<span class="string">&quot;myJS.js&quot;</span>)&#125;&#125;&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> <span class="attr">href</span>= <span class="string">&#123;&#123;url_for(</span>&#x27;<span class="attr">static</span>&#x27;, <span class="attr">filename</span>=<span class="string">&quot;main.css&quot;</span>)&#125;&#125;&gt;</span></span><br></pre></td></tr></table></figure><h2 id="references"><a class="markdownIt-Anchor" href="#references"></a> References</h2><p><a href="https://www.cloudflare.com/learning/ddos/glossary/hypertext-transfer-protocol-http/">Cloud Flare - What is HTTP?</a></p><p><a href="https://www.redhat.com/en/topics/api/what-is-a-rest-api">Red Hat - What is a REST API</a></p><p><a href="https://flask.palletsprojects.com/en/2.2.x/">Flask</a></p><p><a href="https://www.linode.com/docs/guides/create-restful-api-using-python-and-flask/">Linode - Create a RESTful API Using Python and Flask</a></p><p><a href="https://stackoverflow.com/questions/15108139/">Stack Overflow - Difference between socket programing and http programming</a></p><p><a href="https://stackoverflow.com/questions/45149420">Stack Overflow - Pass Variable from python (flask) to HTML in render template?</a></p><p><a href="https://gist.github.com/dfrankow/f91aefd683ece8e696c26e183d696c29">GitHub Gist - simple_server.py by dfrankow</a></p>]]></content>
    
    
    <summary type="html">Learn how to build and deploy your own custom Python REST API server with our comprehensive tutorial. Our step-by-step guide provides practical examples and best practices for creating a secure, scalable, and reliable server that meets your specific needs. Whether you&#39;re a beginner or an advanced user, our tutorial will help you master the techniques needed to build and deploy your own custom Python REST API server</summary>
    
    
    
    <category term="learning log" scheme="https://www.xingyulei.com/categories/learning-log/"/>
    
    
    <category term="python" scheme="https://www.xingyulei.com/tags/python/"/>
    
    <category term="server" scheme="https://www.xingyulei.com/tags/server/"/>
    
  </entry>
  
  <entry>
    <title>Unreal Rendering Workflow with Python Automation</title>
    <link href="https://www.xingyulei.com/post/ue-rendering-basic/"/>
    <id>https://www.xingyulei.com/post/ue-rendering-basic/</id>
    <published>2022-12-03T08:00:00.000Z</published>
    <updated>2023-11-03T04:04:37.408Z</updated>
    
    <content type="html"><![CDATA[<h2 id="introduction"><a class="markdownIt-Anchor" href="#introduction"></a> Introduction</h2><p>In this post, I’ll cover Python automation using Movie Render Queue (MRQ) andMovie Scene Capture.</p><p>I’ll go over how to make Python tools to run in the Unreal Editor as wellas outside Unreal through command line; How to change settings and add call backs.</p><p>The MRQ is more preferred over Movie Scene Capture as it’s much more customizable,both in supported render setting and in automation (In a later post you’ll see).</p><h2 id="movie-render-queue"><a class="markdownIt-Anchor" href="#movie-render-queue"></a> Movie Render Queue</h2><blockquote><p>Movie Render Queue is a successor to the Sequencer Render Movie feature, and is built for higher quality, easier integration into production pipelines, and user extensibility. With Movie Render Queue you can accumulate multiple render samples together to produce the final output frame, which allows for higher quality anti-aliasing, radial motion blur, and reduced noise in ray tracing.</p></blockquote><p>The Movie Render Queue (MRQ) is the latest and the greatest from Unreal forRendering out cinematic, over the legacy Movie Scene Capture Tool.</p><p><img src="https://docs.unrealengine.com/4.26/Images/AnimatingObjects/Sequencer/Workflow/RenderAndExport/HighQualityMediaExport/settings2.webp" alt="MRQ" /></p><h3 id="movie-render-queue-in-editor"><a class="markdownIt-Anchor" href="#movie-render-queue-in-editor"></a> Movie Render Queue in Editor</h3><p>Here we can find the full example from Epic:<code>Engine\Plugins\MovieScene\MovieRenderPipeline\Content\Python\MoviePipelineEditorExample.py</code></p><h4 id="bare-minimal"><a class="markdownIt-Anchor" href="#bare-minimal"></a> Bare Minimal</h4><p>Through Unreal Editor, we use a render executor called PlayInEditor (PIE) executor.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">movie_queue_render</span>(<span class="params">u_level_file, u_level_seq_file, u_preset_file</span>):</span><br><span class="line">    subsystem = unreal.get_editor_subsystem(unreal.MoviePipelineQueueSubsystem)</span><br><span class="line">    queue = subsystem.get_queue()</span><br><span class="line">    executor = unreal.MoviePipelinePIEExecutor()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># config render job with movie pipeline config</span></span><br><span class="line">    job = queue.allocate_new_job(unreal.MoviePipelineExecutorJob)</span><br><span class="line">    job.job_name = <span class="string">&#x27;test&#x27;</span></span><br><span class="line">    job.<span class="built_in">map</span> = unreal.SoftObjectPath(u_level_file)</span><br><span class="line">    job.sequence = unreal.SoftObjectPath(u_level_seq_file)</span><br><span class="line">    preset = unreal.EditorAssetLibrary.find_asset_data(u_preset_file).get_asset()</span><br><span class="line">    job.set_configuration(preset)</span><br><span class="line">    </span><br><span class="line">    subsystem.render_queue_with_executor_instance(executor)</span><br></pre></td></tr></table></figure><h4 id="override-settings"><a class="markdownIt-Anchor" href="#override-settings"></a> Override Settings</h4><p>All the render settings are stored as an <code>unreal.MoviePipelineMasterConfig</code> object.</p><p>It has sub setting components class <code>unreal.MoviePipeline</code>, for example: <code>unreal.MoviePipelineOutputSetting</code>,<code>unreal.MoviePipelineCameraSetting</code>, <code>unreal.MoviePipelineColorSetting</code> and etc</p><p>Each Setting class then have properties, for <code>unreal.MoviePipelineOutputSetting</code>, it hasproperties such as:</p><ul><li><code>use_custom_frame_rate</code></li><li><code>frame_number_offset</code></li><li><code>output_directory</code></li><li>etc</li></ul><p>All of which can be modified, attached, and removed.</p><p>Example:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">uPreset = unreal.MoviePipelineMasterConfig()</span><br><span class="line">uSetting = uPreset.find_setting_by_class(unreal.MoviePipelineOutputSetting)</span><br><span class="line">uSetting.output_resolution = unreal.IntPoint(<span class="number">1280</span>, <span class="number">720</span>)</span><br></pre></td></tr></table></figure><h4 id="callback"><a class="markdownIt-Anchor" href="#callback"></a> Callback</h4><p>Callbacks can be added upon each Shot, Job, Queue Finished. The callback functionhas to be kept as global variable here to prevent it being destroyed by GC.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">render_finished</span>(<span class="params">params</span>):</span><br><span class="line">    unreal.log(params)</span><br><span class="line"></span><br><span class="line">executor.on_individual_job_work_finished_delegate.add_callable_unique(render_finished)</span><br></pre></td></tr></table></figure><p>or.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">render_errored</span>(<span class="params">executor, pipeline, is_fatal, error_msg</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">ERROR_CALLBACK = unreal.OnMoviePipelineExecutorErrored()</span><br><span class="line">ERROR_CALLBACK.add_callable(render_errored)</span><br><span class="line">exector.on_executor_errored_delegate = ERROR_CALLBACK</span><br></pre></td></tr></table></figure><p>See my convenient class for PIE here: <a href="https://github.com/leixingyu/unrealUtil/blob/master/render/render.py">https://github.com/leixingyu/unrealUtil/blob/master/render/render.py</a></p><h3 id="movie-render-queue-commandline"><a class="markdownIt-Anchor" href="#movie-render-queue-commandline"></a> Movie Render Queue Commandline</h3><p>The default MRQ command line offers customization by usingeither an Unreal Render Preset/Config asset or an Unreal Render Queue asset.</p><p>Since there are so many settings in the MRQ we can modify, it’s hard to exposeall of the little details through command line. If you do wish to do so, I havean entire blog about <a href="https://www.xingyulei.com/post/ue-rendering-custom-executor">Unreal MRQ Custom Executor</a>.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">movie_queue_render</span>(<span class="params">u_level_file, u_level_seq_file, u_preset_file</span>):</span><br><span class="line">    command = [</span><br><span class="line">        UNREAL_EXE,</span><br><span class="line">        U_PROJECT,</span><br><span class="line">        u_level_file,</span><br><span class="line"></span><br><span class="line">        <span class="comment"># required</span></span><br><span class="line">        <span class="string">&quot;-LevelSequence=%s&quot;</span> % u_level_seq_file,  <span class="comment"># The sequence to render</span></span><br><span class="line">        <span class="string">&quot;-MoviePipelineConfig=\&quot;%s\&quot;&quot;</span> % u_preset_file,</span><br><span class="line">        <span class="string">&quot;-game&quot;</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment"># options</span></span><br><span class="line">        <span class="string">&quot;-NoLoadingScreen&quot;</span>,</span><br><span class="line">        <span class="string">&quot;-log&quot;</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment"># window size not resolution</span></span><br><span class="line">        <span class="string">&quot;-Windowed&quot;</span>,</span><br><span class="line">        <span class="string">&quot;-ResX=800&quot;</span>,</span><br><span class="line">        <span class="string">&quot;-ResY=600&quot;</span>,</span><br><span class="line">    ]</span><br><span class="line">    proc = subprocess.Popen(command)</span><br><span class="line">    <span class="keyword">return</span> proc.communicate()</span><br></pre></td></tr></table></figure><h2 id="movie-scene-capture"><a class="markdownIt-Anchor" href="#movie-scene-capture"></a> Movie Scene Capture</h2><p><strong>Now this part may or may not be relevant anymore as many people treats theMovie Scene Capture as deprecated</strong>. But I thought I write it down anyway,as it might be helpful as a comparison to MRQ</p><h3 id="movie-scene-capture-editor"><a class="markdownIt-Anchor" href="#movie-scene-capture-editor"></a> Movie Scene Capture Editor</h3><p><img src="https://docs.unrealengine.com/4.27/Images/AnimatingObjects/Sequencer/Overview/RenderMovieSettings/MovieSettingsWindow.webp" alt="MSC" /></p><p>Here we can find an example from Epic:</p><p><code>Engine\Plugins\MovieScene\SequencerScripting\Content\Python\sequencer_examples.py</code></p><h4 id="bare-minimal-2"><a class="markdownIt-Anchor" href="#bare-minimal-2"></a> Bare Minimal</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unreal</span><br><span class="line">capture = unreal.AutomatedLevelSequenceCapture()</span><br><span class="line">capture.level_sequence_asset = unreal.SoftObjectPath(sequencer_path)</span><br><span class="line">unreal.SequencerTools.render_movie(capture, unreal.OnRenderMovieStopped())</span><br></pre></td></tr></table></figure><p>In this example, we only need to supply the path to the Unreal sequencer asset.</p><p>Note that the render happens in the current level, so make sure to pre-load the mapbefore running the Movie Scene Capture.</p><h4 id="callback-2"><a class="markdownIt-Anchor" href="#callback-2"></a> Callback</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">on_render_movie_finished</span>(<span class="params">success</span>):</span><br><span class="line">unreal.log(<span class="string">&quot;Movie has finished rendering&quot;</span>)</span><br><span class="line"></span><br><span class="line">on_finished_callback = unreal.OnRenderMovieStopped()</span><br><span class="line">on_finished_callback.bind_callable(on_render_movie_finished)</span><br></pre></td></tr></table></figure><p>Note the <code>on_finished_callback</code> is a global variable so it is persistent and won’tget destroyed during GC.</p><p>The next step is to register the callback function:<code>unreal.SequencerTools.render_movie(capture_settings, unreal.OnRenderMovieStopped())</code></p><h4 id="override-setting"><a class="markdownIt-Anchor" href="#override-setting"></a> Override Setting</h4><p>The settings can be modified through class <a href="https://docs.unrealengine.com/5.0/en-US/PythonAPI/class/MovieSceneCaptureSettings.html#unreal.MovieSceneCaptureSettings"><code>unreal.MovieSceneCaptureSettings</code></a></p><p>Example:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">capture = unreal.AutomatedLevelSequenceCapture()</span><br><span class="line">setting = capture.settings</span><br><span class="line">setting.output_directory = unreal.DirectoryPath(export_path)</span><br></pre></td></tr></table></figure><h3 id="movie-scene-capture-commandline"><a class="markdownIt-Anchor" href="#movie-scene-capture-commandline"></a> Movie Scene Capture Commandline</h3><p>A lot of custom flags can be specified through the command line, see the full listof control commands: <a href="https://docs.unrealengine.com/4.26/en-US/AnimatingObjects/Sequencer/Workflow/RenderAndExport/RenderingCmdLine/">Command Line Arguments for Rendering Movies</a></p><p>Console variables can even be set through command line which is decent.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">movie_scene_capture</span>(<span class="params">u_level_file, u_level_seq_file, output_folder</span>):</span><br><span class="line">    command = [</span><br><span class="line">        UNREAL_EXE,</span><br><span class="line">        U_PROJECT,</span><br><span class="line">        u_level_file,</span><br><span class="line"></span><br><span class="line">        <span class="comment"># required</span></span><br><span class="line">        <span class="string">&quot;-LevelSequence=%s&quot;</span> % u_level_seq_file,  <span class="comment"># The sequence to render</span></span><br><span class="line">        <span class="string">&quot;-MovieSceneCaptureType=/Script/MovieSceneCapture.AutomatedLevelSequenceCapture&quot;</span>,</span><br><span class="line">        <span class="string">&quot;-NoLoadingScreen&quot;</span>,</span><br><span class="line">        <span class="string">&quot;-game&quot;</span>,</span><br><span class="line">        <span class="string">&quot;-log&quot;</span>,</span><br><span class="line">        <span class="string">&quot;-MovieCinematicMode=yes&quot;</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment"># general property</span></span><br><span class="line">        <span class="string">&quot;-MovieFolder=%s&quot;</span> % output_folder,</span><br><span class="line"></span><br><span class="line">        <span class="comment"># if doing .avi</span></span><br><span class="line">        <span class="string">&quot;-MovieFormat=Video&quot;</span>,  <span class="comment"># JPG, BMP, PNG or Video</span></span><br><span class="line">        <span class="string">&quot;-MovieFrameRate=24&quot;</span>,</span><br><span class="line">        <span class="string">&quot;-MovieQuality=100&quot;</span>,  <span class="comment"># compression quality in percentage</span></span><br><span class="line">        <span class="string">&quot;-Windowed&quot;</span>,</span><br><span class="line">        <span class="string">&quot;-ResX=1920&quot;</span>,</span><br><span class="line">        <span class="string">&quot;-ResY=1080&quot;</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment"># other</span></span><br><span class="line">        <span class="string">&quot;-NoTextureStreaming&quot;</span>,  <span class="comment"># for final render</span></span><br><span class="line">        <span class="string">&quot;-NoScreenMessages&quot;</span>,  <span class="comment"># no screen debug message</span></span><br><span class="line">    ]</span><br><span class="line">    proc = subprocess.Popen(command)</span><br><span class="line">    <span class="keyword">return</span> proc.communicate()</span><br></pre></td></tr></table></figure><h2 id="additional-references"><a class="markdownIt-Anchor" href="#additional-references"></a> Additional References</h2><p><a href="https://forums.unrealengine.com/t/unable-to-execute-moviepipelinequeue-from-python/467250/5">Unreal Forums - Unable to execute MoviePipelineQueue from Python</a></p>]]></content>
    
    
    <summary type="html">Discover how to boost your Unreal rendering workflow with Python automation using our comprehensive tutorial. Our guide provides practical examples and best practices for optimizing your production pipeline, automating tedious tasks, and improving your overall efficiency. Whether you&#39;re a beginner or an advanced user, our step-by-step tutorial will help you master the techniques needed to take your Unreal rendering workflow to the next level with Python automation</summary>
    
    
    
    <category term="unreal cinematic" scheme="https://www.xingyulei.com/categories/unreal-cinematic/"/>
    
    
    <category term="rendering" scheme="https://www.xingyulei.com/tags/rendering/"/>
    
    <category term="unreal" scheme="https://www.xingyulei.com/tags/unreal/"/>
    
    <category term="python" scheme="https://www.xingyulei.com/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>Unreal Python Command Line: 3 Easy Methods</title>
    <link href="https://www.xingyulei.com/post/ue-commandline-python/"/>
    <id>https://www.xingyulei.com/post/ue-commandline-python/</id>
    <published>2022-11-06T07:00:00.000Z</published>
    <updated>2023-11-03T04:04:27.007Z</updated>
    
    <content type="html"><![CDATA[<h2 id="introduction"><a class="markdownIt-Anchor" href="#introduction"></a> Introduction</h2><p>The Unreal official documentation has two simple examples to run Python throughcommandline, one being Commandlet: a headless mode without even opening the Editor,the other one being the Full Editor mode which has Unreal Editor fully opened and loaded.</p><p>Do you know there’s actually a “third” way?And today, I’ll discuss my experience and preferences of using all of them.</p><h2 id="commandlet"><a class="markdownIt-Anchor" href="#commandlet"></a> Commandlet</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UnrealEditor.exe &quot;C:\projects\MyProject.uproject&quot; -run=pythonscript -script=&quot;c:\\my_script.py&quot;</span><br></pre></td></tr></table></figure><p>The “Commandlet” mode runs Unreal in headless mode without editor opened,this means no asset and level loading (but we have access to the <code>unreal</code> python module).</p><p>This is great if we want to write to the project (for example, importing/creatingassets), but it’s not going to work well for reading from the project.</p><h2 id="full-editor"><a class="markdownIt-Anchor" href="#full-editor"></a> Full Editor</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UnrealEditor.exe &quot;C:\projects\MyProject.uproject&quot; -ExecutePythonScript=&quot;c:\my_script.py&quot;</span><br></pre></td></tr></table></figure><p>Using “Full Editor” mode, we now have everything loaded in engine and are able to doalmost all operations, the trade-off being there’sa longer loading time, and also the editor will be opened.</p><p>Note that at this point, once the python script finishes executing, the editorand the command prompt window will close automatically.</p><h3 id="ui"><a class="markdownIt-Anchor" href="#ui"></a> UI</h3><p>If we ever needs to create a simple UI that launches from the “Full Editor” mode,we could do something like this in the python script.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> unreal</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">global</span> app</span><br><span class="line">    <span class="keyword">global</span> window</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> QtWidgets.QApplication.instance():</span><br><span class="line">        app = QtWidgets.QApplication(sys.argv)</span><br><span class="line"></span><br><span class="line">    window = TestWindow()</span><br><span class="line">    unreal.parent_external_window_to_slate(</span><br><span class="line">        window.winId().__init__(),</span><br><span class="line">        unreal.SlateParentWindowSearchMethod.ACTIVE_WINDOW</span><br><span class="line">    )</span><br><span class="line">    window.show()</span><br><span class="line">    sys.exit(app.exec_())</span><br></pre></td></tr></table></figure><p>Note that we are using <code>sys.exit(app.exec_())</code> to prevent the UI beingimmediately destroyed. This does mean the Qt event loop would take overthe main thread which renders Unreal editor non-interactable untilfunction calls hands over the process to Unreal.</p><p>However, I do find in rare cases(for example: when launching Movie Render Queue through commandline),either the UI still hangs the editor with the operation,or (without the UI) the editor just exit immediately after the operation is being called.Either of this will not let the render to finish.</p><p>This brings me to method number three that perfectly solves this issue.</p><h2 id="init-cmd"><a class="markdownIt-Anchor" href="#init-cmd"></a> Init Cmd</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UnrealEditor.exe &quot;C:\projects\MyProject.uproject&quot; -ExecCmds=&quot;py c:/my_script.py&quot;</span><br></pre></td></tr></table></figure><p>This method, although not present on Unreal Engine’s wiki, it is mentionedin the FAQ by the official Epic Games account on Linear Content Creation.</p><blockquote><p>For Automation/Testing we can pass the following to keep the editor running.</p><p>–ExecCmds=“py PathToPyFile”</p><p>Once we are done, we can call:unreal.SystemLibrary.execute_console_command(None,“QUIT_EDITOR”)</p></blockquote><p>This is almost like running a specified startup python script in Unreal,and the editor is fully interactable when the script is running.</p><p>The editor exit automatically when calling “QUIT_EDITOR”, if running a script with UI, we can hook upto the <code>closeEvent()</code>.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">closeEvent</span>(<span class="params">self, event</span>):</span><br><span class="line">    QtWidgets.QMainWindow.closeEvent(event)</span><br><span class="line">    unreal.SystemLibrary.execute_console_command(<span class="literal">None</span>, <span class="string">&quot;QUIT_EDITOR&quot;</span>)</span><br></pre></td></tr></table></figure><p>to override <code>closeEvent()</code> in instance-level instead of class-level, see <a href="https://www.xingyulei.com/post/qt-template/#unreal-engine">here</a></p><h2 id="logging"><a class="markdownIt-Anchor" href="#logging"></a> Logging</h2><p>To generate output from the commandline we can add two arguments: <code>-stdout</code>and <code>-FullStdOutLogOutput</code>.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">call</span>(<span class="params">python_script</span>):</span><br><span class="line">    command = [</span><br><span class="line">        UNREAL_EXE,</span><br><span class="line">        UPROJECT,</span><br><span class="line">        <span class="string">&quot;-ExecCmds=py &#123;&#125;&quot;</span>.<span class="built_in">format</span>(python_script),</span><br><span class="line">        <span class="string">&quot;-stdout&quot;</span>,</span><br><span class="line">        <span class="string">&quot;-FullStdOutLogOutput&quot;</span></span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    proc = subprocess.Popen(</span><br><span class="line">        command,</span><br><span class="line">        stdout=subprocess.PIPE,</span><br><span class="line">        stderr=subprocess.PIPE,</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> proc.communicate()</span><br></pre></td></tr></table></figure><p>and we can filter out only the log generated from Python as such</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">output = call(<span class="string">&#x27;python_script.py&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> <span class="built_in">str</span>(output).split(<span class="string">r&#x27;\r\n&#x27;</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;LogPython&#x27;</span> <span class="keyword">in</span> line:</span><br><span class="line">        <span class="built_in">print</span>(line)</span><br></pre></td></tr></table></figure><h2 id="environment"><a class="markdownIt-Anchor" href="#environment"></a> Environment</h2><p>Another thing to consider is that, running in batch mode can mess up our tools and start up scripts.due to it being a different environment. We might want to re-configure our environmentwhich we can do like such:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">env = os.environ.copy()</span><br><span class="line">env[<span class="string">&#x27;FOO&#x27;</span>] = <span class="string">&#x27;BAR&#x27;</span></span><br><span class="line"><span class="comment"># more env ...</span></span><br><span class="line"></span><br><span class="line">proc = subprocess.Popen(</span><br><span class="line">        command,</span><br><span class="line">        stdout=subprocess.PIPE,</span><br><span class="line">        stderr=subprocess.PIPE,</span><br><span class="line">        env=env</span><br><span class="line">    )</span><br></pre></td></tr></table></figure><h2 id="reference"><a class="markdownIt-Anchor" href="#reference"></a> Reference</h2><p><a href="https://docs.unrealengine.com/5.0/en-US/scripting-the-unreal-editor-using-python/">Unreal Doc - Scripting the Unreal Editor Using Python</a></p><p><a href="https://dev.epicgames.com/community/learning/courses/Oex/unreal-engine-technical-guide-to-linear-content-creation-faqs/XvO9/unreal-engine-common-questions">Unreal Forum - Unreal Engine Technical Guide to Linear Content Creation FAQs</a></p><p><a href="https://docs.adamrehn.com/ue4cli/descriptor-commands/run">Adamrehn Docs - UE4CLI</a></p>]]></content>
    
    
    <summary type="html">Unlock the power of Unreal Command Line with Python using our easy-to-follow tutorial. Learn three proven methods to automate tasks and enhance your Unreal Engine workflow with ease. Our step-by-step guide provides practical examples and best practices for leveraging the full potential of Python to simplify your development process. Whether you&#39;re a beginner or an advanced user, our tutorial will help you master the techniques needed to unlock the power of Unreal Command Line with Python.</summary>
    
    
    
    <category term="learning log" scheme="https://www.xingyulei.com/categories/learning-log/"/>
    
    
    <category term="unreal" scheme="https://www.xingyulei.com/tags/unreal/"/>
    
    <category term="python" scheme="https://www.xingyulei.com/tags/python/"/>
    
    <category term="batch" scheme="https://www.xingyulei.com/tags/batch/"/>
    
  </entry>
  
  <entry>
    <title>Learn How to Convert Transform Matrices between Maya, Unity and Unreal</title>
    <link href="https://www.xingyulei.com/post/math-xform-conversion/"/>
    <id>https://www.xingyulei.com/post/math-xform-conversion/</id>
    <published>2022-10-22T07:00:00.000Z</published>
    <updated>2023-11-03T03:45:07.247Z</updated>
    
    <content type="html"><![CDATA[<h1 id="introduction"><a class="markdownIt-Anchor" href="#introduction"></a> Introduction</h1><p>Have you noticed the different transform values when one asset is importedto a different package?</p><p>When we do .fbx importing and exporting, the plugin does this conversion forus. FBX is very reliable and hassle-free, but how does the math works?</p><blockquote><p><strong>Important:</strong> Before continuing, I highly recommend reading these previous posts</p><ul><li><a href="https://www.xingyulei.com/post/math-euler-gimbal/">Euler Angles</a></li><li><a href="https://www.xingyulei.com/post/math-change-of-basis/">Change of Basis</a></li></ul></blockquote><h2 id="transformation-value"><a class="markdownIt-Anchor" href="#transformation-value"></a> Transformation Value</h2><p>To demonstrate the different transform between DCCs,here I have some <em>‘axis’</em> object placed in Maya, Unity and Unreal.</p><img src="https://i.imgur.com/6z0QneT.jpg" alt="3in1" width="800px"><p>When inspecting the ‘axis’ located on the top-right, the transformationvalues are seen as follow:</p><table style="width: 800px">  <tr>    <th></th>    <th>translation</th>    <th>rotation</th>    <th>scale</th>  </tr>  <tr>    <td>Maya</td>    <td>x: -1.31, y: 0.33, z: 0.19</td>    <td>x: -335, y: -12, z: 98</td>    <td>x: 1, y: 1, z: 1</td></tr>  <tr>    <td>Unity</td>    <td>x: 1.31, y: 0.33, z: 0.19</td>    <td>x: 7, y: -27, z: -102</td>    <td>x: 1, y: 1, z: 1</td>  </tr>  <tr>    <td>Unreal</td>    <td>x: -1.31, y: 0.19, z: 0.33</td>    <td>x: 149, y: 75, z: 123</td>    <td>x: 1, y: 1, z: 1</td>  </tr></table><br/><p>Usually, for translation and scale there is a pattern to be found, usuallythe operation involves swapping values between axes, and flipping them. Forrotation, however, the values don’t seem to have connections between oneanother, so how can we compute them?</p><p>The fundamental reason for all of this is that even though all DCCs use aCartesian coordinate system, they have different <strong>axis direction</strong> and <strong>rotation order</strong>.</p><h1 id="methods-overview"><a class="markdownIt-Anchor" href="#methods-overview"></a> Methods Overview</h1><p>The method I use are all fundamental matrix calculation.</p><ol><li><p>From the source package, retrieve translation, rotation and scale (<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>t</mi><mrow><mi>s</mi><mi>o</mi><mi>u</mi><mi>r</mi><mi>c</mi><mi>e</mi></mrow></msub><mo separator="true">,</mo><msub><mi>r</mi><mrow><mi>s</mi><mi>o</mi><mi>u</mi><mi>r</mi><mi>c</mi><mi>e</mi></mrow></msub><mo separator="true">,</mo><msub><mi>s</mi><mrow><mi>s</mi><mi>o</mi><mi>u</mi><mi>r</mi><mi>c</mi><mi>e</mi></mrow></msub></mrow><annotation encoding="application/x-tex">t_{source}, r_{source}, s_{source}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.80952em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>)and compose a transformation matrix: <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>M</mi><mrow><mi>s</mi><mi>o</mi><mi>u</mi><mi>r</mi><mi>c</mi><mi>e</mi></mrow></msub></mrow><annotation encoding="application/x-tex">M_{source}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p></li><li><p>Convert the transformation matrix to the target software coordinate systemusing change of basis operation: <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>M</mi><mrow><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi></mrow></msub><mo>=</mo><msub><mi>M</mi><mrow><mi>c</mi><mi>o</mi><mi>b</mi></mrow></msub><mo>∗</mo><msub><mi>M</mi><mrow><mi>s</mi><mi>o</mi><mi>u</mi><mi>r</mi><mi>c</mi><mi>e</mi></mrow></msub><mo>∗</mo><msup><msub><mi>M</mi><mrow><mi>c</mi><mi>o</mi><mi>b</mi></mrow></msub><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">M_{target} = M_{cob} * M_{source} * {M_{cob}}^{-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.28055599999999997em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.0373379999999999em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.887338em;"><span style="top:-3.1362300000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span></p></li><li><p>Decompose the transformation matrix: <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>M</mi><mrow><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">M_{target}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.28055599999999997em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> and re-order thetarget translation, rotation and scale value such (<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>t</mi><mrow><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi></mrow></msub><mo separator="true">,</mo><msub><mi>r</mi><mrow><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi></mrow></msub><mo separator="true">,</mo><msub><mi>s</mi><mrow><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">t_{target}, r_{target}, s_{target}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9011879999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.28055599999999997em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.28055599999999997em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.28055599999999997em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>)</p></li></ol><h2 id="composition-and-de-composition"><a class="markdownIt-Anchor" href="#composition-and-de-composition"></a> Composition and De-composition</h2><p>It is helpful to re-visit the transform matrix calculation, but we will lateruse a math library to handle them.</p><ul><li><p><strong>Translation</strong>:</p><p>a translating along <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi><mo>=</mo><mo>&lt;</mo><msub><mi>d</mi><mi>x</mi></msub><mo separator="true">,</mo><msub><mi>d</mi><mi>y</mi></msub><mo separator="true">,</mo><msub><mi>d</mi><mi>z</mi></msub><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">t = &lt;d_x, d_y, d_z&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span></span><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span></span></span></span> can be thought as multiplying bythe translation matrix:<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>M</mi><mrow><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>l</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></msub><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>d</mi><mi>x</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>d</mi><mi>y</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>d</mi><mi>z</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">M_{translation} = \begin{bmatrix}1 &amp; 0 &amp; 0 &amp; d_x\\0 &amp; 1 &amp; 0 &amp; d_y\\0 &amp; 0 &amp; 1 &amp; d_z\\0 &amp; 0 &amp; 0 &amp; 1\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:4.80204em;vertical-align:-2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6520099999999998em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-2.80499em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.40599em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-4.65201em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6520099999999998em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-2.80499em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.40599em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-4.65201em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span></span></span></span></p></li><li><p><strong>Scale</strong>:</p><p>a scaling upon <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi><mo>=</mo><mo>&lt;</mo><msub><mi>β</mi><mi>x</mi></msub><mo separator="true">,</mo><msub><mi>β</mi><mi>y</mi></msub><mo separator="true">,</mo><msub><mi>β</mi><mi>z</mi></msub><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">s = &lt;\beta_x, \beta_y, \beta_z&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span></span><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05278em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.05278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05278em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.05278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05278em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.05278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span></span></span></span> can be thought as multiplyingby the scale matrix:<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>M</mi><mrow><mi>s</mi><mi>c</mi><mi>a</mi><mi>l</mi><mi>e</mi></mrow></msub><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>β</mi><mi>x</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>β</mi><mi>y</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>β</mi><mi>z</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">M_{scale} = \begin{bmatrix}\beta_x &amp; 0 &amp; 0 &amp; 0\\0 &amp; \beta_y &amp; 0 &amp; 0\\0 &amp; 0 &amp; \beta_z &amp; 0\\0 &amp; 0 &amp; 0 &amp; 1\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:4.80204em;vertical-align:-2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6520099999999998em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-2.80499em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.40599em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-4.65201em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.05278em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.05278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.05278em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.05278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.05278em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.05278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6520099999999998em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-2.80499em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.40599em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-4.65201em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span></span></span></span></p></li><li><p><strong>Shear</strong>: good to know, but not very commonly use;<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi><mi>h</mi><mo>=</mo><mo>&lt;</mo><mi>s</mi><msub><mi>h</mi><mi>x</mi></msub><mo separator="true">,</mo><mi>s</mi><msub><mi>h</mi><mi>y</mi></msub><mo separator="true">,</mo><mi>s</mi><msub><mi>h</mi><mi>z</mi></msub><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">sh = &lt;sh_x, sh_y, sh_z&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault">h</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span></span><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord mathdefault">s</span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">s</span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">s</span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span></span></span></span> represents shear along <em>x</em>, <em>y</em> and <em>z</em> axis;</p><p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>M</mi><mrow><mi>s</mi><msub><mi>h</mi><mi>x</mi></msub></mrow></msub><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>h</mi><mrow><mi>y</mi><mi>x</mi></mrow></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>h</mi><mrow><mi>z</mi><mi>x</mi></mrow></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">M_{sh_x} = \begin{bmatrix}1 &amp; 0 &amp; 0 &amp; 0\\h_{yx} &amp; 1 &amp; 0 &amp; 0\\h_{zx} &amp; 0 &amp; 1 &amp; 0\\0 &amp; 0 &amp; 0 &amp; 1 \\\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.93343em;vertical-align:-0.2501em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span><span class="mord mtight"><span class="mord mathdefault mtight">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:4.80204em;vertical-align:-2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6520099999999998em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-2.80499em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.40599em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-4.65201em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span><span class="mord mathdefault mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span><span class="mord mathdefault mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6520099999999998em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-2.80499em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.40599em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-4.65201em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span></span></span></span><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>M</mi><mrow><mi>s</mi><msub><mi>h</mi><mi>y</mi></msub></mrow></msub><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>h</mi><mrow><mi>x</mi><mi>y</mi></mrow></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>h</mi><mrow><mi>z</mi><mi>y</mi></mrow></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">M_{sh_y} = \begin{bmatrix}1 &amp; h_{xy} &amp; 0 &amp; 0\\0 &amp; 1 &amp; 0 &amp; 0\\0 &amp; h_{zy} &amp; 1 &amp; 0\\0 &amp; 0 &amp; 0 &amp; 1\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.03065em;vertical-align:-0.34731999999999996em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span><span class="mord mtight"><span class="mord mathdefault mtight">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285716em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.34731999999999996em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:4.80204em;vertical-align:-2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6520099999999998em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-2.80499em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.40599em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-4.65201em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6520099999999998em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-2.80499em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.40599em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-4.65201em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span></span></span></span><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>M</mi><mrow><mi>s</mi><msub><mi>h</mi><mi>z</mi></msub></mrow></msub><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>h</mi><mrow><mi>x</mi><mi>z</mi></mrow></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>h</mi><mrow><mi>y</mi><mi>z</mi></mrow></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">M_{sh_z} = \begin{bmatrix}1 &amp; 0 &amp; h_{xz} &amp; 0\\0 &amp; 1 &amp; h_{yz} &amp; 0\\0 &amp; 0 &amp; 1 &amp; 0\\0 &amp; 0 &amp; 0 &amp; 1\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.93343em;vertical-align:-0.2501em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span><span class="mord mtight"><span class="mord mathdefault mtight">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:4.80204em;vertical-align:-2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6520099999999998em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-2.80499em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.40599em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-4.65201em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6520099999999998em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-2.80499em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.40599em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-4.65201em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span></span></span></span></p><blockquote><img src="https://i.stack.imgur.com/90xMH.jpg" alt="shear" width="400px"><p>A <strong>2D</strong> shearing operation</p></blockquote></li><li><p><strong>Rotation</strong>: a rotation can be thought as a combination of shearing and scaling,a visual demonstration can be found <a href="https://youtu.be/E3Phj6J287o">here</a>.</p><p>A rotation along <em>x</em>, <em>y</em> and <em>z</em> axis can then be represented as such:</p><p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>M</mi><msub><mi>r</mi><mi>x</mi></msub></msub><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>c</mi><mi>o</mi><mi>s</mi><mi>θ</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi>s</mi><mi>i</mi><mi>n</mi><mi>θ</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>s</mi><mi>i</mi><mi>n</mi><mi>θ</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>c</mi><mi>o</mi><mi>s</mi><mi>θ</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">M_{r_x} = \begin{bmatrix}1 &amp; 0 &amp; 0 &amp; 0\\0 &amp; cos\theta &amp; -sin\theta &amp; 0\\0 &amp; sin\theta &amp; cos\theta &amp; 0\\0 &amp; 0 &amp; 0 &amp; 1\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.93343em;vertical-align:-0.2501em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139199999999997em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:-0.02778em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:4.80204em;vertical-align:-2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6520099999999998em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-2.80499em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.40599em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-4.65201em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="mord mathdefault">o</span><span class="mord mathdefault">s</span><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="mord mathdefault">o</span><span class="mord mathdefault">s</span><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6520099999999998em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-2.80499em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.40599em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-4.65201em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span></span></span></span><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>M</mi><msub><mi>r</mi><mi>y</mi></msub></msub><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>c</mi><mi>o</mi><mi>s</mi><mi>θ</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>s</mi><mi>i</mi><mi>n</mi><mi>θ</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi>s</mi><mi>i</mi><mi>n</mi><mi>θ</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>c</mi><mi>o</mi><mi>s</mi><mi>θ</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">M_{r_y} = \begin{bmatrix}cos\theta &amp; 0 &amp; sin\theta &amp; 0\\0 &amp; 1 &amp; 0 &amp; 0\\-sin\theta &amp; 0 &amp; cos\theta &amp; 0\\0 &amp; 0 &amp; 0 &amp; 1\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.03065em;vertical-align:-0.34731999999999996em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285716em;"><span style="top:-2.357em;margin-left:-0.02778em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2818857142857143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.34731999999999996em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:4.80204em;vertical-align:-2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6520099999999998em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-2.80499em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.40599em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-4.65201em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="mord mathdefault">o</span><span class="mord mathdefault">s</span><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="mord mathdefault">o</span><span class="mord mathdefault">s</span><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6520099999999998em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-2.80499em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.40599em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-4.65201em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span></span></span></span><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>M</mi><msub><mi>r</mi><mi>z</mi></msub></msub><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>c</mi><mi>o</mi><mi>s</mi><mi>θ</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi>s</mi><mi>i</mi><mi>n</mi><mi>θ</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>s</mi><mi>i</mi><mi>n</mi><mi>θ</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>c</mi><mi>o</mi><mi>s</mi><mi>θ</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">M_{r_z} = \begin{bmatrix}cos\theta &amp; -sin\theta &amp; 0 &amp; 0\\sin\theta &amp; cos\theta &amp; 0 &amp; 0\\0 &amp; 0 &amp; 1 &amp; 0\\0 &amp; 0 &amp; 0 &amp; 1\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.93343em;vertical-align:-0.2501em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139199999999997em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:-0.02778em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:4.80204em;vertical-align:-2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6520099999999998em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-2.80499em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.40599em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-4.65201em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="mord mathdefault">o</span><span class="mord mathdefault">s</span><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="mord mathdefault">o</span><span class="mord mathdefault">s</span><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6520099999999998em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-2.80499em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.40599em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-4.65201em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span></span></span></span></p></li></ul><h1 id="real-examples"><a class="markdownIt-Anchor" href="#real-examples"></a> Real Examples</h1><p>I used <code>numpy.ndarray</code> to store matrix, and used a third-party libraryfor computing the composition and de-composition of transformation matrix.</p><script src="https://gist.github.com/leixingyu/7496f9981c699a61ccf605c672898f9d.js"></script><h2 id="computation"><a class="markdownIt-Anchor" href="#computation"></a> Computation</h2><p>Now let’s put our code to the test:</p><p>Here are the transformation values I have in maya:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">maya_t = [-<span class="number">1.307</span>, <span class="number">0.331</span>, <span class="number">0.188</span>]</span><br><span class="line">maya_r = [-<span class="number">335</span>, -<span class="number">12</span>, <span class="number">98</span>]</span><br><span class="line">maya_s = [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>]</span><br></pre></td></tr></table></figure><h2 id="maya-to-unity"><a class="markdownIt-Anchor" href="#maya-to-unity"></a> Maya to Unity</h2><p>From the previous post, I’ve computed the change of basis matrix for Unreal</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">MAYA_TO_UNITY = np.array([</span><br><span class="line">    [-<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line">], dtype=<span class="built_in">int</span>)</span><br></pre></td></tr></table></figure><p>Now followed by our methods:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">maya_matrix = compose_matrix(maya_t, maya_r, maya_s, order=<span class="string">&#x27;sxyz&#x27;</span>)</span><br><span class="line">unity_matrix = change_xform(maya_matrix, MAYA_TO_UNITY)</span><br><span class="line">unity_t, unity_r, unity_s = decompose_matrix(unity_matrix, order=<span class="string">&#x27;szxy&#x27;</span>)</span><br></pre></td></tr></table></figure><p>Result:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># transform in Unity</span></span><br><span class="line">translation = [<span class="number">1.307</span>, <span class="number">0.331</span>, <span class="number">0.188</span>] </span><br><span class="line">rotation = [<span class="number">7.3413883536944935</span>, -<span class="number">26.641453221201548</span>, -<span class="number">102.41010358310075</span>] </span><br><span class="line">scale = [<span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>]</span><br></pre></td></tr></table></figure><p><strong>Important</strong>: for rotation since the returned values corresponds to the first, secondand third rotation angle specified in the rotation order:which is in ‘zxy’, we need to swap values to re-order it as ‘xyz’.</p><h2 id="maya-to-unreal"><a class="markdownIt-Anchor" href="#maya-to-unreal"></a> Maya to Unreal</h2><p>Same goes for Unreal, the change of basis matrix is:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">MAYA_TO_UNREAL = np.array([</span><br><span class="line">    [<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">0</span>, -<span class="number">1</span>, <span class="number">0</span>],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line">], dtype=<span class="built_in">int</span>)</span><br></pre></td></tr></table></figure><p>Then comes our conversion method:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">maya_matrix = compose_matrix(maya_t, maya_r, maya_s, order=<span class="string">&#x27;sxyz&#x27;</span>)</span><br><span class="line">unreal_matrix = change_xform(maya_matrix, MAYA_TO_UNREAL)</span><br><span class="line">unreal_t, unreal_r, unreal_s = decompose_matrix(unreal_matrix, order=<span class="string">&#x27;sxyz&#x27;</span>)</span><br></pre></td></tr></table></figure><p>Result:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># transform in Unreal</span></span><br><span class="line">translation = [-<span class="number">1.307</span>, <span class="number">0.188</span>, <span class="number">0.331</span>] </span><br><span class="line">rotation = [<span class="number">149.05728077227823</span>, <span class="number">75.61041143412538</span>, <span class="number">123.21509334477231</span>] </span><br><span class="line">scale = [<span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>]</span><br></pre></td></tr></table></figure><p><strong>Caveat:</strong> I need to inverse the value of translation <em>z</em>, the reason I haven’t figured out yet,but translation is hardly our concern since we just need to flip axes between Maya values;The rotation value is the important one.</p><h1 id="reference"><a class="markdownIt-Anchor" href="#reference"></a> Reference</h1><p><a href="https://matthew-brett.github.io/transforms3d/index.html">Transform3d API</a></p><p><a href="https://discourse.threejs.org/t/convert-from-one-coordinate-system-to-another/13240">ThreeJS -Convert from one coordinate system to another?</a></p><p><a href="https://www.techarthub.com/a-practical-guide-to-unreal-engine-4s-coordinate-system/">Tech Art Hub - A Practical Guide to Unreal Engine 4’s Coordinate System</a></p>]]></content>
    
    
    <summary type="html">Learn the essential 3D software math skills for game development with our comprehensive guide. In this post, we cover the intricacies of converting and transforming matrices, providing step-by-step instructions and real-world examples in Unity, Maya and Unreal Engine</summary>
    
    
    
    <category term="learning log" scheme="https://www.xingyulei.com/categories/learning-log/"/>
    
    
    <category term="math" scheme="https://www.xingyulei.com/tags/math/"/>
    
    <category term="maya" scheme="https://www.xingyulei.com/tags/maya/"/>
    
    <category term="unreal" scheme="https://www.xingyulei.com/tags/unreal/"/>
    
    <category term="unity" scheme="https://www.xingyulei.com/tags/unity/"/>
    
  </entry>
  
  <entry>
    <title>Change of Basis Matrix in Maya, Unity and Unreal</title>
    <link href="https://www.xingyulei.com/post/math-change-of-basis/"/>
    <id>https://www.xingyulei.com/post/math-change-of-basis/</id>
    <published>2022-09-25T07:00:00.000Z</published>
    <updated>2023-11-03T03:44:28.941Z</updated>
    
    <content type="html"><![CDATA[<h1 id="introduction"><a class="markdownIt-Anchor" href="#introduction"></a> Introduction</h1><p>Different DCCs uses coordinate systems with different axis directions. For example,Maya by default uses a Y-up right-handed system; Unity uses a Y-up left-handed system;and Unreal uses a Z-up left-handed system.</p><figure><img src="https://www.techarthub.com/wp-content/uploads/coordinate-comparison-chart-full.jpg" alt="dcc-coord" width="600px" ><figcaption>(Image from: Techart Hub)</figcaption></figure><br><ul><li><p><strong>Up Direction</strong>: is what consider to be the up direction of the world. Movingan object up translating in direction of positive <em>Y</em> in Maya and Unity, but forUnreal, it’s translating in the direction of positive <em>Z</em>.</p></li><li><p><strong>Handed System</strong>: not only affects the forward/front direction of the world,it also dictates the direction of rotation; for left-handed system,positive rotation about the axis is <strong>clockwise</strong>, and for right-handed system, it’s<strong>counter-clockwise</strong> (same way as how our hand would curl, hence the name).</p></li></ul><p>The nature of the coordinate system affects how an object’s transformation is calculated.</p><p>The <strong>Change of Basis</strong> matrix transforms a vector lies in one coordinate system toanother.</p><h2 id="basis-vectors"><a class="markdownIt-Anchor" href="#basis-vectors"></a> Basis Vectors</h2><p>In the world of 2D, the basis vectors <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span></span></span></span> of one coordinate system A,corresponds to<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>v</mi><mi>x</mi></msub><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">v_x =\begin{bmatrix}1 \\0 \\\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span></span>and<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>v</mi><mi>y</mi></msub><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">v_y =\begin{bmatrix}0 \\1 \\\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span></span></p><p>Now, if these two basis vectors were to transfer to a different coordinate system B,this exact set of basis vectors is written differently in that system.This represents A’s basis vectors in B’s system.<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>v</mi><mi>x</mi></msub><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>2</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">v_x =\begin{bmatrix}2 \\1 \\\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span></span>and<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>v</mi><mi>y</mi></msub><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">v_y =\begin{bmatrix}-1 \\1 \\\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span></span></p><p>Correspondingly, any vector in system B could translate to system A, pre-multiply using thischange of basis matrix:<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>M</mi><mrow><mi>c</mi><mi>o</mi><mi>b</mi></mrow></msub><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>2</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">M_{cob} =\begin{bmatrix}2 &amp; -1\\1 &amp; 1\\\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span></span>where the first column is the basis vector <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span></span></span></span> and second column is thebasis vector <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span></span></span></span>.</p><p>And alternatively, to translate any vector in system A to system B, we pre-multiplyby the inverse of this change of basis matrix: <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><msub><mi>M</mi><mrow><mi>c</mi><mi>o</mi><mi>b</mi></mrow></msub><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">{M_{cob}}^{-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0373379999999999em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.887338em;"><span style="top:-3.1362300000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span>.</p><h2 id="transformation"><a class="markdownIt-Anchor" href="#transformation"></a> Transformation</h2><p>Now we know how to convert vectors between coordinate systems, how do we do it for transformation?Here are some simple step to understand:</p><ol><li><p>Given any vector in system B, apply a change of basis operation, so it’s in system A:</p><p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>M</mi><mrow><mi>c</mi><mi>o</mi><mi>b</mi></mrow></msub><mo>∗</mo><msub><mi>v</mi><mi>B</mi></msub></mrow><annotation encoding="application/x-tex">M_{cob} * v_B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>.</p></li><li><p>Now we can apply a transformation represented in the same system A:</p><p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>M</mi><mrow><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>f</mi><mi>o</mi><mi>r</mi><mi>m</mi><mi>A</mi></mrow></msub><mo>∗</mo><msub><mi>M</mi><mrow><mi>c</mi><mi>o</mi><mi>b</mi></mrow></msub><mo>∗</mo><msub><mi>v</mi><mi>B</mi></msub></mrow><annotation encoding="application/x-tex">M_{transformA} * M_{cob} * v_B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">A</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>.</p></li><li><p>Finally, we can transfer the end result back to system B by pre-multiplying the inverseof the change of basis matrix:</p><p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><msub><mi>M</mi><mrow><mi>c</mi><mi>o</mi><mi>b</mi></mrow></msub><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>∗</mo><msub><mi>M</mi><mrow><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>f</mi><mi>o</mi><mi>r</mi><mi>m</mi><mi>A</mi></mrow></msub><mo>∗</mo><msub><mi>M</mi><mrow><mi>c</mi><mi>o</mi><mi>b</mi></mrow></msub><mo>∗</mo><msub><mi>v</mi><mi>B</mi></msub></mrow><annotation encoding="application/x-tex">{M_{cob}}^{-1} * M_{transformA} * M_{cob} * v_B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0373379999999999em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.887338em;"><span style="top:-3.1362300000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">A</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>.</p></li></ol><br/><h2 id="conclusion"><a class="markdownIt-Anchor" href="#conclusion"></a> Conclusion</h2><p>The frontal part <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><msub><mi>M</mi><mrow><mi>c</mi><mi>o</mi><mi>b</mi></mrow></msub><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>∗</mo><msub><mi>M</mi><mrow><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>f</mi><mi>o</mi><mi>r</mi><mi>m</mi><mi>A</mi></mrow></msub><mo>∗</mo><msub><mi>M</mi><mrow><mi>c</mi><mi>o</mi><mi>b</mi></mrow></msub></mrow><annotation encoding="application/x-tex">{M_{cob}}^{-1} * M_{transformA} * M_{cob}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0373379999999999em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.887338em;"><span style="top:-3.1362300000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">A</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> represents thesame transformation but in system B: <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>M</mi><mrow><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>f</mi><mi>o</mi><mi>r</mi><mi>m</mi><mi>B</mi></mrow></msub></mrow><annotation encoding="application/x-tex">M_{transformB}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight" style="margin-right:0.05017em;">B</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>.</p><p>Alternatively, any transformation in system B: <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>M</mi><mrow><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>f</mi><mi>o</mi><mi>r</mi><mi>m</mi><mi>B</mi></mrow></msub></mrow><annotation encoding="application/x-tex">M_{transformB}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight" style="margin-right:0.05017em;">B</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> can be representedas <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>M</mi><mrow><mi>c</mi><mi>o</mi><mi>b</mi></mrow></msub><mo>∗</mo><msub><mi>M</mi><mrow><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>f</mi><mi>o</mi><mi>r</mi><mi>m</mi><mi>B</mi></mrow></msub><mo>∗</mo><msup><msub><mi>M</mi><mrow><mi>c</mi><mi>o</mi><mi>b</mi></mrow></msub><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">M_{cob} * M_{transformB} * {M_{cob}}^{-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight" style="margin-right:0.05017em;">B</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.0373379999999999em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.887338em;"><span style="top:-3.1362300000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span> in system A.</p><p>Here’s the function I’ve written Python:</p><script src="https://gist.github.com/leixingyu/f8849105d509bd52723f3e94a35cab67.js"></script><h1 id="example"><a class="markdownIt-Anchor" href="#example"></a> Example</h1><h2 id="maya-to-unreal"><a class="markdownIt-Anchor" href="#maya-to-unreal"></a> Maya to Unreal</h2><p>The first thing to identify is the change of basis from Maya to Unreal,as illustrated before, Maya is a Y-up left-hand system and Unreal is a Z-upright-hand system.</p><table style="width: 500px"><tr>  <td colspan="6">Maya Axis Direction</td></tr>  <tr>    <td>Forward</td>    <td>Z</td>    <td>Up</td>    <td>Y</td>    <td>Right</td>    <td>-X</td>  </tr><tr>  <td colspan="6">Unreal Axis Direction</td></tr>  <tr>    <td>Forward</td>    <td>-Y</td>    <td>Up</td>    <td>Z</td>    <td>Right</td>    <td>-X</td>  </tr></table><p>The change of basis can be represented as such$M_{cob} =\begin{bmatrix}1 &amp; 0 &amp; 0 &amp; 0\0 &amp; 0 &amp; -1 &amp; 0\0 &amp; 1 &amp; 0 &amp; 0\0 &amp; 0 &amp; 0 &amp; 1\end{bmatrix}$</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">MAYA_TO_UNREAL = np.array([</span><br><span class="line">    [<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">0</span>, -<span class="number">1</span>, <span class="number">0</span>],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line">], dtype=<span class="built_in">int</span>)</span><br></pre></td></tr></table></figure><h2 id="maya-to-unity"><a class="markdownIt-Anchor" href="#maya-to-unity"></a> Maya to Unity</h2><p>Same thing for Maya to Unity conversion, a Y-up left-hand system to a Y-up right-handsystem; the <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span></span></span></span> are respectively inverted between the two systems, therefore:</p><table style="width: 500px"><tr>  <td colspan="6">Maya Axis Direction</td></tr>  <tr>    <td>Forward</td>    <td>Z</td>    <td>Up</td>    <td>Y</td>    <td>Right</td>    <td>-X</td>  </tr><tr>  <td colspan="6">Unity Axis Direction</td></tr>  <tr>    <td>Forward</td>    <td>Z</td>    <td>Up</td>    <td>Y</td>    <td>Right</td>    <td>X</td>  </tr></table><p>The change of basis can be represented as such$M_{cob} =\begin{bmatrix}-1 &amp; 0 &amp; 0 &amp; 0\0 &amp; 1 &amp; 0 &amp; 0\0 &amp; 0 &amp; 1 &amp; 0\0 &amp; 0 &amp; 0 &amp; 1\end{bmatrix}$</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">MAYA_TO_UNITY = np.array([</span><br><span class="line">    [-<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line">], dtype=<span class="built_in">int</span>)</span><br></pre></td></tr></table></figure><h1 id="reference"><a class="markdownIt-Anchor" href="#reference"></a> Reference</h1><p><a href="https://youtu.be/P2LTAUO1TdA">YouTube - Change of basis | Chapter 13, Essence of linear algebra</a></p><p><a href="https://forums.unrealengine.com/t/forward-in-unreal-engine-which-is-it/93115">Unreal Engine Forum - “Forward” in unreal engine, Which is it?</a></p><p><a href="https://www.dariomazzanti.com/uncategorized/change-of-basis/">Dario Mazzanti - Change of Basis</a></p>]]></content>
    
    
    <summary type="html">Discover how to manipulate matrices in 3D software to create stunning graphics for your games. Our tutorial covers the fundamentals of matrix mathematics and teaches you how to change matrices for 3D transformations. Master this essential skill Today</summary>
    
    
    
    <category term="3d math" scheme="https://www.xingyulei.com/categories/3d-math/"/>
    
    
    <category term="math" scheme="https://www.xingyulei.com/tags/math/"/>
    
    <category term="maya" scheme="https://www.xingyulei.com/tags/maya/"/>
    
    <category term="unreal" scheme="https://www.xingyulei.com/tags/unreal/"/>
    
    <category term="unity" scheme="https://www.xingyulei.com/tags/unity/"/>
    
  </entry>
  
  <entry>
    <title>Euler Angles and Gimbal Lock: Things You Need to Know</title>
    <link href="https://www.xingyulei.com/post/math-euler-gimbal/"/>
    <id>https://www.xingyulei.com/post/math-euler-gimbal/</id>
    <published>2022-09-17T07:00:00.000Z</published>
    <updated>2023-09-02T17:49:48.029Z</updated>
    
    <content type="html"><![CDATA[<h1 id="introduction"><a class="markdownIt-Anchor" href="#introduction"></a> Introduction</h1><p>When talking about rotation, most of us would picture gimbal movement: an objectrotate about a set of three axes. This is the same principle of the Euler anglespresentation of rotation. It being the most popular representation for rotation,is used across many DCCs, it is intuitive and easy for us to understand.</p><p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d5/Gyroscope_operation.gif/220px-Gyroscope_operation.gif" alt="gimbal" /></p><p>While an Euler angles are usually written as a list of three values representingrotation degrees in <em>x</em>, <em>y</em>, <em>z</em> axis.</p><p>Scientifically it is actually denoted as<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>α</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.0037em;">α</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>β</mi></mrow><annotation encoding="application/x-tex">\beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05278em;">β</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>γ</mi></mrow><annotation encoding="application/x-tex">\gamma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05556em;">γ</span></span></span></span> with radian as rotation unit where</p><ul><li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>α</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.0037em;">α</span></span></span></span> is rotation about the first axis</li><li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>β</mi></mrow><annotation encoding="application/x-tex">\beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05278em;">β</span></span></span></span> is rotation about the second axis</li><li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>γ</mi></mrow><annotation encoding="application/x-tex">\gamma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05556em;">γ</span></span></span></span> is rotation about the third axis</li></ul><h1 id="rotation-order"><a class="markdownIt-Anchor" href="#rotation-order"></a> Rotation Order</h1><p>There are two major issue with Euler angles.</p><h2 id="ambiguity"><a class="markdownIt-Anchor" href="#ambiguity"></a> Ambiguity</h2><p>The target orientation is rotation order dependent, meaning even with thesame rotation <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>α</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.0037em;">α</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>β</mi></mrow><annotation encoding="application/x-tex">\beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05278em;">β</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>γ</mi></mrow><annotation encoding="application/x-tex">\gamma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05556em;">γ</span></span></span></span> values,the results differs using different order of rotation.</p><p>A <em>zyx</em> order refers to rotation about axis z, y, x in that order (thinkof it as x axis being a child of y axis being a child of z axis).Therefore, to represent a target rotation, aside from providing rotation values<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>α</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.0037em;">α</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>β</mi></mrow><annotation encoding="application/x-tex">\beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05278em;">β</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>γ</mi></mrow><annotation encoding="application/x-tex">\gamma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05556em;">γ</span></span></span></span>, we also need to providethe rotation order and <a href="#rotation-type">Rotation Type</a>.</p><p>There are a total of 12 possible rotation orders per rotation type/group.</p><h2 id="gimbal-problem"><a class="markdownIt-Anchor" href="#gimbal-problem"></a> Gimbal Problem</h2><p>In short, the Gimbal problem is due to euler angle decomposing a (linear) rotational movementas a product of more than one axis rotations.</p><p>Although any target orientation can be achieved using Euler rotation, the rotationalmovements are sometimes undesired. This is due to a problem in Animation field known asGimbal Lock.</p><table style="width: 900px">  <tr>    <td><img src="https://upload.wikimedia.org/wikipedia/commons/4/49/Gimbal_Lock_Plane.gif" alt="gimbal-lock" width="300px"></td>    <td>Gimbal lock happens when two of the three axes are rotated to a parallelconfiguration, 'locking' the system into a two-dimensional space.</td>  </tr></table><br><p>In order to “break free” of this configuration,the system needs to input rotation along two or more axes simultaneously.</p><p>In the context of keyframe Animation, interpolation along more than one axis means therotational movement will not appear linear, but in an unpredictable trajectory,which is bad. (See video illustration <a href="https://youtu.be/zc8b2Jo7mno?t=130">here</a>)</p><h3 id="test-in-maya"><a class="markdownIt-Anchor" href="#test-in-maya"></a> Test in Maya</h3><p>We can test out the gimbal problem in Maya ourselves.</p><p>Going into rotation tools and select <em>“Axis Orientation”</em> to <em>“Gimbal”</em>, we cannow interact with the object using gimbal rotation. This rotation is whatactually get recorded by Maya and presented in the channel box.</p><p>If we go back to the <em>“Object”</em> mode rotation, even though our rotation gizmo isnow unlocked, the gimbal problem don’t just go away.Maya is still recording the gimbal rotation in the background.The <em>“Object”</em> mode rotation is just an interaction tool.</p><table style="width: 600px">  <tr>    <td><img src="https://i.imgur.com/wVrvepx.png" alt="gimbal" width="300px"></td>    <td><img src="https://i.imgur.com/jiUWIWa.png" alt="object" width="300px"></td>  </tr>  <tr>    <td>Gimbal Mode</td>    <td>Object Mode</td>  </tr></table><h2 id="quaternion"><a class="markdownIt-Anchor" href="#quaternion"></a> Quaternion</h2><blockquote><p>Rotation lies in non-Euclidean space.</p></blockquote><p>Luckily there is a more advanced representation for rotation: Quaternion, whichgame engines uses internally. This is due to it being data compact (only stores four numbers) andcomputational efficient (rotational movement using Euler angles usually need to be converted to rotationmatrix, which involves a lot of <em>sin</em> and <em>cos</em> calculation).</p><p>The bigger advantage comes from itproducing linear and predictable results (the shortest path along source andtarget rotation). It is, however, very hard for users to comprehend.</p><p>A quaternion consists of a scaler part and a vector part:</p><p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>q</mi><mo>=</mo><mo stretchy="false">[</mo><mi>s</mi><mo separator="true">,</mo><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo separator="true">,</mo><mi>z</mi><mo stretchy="false">)</mo><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">q = [s, (x, y, z)]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathdefault">s</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mclose">)</span><span class="mclose">]</span></span></span></span> where <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi><mo separator="true">,</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo separator="true">,</mo><mi>z</mi><mo>∈</mo><mi>R</mi></mrow><annotation encoding="application/x-tex">s, x, y, z \in R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7335400000000001em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">s</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span></span></span></span></p><p>or.<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>q</mi><mo>=</mo><mi>s</mi><mo>+</mo><mi>i</mi><mi>x</mi><mo>+</mo><mi>i</mi><mi>j</mi><mo>+</mo><mi>k</mi><mi>z</mi></mrow><annotation encoding="application/x-tex">q = s + ix + ij + kz</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.74285em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">i</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span></span></span></span> where <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>i</mi><mn>2</mn></msup><mo>=</mo><msup><mi>j</mi><mn>2</mn></msup><mo>=</mo><msup><mi>k</mi><mn>2</mn></msup><mo>=</mo><mi>i</mi><mi>j</mi><mi>k</mi><mo>=</mo><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">i^2 = j^2 = k^2 = ijk = -1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">i</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.008548em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">−</span><span class="mord">1</span></span></span></span></p><h1 id="rotation-type"><a class="markdownIt-Anchor" href="#rotation-type"></a> Rotation Type</h1><h2 id="intrinsic-and-extrinsic-rotations"><a class="markdownIt-Anchor" href="#intrinsic-and-extrinsic-rotations"></a> Intrinsic and Extrinsic Rotations</h2><p><strong>Intrinsic rotations</strong> are elemental rotations that occur about the axes ofa coordinate system XYZ attached to a moving body. (i.e. rotation about axisin the current coordinate, like object space)</p><p><strong>Extrinsic rotations</strong> are elemental rotations that occurabout the axes of the fixed coordinate system xyz. (i.e. rotation about axisin the original coordinate, like world space)</p><p><img src="https://img-blog.csdnimg.cn/fbc97c759b134aa3b87b1d3fa6bbc567.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBASGVyZW5lXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="intrinsic-vs-extrinsic-rotation" /></p><p>(Fig.1: Intrinsic rotations; Fig.2: Extrinsic rotations)</p><h2 id="example"><a class="markdownIt-Anchor" href="#example"></a> Example</h2><p>Rotation calculation usually happens along with other transform type using matrix.Here I made a matrix composition and decomposition function in Python, utilizinga third party math library <a href="http://matthew-brett.github.io/transforms3d/index.html">transforms3d</a>.</p><p>As we can see, since the rotation matrix varies depending on rotation order and type,this is reflected as one of the argument.</p><script src="https://gist.github.com/leixingyu/7496f9981c699a61ccf605c672898f9d.js"></script><blockquote><p>The first character is ‘r’ (rotating == intrinsic),or ‘s’ (static == extrinsic).</p><p>The next three characters give the axis (‘x’, ‘y’ or ‘z’)about which to perform the rotation,in the order in which the rotations will be performed.</p><p>For example the string ‘szyx’ specifies that the angles should be interpretedrelative to extrinsic (static) coordinate axes, and be performed in the order:rotation about z axis; rotation about y axis; rotation about x axis.</p></blockquote><h2 id="conversion"><a class="markdownIt-Anchor" href="#conversion"></a> Conversion</h2><p>Any extrinsic rotation can be represented in intrinsic rotation with the sameangle values but inverted order or elemental rotation.</p><p>So a <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>α</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.0037em;">α</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>β</mi></mrow><annotation encoding="application/x-tex">\beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05278em;">β</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>γ</mi></mrow><annotation encoding="application/x-tex">\gamma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05556em;">γ</span></span></span></span> with extrinsic <strong>zyx</strong> order is equivalent tothe same angle with intrinsic <strong>xyz</strong> order.</p><h1 id="reference"><a class="markdownIt-Anchor" href="#reference"></a> Reference</h1><p><a href="https://math.stackexchange.com/questions/2943074/">Stack Exchange - Confusion about order of rotations for Euler Angles</a></p><p><a href="https://forums.unrealengine.com/t/what-is-the-rotation-order-for-components-or-bones/286910/5">Unreal Engine Forum - What is the rotation order for Components or Bones?</a></p><p><a href="https://math.stackexchange.com/questions/1137745">Stack Exchange - Proof of the extrinsic to intrinsic rotation transform</a></p><p><a href="https://youtu.be/zc8b2Jo7mno">YouTube - Euler (Gimbal Lock) Explained</a></p><p><a href="http://td-matt.blogspot.com/2010/11/rotation-orders.html">TD Matt - Rotation Orders</a></p><p><a href="https://blog.csdn.net/weixin_42165913/article/details/120167295">CSDN - Understanding Euler Angles</a></p>]]></content>
    
    
    <summary type="html">Unlock the power of 3D game development with our in-depth guide to Euler angles and gimbal lock. Learn how to avoid common pitfalls and achieve smooth, realistic animations using essential 3D software math. Our comprehensive tutorial is perfect for game developers of all levels.</summary>
    
    
    
    <category term="3d math" scheme="https://www.xingyulei.com/categories/3d-math/"/>
    
    
    <category term="math" scheme="https://www.xingyulei.com/tags/math/"/>
    
    <category term="maya" scheme="https://www.xingyulei.com/tags/maya/"/>
    
  </entry>
  
  <entry>
    <title>Unreal Engine Cinematic FBX Workflow Explained</title>
    <link href="https://www.xingyulei.com/post/ue-cinematic-fbx/"/>
    <id>https://www.xingyulei.com/post/ue-cinematic-fbx/</id>
    <published>2022-08-13T07:00:00.000Z</published>
    <updated>2023-09-02T18:05:03.227Z</updated>
    
    <content type="html"><![CDATA[<h2 id="introduction"><a class="markdownIt-Anchor" href="#introduction"></a> Introduction</h2><p>How do we transfer assets and animation to Unreal needed for cinematic?.fbx is the way to go (at least for now).For each component of a cinematic, we want to set it up nicely so the data can becorrectly presented in Unreal.</p><p>However, do note there are limitations in .fbx and differences between DCCs, certainthings just can’t be transferred through .fbx and certain things can’t be representedin Unreal. Always test your workflow before going into full scale production.</p><p>Please refer to <a href="https://docs.unrealengine.com/5.0/en-US/fbx-content-pipeline/">Unreal’s FBX Content Pipeline</a></p><h2 id="general"><a class="markdownIt-Anchor" href="#general"></a> General</h2><p>The important thing to keep in mind is that <strong>consistency is king</strong>,we want to have consistent world unit, identify coordinate system for each DCC,and maintain a hierarchy standard for assets across DCCs.</p><p>Certain workflow involves animating or placing componentswithin Unreal instead of importing outside the engine which is totally fine.</p><h2 id="static-mesh"><a class="markdownIt-Anchor" href="#static-mesh"></a> Static Mesh</h2><p>Static Meshes represents anything that is not animated, like a background environment.There shouldn’t be any keys on any of the transforms or attribute.They are meant to be modeled outside Unreal,and imported as a static mesh asset, placed in the level as a static mesh actor.</p><table style="width: 700px">  <tr>    <td>        <img src="https://i.imgur.com/EPwKyeY.png" alt="flag-sm-maya" width="300px">    </td>    <td>        <img src="https://i.imgur.com/I4YZzTD.png" alt="flag-sm-unreal" width="300px">    </td>  </tr></table><h3 id="export"><a class="markdownIt-Anchor" href="#export"></a> Export:</h3><p>In the outliner, select all the meshes and export as .fbx</p><p><img src="https://i.imgur.com/xe9MfeN.png" alt="flag-sm-hierarchy" /></p><h3 id="import"><a class="markdownIt-Anchor" href="#import"></a> Import:</h3><p>Make sure ‘combine mesh’ is checked, otherwise the asset will be imported as separate meshes (probably notwhat we want)</p><p>We have three types of Unreal assets created: Static Mesh, Textures and Materials.</p><h3 id="static-mesh-animation"><a class="markdownIt-Anchor" href="#static-mesh-animation"></a> Static Mesh Animation</h3><p>If a mesh is animated in any capacity, even if it’s just translating or rotating as a wholewithout any deformation, it needs to be skinned with joint(s). Consider this as a common standard.</p><p>See the process of Skeletal Mesh in the immediate following.</p><p>Note: the joint transform pivot needs to be align with the mesh transform pivot.</p><p><strong>Example:</strong></p><p>Take a look at our previous flag prop. If we want to animate the flag like moving it around in Unreal,it needs to have joint hierarchy where we can apply animation to, even if it’s simple as this.Applying animation directly to transform is not recommended.</p><img src="https://i.imgur.com/GA2NbrO.png" alt="flag-skm-maya" width="300px"><p>Also, no need to worry about the extra joint and weight data added, the file size increaseis negligible (&lt;10%).</p><h2 id="skeletal-mesh-skm"><a class="markdownIt-Anchor" href="#skeletal-mesh-skm"></a> Skeletal Mesh (SKM)</h2><p>Skeletal Mesh could be used to represent an animated foreground prop or environment,or something as complicated as a character/creature.</p><p><strong>Example:</strong></p><table style="width: 800px">  <tr>    <td>        <img src="https://i.imgur.com/S4AeH4B.png" alt="char-rig-maya" height="300px">    </td>    <td>        <img src="https://i.imgur.com/XhsU3UB.png" alt="char-skm-maya" height="300px">    </td>  </tr></table><h3 id="export-2"><a class="markdownIt-Anchor" href="#export-2"></a> Export</h3><p><a href="https://discourse.techart.online/t/rigging-in-game-vs-animation/2490">Rigging in Game vs Animation</a></p><p>A complex animation rig can’t translate 1 to 1 to game engine, the rigging phase needsto be planned to accommodate the limitation of the engine.</p><p>Once we have a suitable rig in Maya, we need to prepare it for the engine.We would clean the rig up to get a desired hierarchy which contains only jointsand meshes. So remove components like controllers and constraints, also get ridof any redundant namespace.</p><img src="https://i.imgur.com/4PupBE3.png" alt="char-skm-outline" width="200px"><h3 id="import-2"><a class="markdownIt-Anchor" href="#import-2"></a> Import</h3><p>In addition to Textures and Materials, we have three major components imported:Skeleton, Skeletal Mesh and Physics Asset.</p><ul><li>Skeleton: refers the joint hierarchy, it uses the Skeletal Mesh as the preview mesh</li><li>Skeletal Mesh: is the Skinned Mesh along with the Skeleton</li><li>Physics Asset: defines physics and collision used by the Skeletal Mesh (sometimeseven rendering), a rough physics collision body is defined during import.</li></ul><table style="width: 800px">  <tr>    <td>        <img src="https://i.imgur.com/YSHFOvD.png" alt="import-option" height="400px">    </td>    <td>        <img src="https://i.imgur.com/GOEIA5l.png" alt="char-skm-ue" height="400px">    </td>  </tr></table><p>Note: Blendshape / Morph Target can be imported during the Skeletal Mesh import step by toggling on the checkbox, this is requiredif we want to import blendshape animation.</p><h2 id="skeletal-mesh-animation"><a class="markdownIt-Anchor" href="#skeletal-mesh-animation"></a> Skeletal Mesh Animation</h2><blockquote><p>The exported animation should maintain the exact same hierarchy structure of the exported rig</p></blockquote><p>Generally, the root of the rig/skeleton, whether it’s a transform group or aroot joint, should not have animation/keyed data on it,as it is generally used to offset world transform(and keyed transform can’t do that)</p><h3 id="export-3"><a class="markdownIt-Anchor" href="#export-3"></a> Export</h3><p>Since keyframes are usually on controllers, so we have to bake the keys on all joints.</p><p>Select the joint hierarchy and Bake Simulation, after that we can get rid of the controllersand constraints just like what we did during the rig clean up.</p><p>This time, we only need to export the joint hierarchy (no meshes).</p><img src="https://i.imgur.com/yHA3o39.png" alt="maya-anim-outline" height="300px"><h3 id="import-as-animation-sequence"><a class="markdownIt-Anchor" href="#import-as-animation-sequence"></a> Import (as Animation Sequence)</h3><p>Now during import phase simply select the Skeleton Unreal asset that matchesour animation, no need to create a new Skeletal Mesh.</p><img src="https://i.imgur.com/Ez1x8Zv.png" alt="ue-anim-outline" height="300px"><p>An Animation Sequence Unreal asset is now created, we can also see a previewmesh through the Editor window. It is now ready to be used in the Sequencer.</p><h2 id="blend-shape-morph-target-animation"><a class="markdownIt-Anchor" href="#blend-shape-morph-target-animation"></a> Blend Shape / Morph Target Animation</h2><p>Unreal supports blend shape (or morph target in Unreal’s term) animation, thereare two ways it can be done:</p><p><a href="https://docs.unrealengine.com/4.27/en-US/WorkingWithContent/Importing/FBX/MorphTargets/">https://docs.unrealengine.com/4.27/en-US/WorkingWithContent/Importing/FBX/MorphTargets/</a></p><h3 id="preferred-custom-attribute-on-joint"><a class="markdownIt-Anchor" href="#preferred-custom-attribute-on-joint"></a> (Preferred) Custom Attribute on Joint</h3><p><a href="https://docs.unrealengine.com/5.1/en-US/animation-curves-in-unreal-engine/">https://docs.unrealengine.com/5.1/en-US/animation-curves-in-unreal-engine/</a></p><p>This feature is new in Unreal 5.0</p><ol><li>add custom attribute(s) on any joint in the skeleton hierarchy (match all the blend shape attribute names 1 to 1)</li><li>export only the joint chains (no need to include any meshes, no need to check ‘blend shape’ during export)</li><li>import in Unreal with ‘Import Custom Attribute’ checked</li></ol><p>This will ensure the keys on custom attributes which are on the joint chain to propagatethrough and drive the morph targets. Ideally, all the custom attributes can beset on the skeleton root.</p><p>This method is preferred as it makes the export process easier by only needingto export the skeleton / joint chain, which is faster and light weight.</p><h3 id="blend-shape-node"><a class="markdownIt-Anchor" href="#blend-shape-node"></a> Blend Shape Node</h3><ol><li>find all meshes with blend shape node attached</li><li>traverse in the node editor and locate the blend shape node</li><li>bake simulation on the blend shape node</li><li>include these meshes (ones with blend shape) during the export process, also make sure the ‘blend shape’is checked in the fbx export option</li><li>import in Unreal (can leave ‘Import Custom Attribute’ unchecked)</li></ol><p>Although this process doesn’t need setting up custom attributes on joint(s), it exportsout redundant mesh data which is why it’s not a preferable way.</p><h2 id="camera-animation"><a class="markdownIt-Anchor" href="#camera-animation"></a> Camera Animation</h2><p>Maya Camera cannot be imported as an Unreal asset.Unreal has its own native Camera object, which is not 1-to-1 match to Maya’s Camera.</p><p>What we can do is export Maya camera’s animation and attribute andimport on an Unreal Cinematic Camera Actor.</p><p>See video guide <a href="https://www.youtube.com/watch?v=qtxLmWquOOY">here</a></p><h3 id="export-4"><a class="markdownIt-Anchor" href="#export-4"></a> Export</h3><p>The camera node has to be on the scene root, with no transform node on top.Otherwise, the animation won’t be imported correctly as Unreal is searchingfor the top node.</p><h3 id="import-as-keyframes"><a class="markdownIt-Anchor" href="#import-as-keyframes"></a> Import (as Keyframes)</h3><img src="https://i.imgur.com/XOkzVrx.png" alt="cam-import-option" width="300px"><p>Cameras are linked to the game viewport, therefore animation import needs to be plotted onthe Sequencer as individual keyframes instead of being an Unreal asset.</p><p>Create a camera track and bind it to a newly created Unreal CineCameraActor andhit ‘Import’.</p><img src="https://i.imgur.com/6WXdVzK.png" alt="ue-cam-keys"><h2 id="maya-fbx-export-option-reference"><a class="markdownIt-Anchor" href="#maya-fbx-export-option-reference"></a> Maya FBX Export Option Reference</h2><p><a href="https://knowledge.autodesk.com/support/maya/learn-explore/caas/CloudHelp/cloudhelp/2022/ENU/Maya-Basics/files/GUID-FE8DBEAA-C2DD-43B3-9933-4BA4CDDEAA89-htm.html">FBX Export options: Full Help</a></p><p>Embed Media:</p><ul><li>Could be <strong>checked</strong> during Static Mesh/Skeletal Mesh export based on needs,the Unreal import can pick up the texture and materials embedded.</li></ul><p>Smoothing Group:</p><ul><li>Usually needs to be <strong>checked</strong> so Unreal can use the smoothing group exportedfrom Maya as opposed to perform smoothing calculation on Unreal side.</li></ul><p>Include Children:</p><ul><li>Almost always keep <strong>unchecked</strong>, and explicitly select nodes to export.</li></ul><p>Input Connections:</p><ul><li>Keep <strong>unchecked</strong> is usually a good idea to avoid exporting extra data, butalso depends on different circumstances</li></ul><p>Deformed Models:</p><ul><li>For Skeletal Mesh export which is commonly a rig, check “Skins” to exportskin deformation like skin clusters, check “Blend Shapes” to export all blend shapetargets.</li><li>For Skeletal Mesh <strong>Animation</strong> export, uncheck “Skins” and “Blend Shapes”.Skinning data is embedded within the Skeletal Mesh Asset in Unreal, and forblend shapes, as long as we are following this <a href="#blend-shape">step</a>,the imported .fbx would also carry over blend shape animation.</li></ul><p>Bake Animation:</p><ul><li>Leave this <strong>unchecked</strong> and use Maya’s <em>Edit | Keys | Bake Simulation</em>, as itoffers more flexible solutions and is also generally much faster.</li></ul><h2 id="unreal-fbx-import-option-reference"><a class="markdownIt-Anchor" href="#unreal-fbx-import-option-reference"></a> Unreal FBX Import Option Reference</h2><p><a href="https://docs.unrealengine.com/5.0/en-US/fbx-import-options-reference-in-unreal-engine/">FBX Import Options Reference: Full Help</a></p><p>Static Mesh:</p><ul><li>“Import Mesh” checked</li><li>“Create New Materials” and “Import Textures” as needed</li></ul><p>Skeletal Mesh:</p><ul><li>Leave “Skeleton” blank, if you need to create a new skeleton asset</li><li>“Create Physics Asset”, if you need to create a new PA</li><li>“Skeletal Mesh” and “Import Mesh” checked to import skinned meshes</li><li>“Create New Materials” and “Import Textures” as needed</li><li>“Import Morph Targets” if blend shape animation will be needed</li></ul><p>Skeletal Animation: (Import as Animation Sequence)</p><ul><li>Choose existing skeleton for “Skeleton”</li><li>“Import Mesh” unchecked to avoid importing blend shape source mesh ifblend shape was exported during Maya export</li><li>“Import Animations” checked</li><li>“Import Custom Attribute” checked if using custom attribute on joint for blend shape animation</li></ul><p>Camera Animation: (Import as keyframes in Sequencer)</p><ul><li>“Matches by Name Only” unchecked</li><li>“Create Cameras” unchecked</li><li>“Replace Transform Track” checked</li><li>“Reduce Keys” unchecked</li></ul>]]></content>
    
    
    <summary type="html">Discover the Unreal Engine Cinematic FBX workflow with our comprehensive tutorial. Our guide provides practical examples and best practices for importing and exporting FBX files, creating stunning cinematics, and improving your game development workflow. Whether you&#39;re a beginner or an experienced user, our step-by-step instructions will help you master the techniques needed to create cinematic-quality content for Unreal Engine.</summary>
    
    
    
    <category term="unreal cinematic" scheme="https://www.xingyulei.com/categories/unreal-cinematic/"/>
    
    
    <category term="pipeline" scheme="https://www.xingyulei.com/tags/pipeline/"/>
    
    <category term="maya" scheme="https://www.xingyulei.com/tags/maya/"/>
    
    <category term="unreal" scheme="https://www.xingyulei.com/tags/unreal/"/>
    
  </entry>
  
  <entry>
    <title>Professional-Quality Cinematic with Unreal Engine Sequencer</title>
    <link href="https://www.xingyulei.com/post/ue-cinematic-sequencer/"/>
    <id>https://www.xingyulei.com/post/ue-cinematic-sequencer/</id>
    <published>2022-07-16T07:00:00.000Z</published>
    <updated>2023-11-03T04:04:08.983Z</updated>
    
    <content type="html"><![CDATA[<h2 id="introduction"><a class="markdownIt-Anchor" href="#introduction"></a> Introduction</h2><p>In this blog, I’m going to introduce the different componentsof a cinematic, how they are represented. This hopefully will give you anoverview of how cinematic works in Unreal.</p><h2 id="glossary"><a class="markdownIt-Anchor" href="#glossary"></a> Glossary</h2><ul><li><p><strong>Skeleton</strong>: a hierarchy that is used to define Bones (sometimes called joints),In Unreal, skeletons are used to store/driven by associated animation data.</p></li><li><p><strong>Static Mesh</strong>: a piece of geometry that consists of a set of polygonsthat can be cached in video memory and rendered out.</p></li><li><p><strong>Skeletal Mesh</strong>: in short is a collection of a skeleton hierarchy, and mesh(es) skinned tothat skeleton. A set of polygons composed to make up the surface ofthe Skeletal Mesh, and a hierarchical set of interconnected boneswhich can be used to animate the vertices of the polygons</p></li><li><p><strong>Level</strong>: is all or part of our game’s “world”. Levels contain everything aplayer can see and interact with, like environments, usable objects,other characters, and so on.</p></li><li><p><strong>Actor</strong>: an Actor is any object that can be placed into a Level,such as a camera, Static Mesh, or player start location.Actors support 3D transformations such as translation, rotation, and scaling.They can be created and destroyed.</p></li><li><p><strong>Binding</strong>: a track in sequencer that binds a specific actor in the level, enablesthe level sequence to modify or animate its property when the level sequence is active.</p></li></ul><h2 id="what-makes-a-sequencer"><a class="markdownIt-Anchor" href="#what-makes-a-sequencer"></a> What makes a Sequencer</h2><blockquote><p>Similar to other film and animation editing software, Sequencer requires usto add tracks in order to reference elements in our sequence.</p><p>Any character, prop, camera, effect, or other viewport element can bereferenced and manipulated in Sequencer</p></blockquote><p><img src="https://i.imgur.com/UI68i63.png" alt="overview" /></p><h3 id="level-sequence"><a class="markdownIt-Anchor" href="#level-sequence"></a> Level Sequence</h3><p>A Level Sequence asset is a container for cinematic data, which includestracks, animation and binding.</p><h3 id="level-sequence-track"><a class="markdownIt-Anchor" href="#level-sequence-track"></a> Level Sequence Track</h3><p>If you used any video editing software, then tracks shouldn’t be new to you.Tracks are like layers, and the <em>Level Sequence</em> is the whole canvas;</p><p><em>Tracks</em> usually are used to reference different actors in the level,and then animated its properties. So in most time, tracks don’t overlay eachother like layers in Photoshop do, they’re more like controllingdifferent color channels that compose the final image.</p><h3 id="level-sequence-section-asset"><a class="markdownIt-Anchor" href="#level-sequence-section-asset"></a> Level Sequence Section Asset</h3><p><em>Sections</em> are the components that laid out in a <em>Track</em>, sections can be treatedas individual animation clips of which make up the whole track.</p><p>Some common section are <em>Camera Cuts</em> section, <em>Shots</em> section and <em>Animation</em> section.</p><h2 id="basic-cinematic-component"><a class="markdownIt-Anchor" href="#basic-cinematic-component"></a> Basic Cinematic Component</h2><p>We’ll break down a cinematic as the following components and tackle themone by one.</p><ul><li>Camera (Camera Actor)</li><li>Background (Static Mesh Actor)</li><li>Foreground &amp; Character (Skeletal Mesh Actor)</li><li>Lighting (Light Actor)</li><li>FX (Visual Effects Actor)</li><li>Audio (Sound Wave Asset)</li><li>Other</li></ul><h2 id="actor-to-sequence-object-binding"><a class="markdownIt-Anchor" href="#actor-to-sequence-object-binding"></a> Actor to Sequence (Object Binding)</h2><p>The level sequence operates within levels and operates on actors in the level.It can bind to an existing actor and animates its properties. It can also spawn an actoras needed.</p><p><a href="https://docs.unrealengine.com/5.0/en-US/spawn-temporary-actors-in-unreal-engine-cinematics/">Spawnables vs. Possessables</a></p><h3 id="static-mesh"><a class="markdownIt-Anchor" href="#static-mesh"></a> Static Mesh</h3><p><img src="https://i.imgur.com/NGIIEAp.png" alt="static" /></p><p>This is the simplest scenario, a static mesh actor is bound to the level sequenceand the transform are keyed.</p><h3 id="skeletal-mesh"><a class="markdownIt-Anchor" href="#skeletal-mesh"></a> Skeletal Mesh</h3><p><img src="https://i.imgur.com/Rh2kTsR.png" alt="skm" /></p><p>When it comes to skeletal mesh, another component is exposed: Animation.</p><p>This sub-track takes Unreal <a href="https://docs.unrealengine.com/5.0/en-US/animation-sequences-in-unreal-engine/">Animation Sequence</a> assets, which consists theskeleton animation, this effectively drives the skeleton within the skeletalmesh actor.</p><h3 id="camera-binding-and-camera-cut"><a class="markdownIt-Anchor" href="#camera-binding-and-camera-cut"></a> Camera Binding and Camera Cut</h3><p><img src="https://i.imgur.com/exrhTgo.png" alt="camera" /></p><p>In order to set up camera view properly, in-addition to the camera binding,we also need a <em>Camera Cuts Track</em>. Whatever is on this track is what the viewportis capturing, it allows us to switch and blend between different cameras.</p><p>(In short, the Camera Binding tracks drives the Camera Actor, the Camera Cut track decideswhat takes over the viewport)</p><h3 id="audio"><a class="markdownIt-Anchor" href="#audio"></a> Audio</h3><p><img src="https://i.imgur.com/PNHsLUU.png" alt="audio" /></p><p>Audio can be created using by possessing an audio/sound actor, or alternativelyit can be created by adding Unreal <a href="https://docs.unrealengine.com/5.0/en-US/audio-files-in-unreal-engine/">Sound Wave</a> asset. I would recommendthe latter as it allows us to scrub in the timeline and still have thecorrect audio playback.</p><blockquote><p><strong>Note:</strong> Set Sound Wave Asset’s ‘<em>Sound Asset Compression Type</em>’ to ‘<em>PCM</em>’ soit plays correctly when scrubbing in timeline.</p></blockquote><h3 id="more"><a class="markdownIt-Anchor" href="#more"></a> More</h3><p>There are of course different actor types in the level that the level sequencecan possess/bind to. Such as <em>Light Actors, Gameplay Actors, Visual EffectsActors</em> and more.</p><h2 id="sub-sequence-and-shot"><a class="markdownIt-Anchor" href="#sub-sequence-and-shot"></a> Sub-sequence and Shot</h2><p>There are other two types of concept I’d like to touch upon:<em>Subsequences</em> and <em>Shots</em>.</p><p>They are usually not directly bound to an actor, but they are containers fora level sequence that does. They can be very useful to organize and compositethe cinematic level sequence structure.</p><p><img src="https://i.imgur.com/hrVKhin.png" alt="subsequence" /></p><p><a href="https://docs.unrealengine.com/5.0/en-US/cinematic-subscequences-track-in-unreal-engine/">Subsequences</a>represent an entire Level Sequence.Having subsequences allows multiple level sequence to be added into a “parent” level sequence,These subsequences can be considered as the partition of the “parent” and can be worked on as differentsub-scenes by different artists.</p><p><img src="https://docs.unrealengine.com/4.27/Images/AnimatingObjects/Sequencer/Overview/TracksShot/Thumbnails.png" alt="shot" /></p><p>(Image from Unreal)</p><p>Similar to Subsequence, each <em>Shot Section</em> represents a Level Sequence,it allows multiple level sequences be assembled and re-arranged freely on the<em>Shots Track</em> as Shot <em>Section</em> to form the full sequence/cinematic. Thisis to get rendering in Unreal to work correctly, and able to set per-shotpreset in Movie Render Queue.</p><blockquote><p><strong>Note:</strong> avoid using the “lock” property in any of the clip as it sometimes causesun-wanted behaviours.</p></blockquote><h3 id="high-quality-render-with-motion-blur"><a class="markdownIt-Anchor" href="#high-quality-render-with-motion-blur"></a> High Quality Render with Motion Blur</h3><p>When implementing a setup with a full sequence length animation clip(skeletal mesh .fbx not being broken down into shots). It is important to followthe following to ensure there’s no Motion Blur produce during camera cuts.</p><ul><li><p>Camera: separate camera actor for each shot.</p></li><li><p>Animation: leave the animation clip as ‘Keep State’ when finished if possible.</p></li><li><p>Subsequence: a good practice is to not extend sub-sequence range over theshot active range; Unreal still calculates motion in sub-sequence extending beyondthe range of the shot active range such as Motion Blur, which can produceunwanted result during cuts between shots.</p></li><li><p>Render Preset</p><ul><li>Camera Setting has to be set to ‘Frame Close’</li><li>Anti-aliasing Setting can be toggled on for better quality</li></ul></li></ul><p>For more information on setting up a sequencer with correct first frame, see<a href="https://dev.epicgames.com/community/learning/tutorials/l4OR/unreal-engine-movie-render-queue-warmup-and-first-frame-issues">Epic’s post on render warm-ups</a></p><h2 id="references"><a class="markdownIt-Anchor" href="#references"></a> References</h2><p><a href="https://docs.unrealengine.com/5.0/en-US/cinematics-and-movie-making-in-unreal-engine/">Unreal Engine Documentation - Cinematics and Sequencer</a></p>]]></content>
    
    
    <summary type="html">Unlock the full potential of Unreal Engine and create professional-quality cinematic with our easy-to-follow guide. Our step-by-step tutorial provides practical examples and best practices for enhancing your storytelling and creating immersive experiences. Whether you&#39;re a beginner or an advanced user, our guide will help you master the techniques needed to take your cinematic to the next level.</summary>
    
    
    
    <category term="unreal cinematic" scheme="https://www.xingyulei.com/categories/unreal-cinematic/"/>
    
    
    <category term="pipeline" scheme="https://www.xingyulei.com/tags/pipeline/"/>
    
    <category term="unreal" scheme="https://www.xingyulei.com/tags/unreal/"/>
    
  </entry>
  
  <entry>
    <title>No More Freezing using Qt Multithreading: Learn with Examples</title>
    <link href="https://www.xingyulei.com/post/qt-threading/"/>
    <id>https://www.xingyulei.com/post/qt-threading/</id>
    <published>2022-05-15T07:00:00.000Z</published>
    <updated>2023-11-03T04:02:22.472Z</updated>
    
    <content type="html"><![CDATA[<h2 id="introduction"><a class="markdownIt-Anchor" href="#introduction"></a> Introduction</h2><p>It is inevitable that some of our tasks in the program will take long time to run,leaving the user staring at a frozen screen, whether it is reading/writing a large file,searching database or syncing assets. In a production environment,these seconds can really add up for the entire team; can you imaginehow many working hours are wasted when every user need to wait for,let’s say, a library tool to query the entire asset database and finally displaying themevery single time.</p><p>We can surely improve the query, but that’s usually not where the bottleneck is.The speed of querying is usually sufficient for human brain to process. Whatwe want is not to be slow down by un-interactive GUI.So, why not have assets to fill little by little in a continuous stream, orjust query their name first, and use a separate thread to load in rest of the informationlike date created, author and thumbnail.</p><p>Now, let’s get straight to the point. I’m going to show three basic examplesof different methods to deal with frozen GUI, each has its own use cases.</p><h2 id="example-issue"><a class="markdownIt-Anchor" href="#example-issue"></a> Example Issue</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Window</span>(QtWidgets.QMainWindow):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, parent=<span class="literal">None</span></span>):</span><br><span class="line">        QtWidgets.QMainWindow.__init__(self, parent)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ui setup: please ignore</span></span><br><span class="line">        widget = QtWidgets.QWidget()</span><br><span class="line">        layout = QtWidgets.QGridLayout()</span><br><span class="line"></span><br><span class="line">        button = QtWidgets.QPushButton(<span class="string">&#x27;run task!&#x27;</span>)</span><br><span class="line">        button.clicked.connect(self.run_long_task)</span><br><span class="line">        edit = QtWidgets.QLineEdit()</span><br><span class="line"></span><br><span class="line">        layout.addWidget(edit, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        layout.addWidget(button, <span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">        widget.setLayout(layout)</span><br><span class="line">        self.setCentralWidget(widget)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run_long_task</span>(<span class="params">self</span>):</span><br><span class="line">        time.sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app = QtWidgets.QApplication(sys.argv)</span><br><span class="line">    win = Window()</span><br><span class="line">    win.show()</span><br><span class="line">    sys.exit(app.exec_())</span><br></pre></td></tr></table></figure><p>Here I created a simple example to show how a long-running taskcan block controls in our Qt Gui.</p><p>The <code>run_long_task()</code> is simply a <code>time.sleep()</code> that will halt for 2 secondsutil returning control back to the main event loop.</p><p>After evoking the <code>run_long_task()</code> method, we canno longer interact with the line edit from our UI, until the task has finished.</p><table><thead><tr><th style="text-align:center"><img src="https://i.imgur.com/VZBrqsw.gif" alt="no-work" /></th></tr></thead><tbody><tr><td style="text-align:center">(Clicking and typing has no effect while task is running)</td></tr></tbody></table><h2 id="processevent"><a class="markdownIt-Anchor" href="#processevent"></a> <code>processEvent()</code></h2><p>Using <code>QApplication.processEvent()</code> can achieve a <strong>semi-interactive</strong> GUIduring a long-running task. Here’s to show what I meant.</p><p>Let’s add a progress bar to track our task status.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Window</span>(QtWidgets.QMainWindow):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, parent=<span class="literal">None</span></span>):</span><br><span class="line">        QtWidgets.QMainWindow.__init__(self, parent)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ui setup: add progress bar</span></span><br><span class="line">        self.ui_progress = QtWidgets.QProgressBar()</span><br><span class="line">        self.statusBar().addPermanentWidget(self.ui_progress)</span><br><span class="line">        ...</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update_status</span>(<span class="params">status_bar, msg</span>):</span><br><span class="line">    status_bar.showMessage(msg, <span class="number">2000</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update_progress</span>(<span class="params">progress_bar, value</span>):</span><br><span class="line">    progress_bar.setValue(value)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> value &gt;= <span class="number">100</span>:</span><br><span class="line">        progress_bar.setVisible(<span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">elif</span> progress_bar.isHidden():</span><br><span class="line">        progress_bar.setVisible(<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>And now, by evoking thestatic method <code>processEvent()</code> during the long-running task, we enforceQt to handle normal events like updating GUI, and respond to our user input,before handing the control back to the task.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">run_long_task</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">11</span>):</span><br><span class="line">        sleep(<span class="number">0.5</span>)</span><br><span class="line">        update_status(self.statusBar(), <span class="built_in">str</span>(i))</span><br><span class="line">        update_progress(self.ui_progress, i*<span class="number">10</span>)</span><br><span class="line">        </span><br><span class="line">        QtCore.QCoreApplication.processEvents()</span><br></pre></td></tr></table></figure><p>Now, as we can see, our main GUI can update the progress bar and messages,and even allow us to sort of interact with the line edit, but the interaction is by nomeans smooth.</p><table><thead><tr><th style="text-align:center"><img src="https://i.imgur.com/J3a5hdT.gif" alt="processEvent" /></th></tr></thead><tbody><tr><td style="text-align:center">(Somewhat interactive, yet choppy)</td></tr></tbody></table><p>Before we create a real multi-threading solution, first,let’s establish a signal slot workflow that Qt provides: instead ofupdating the progress bar and status bar by calling its method directly,we emit a signal to handle that.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">    ...</span><br><span class="line">    self.progressed.connect(<span class="keyword">lambda</span> value: update_progress(self.ui_progress, value))</span><br><span class="line">    self.messaged.connect(<span class="keyword">lambda</span> msg: update_status(self.statusBar(), msg))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run_long_task</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">11</span>):</span><br><span class="line">        sleep(<span class="number">0.5</span>)</span><br><span class="line">        self.progressed.emit(<span class="built_in">int</span>(i*<span class="number">10</span>))</span><br><span class="line">        self.messaged.emit(<span class="built_in">str</span>(i))</span><br></pre></td></tr></table></figure><h3 id="qthread"><a class="markdownIt-Anchor" href="#qthread"></a> QThread</h3><script src="https://gist.github.com/leixingyu/9601e352eba22124a0f97e1fc574a262.js"></script><p>Instead of directly subclassing <code>QThread()</code>, it is recommended by many tocreate a <code>QObject()</code> and attach it to a <code>QThread()</code>. The <code>QObject()</code> we created,known as the worker, will be running our long-running task, and emits theupdate signals.</p><p>It is important to keep a note that, the <code>QThread()</code> that houses our worker needs to live in the mainevent loop (i.e. kept in the main application as <code>self.__thread</code>).If not, it will be collected by <em>gc</em> and the thread will exit pre-maturely.</p><p><code>thread.worker = worker</code> is also essential if the worker doesn’t live in the mainevent loop (i.e. <code>self.__worker</code>).</p><p>Now as we can see, we can freely interact with the line edit while the long-runningtask is handled in the background.</p><table><thead><tr><th style="text-align:center"><img src="https://i.imgur.com/CXxVPC4.gif" alt="qthread" /></th></tr></thead><tbody><tr><td style="text-align:center">(Very smooth typing)</td></tr></tbody></table><h3 id="qthreadpool-and-qrunnable"><a class="markdownIt-Anchor" href="#qthreadpool-and-qrunnable"></a> QThreadPool and QRunnable</h3><p>A natural progression would be handling multiple long-running tasks,luckily, we have <code>QThreadPool</code> for that.</p><p>In the following example, we have <strong>three</strong> long-running task in the background,while we still have free control of the main GUI.</p><table><thead><tr><th style="text-align:center"><img src="https://i.imgur.com/ru7UWl1.gif" alt="qthreadpool" /></th></tr></thead><tbody><tr><td style="text-align:center">(Multiple threads and smooth typing)</td></tr></tbody></table><script src="https://gist.github.com/leixingyu/f5fc3cc1ef03db1f254dab2a23b85bc7.js"></script><ul><li><p><code>QThreadPool</code> manages <code>QRunnable</code>, which doesn’t have built-in signals, thus weneed to attach signals externally by creating a <code>QObject</code> to store them.</p></li><li><p><code>QThreadPool</code> also deletes the <code>QRunnable</code> instances automatically when it finishes by default.</p></li><li><p>if max thread is exceeded, the process is queued until a thread is available.</p></li></ul><h2 id="reference"><a class="markdownIt-Anchor" href="#reference"></a> Reference</h2><p><a href="https://www.pythonguis.com/tutorials/multithreading-pyqt-applications-qthreadpool/">PythonGUIs - Multithreading PyQt5 applications with QThreadPool</a></p><p><a href="https://mayaposch.wordpress.com/2011/11/01/how-to-really-truly-use-qthreads-the-full-explanation/">Maya’s Programming &amp; Electronics Blog - How To Really, Truly Use QThreads; The Full Explanation</a></p><p><a href="https://stackoverflow.com/questions/6783194">Stack Overflow - Background thread with QThread in PyQt</a></p><p><a href="https://doc.qt.io/qt-5/qcoreapplication.html#processEvents">Qt doc - Process Events</a></p>]]></content>
    
    
    <summary type="html">Say goodbye to freezing with Qt multithreading using our comprehensive tutorial. Learn how to use multithreading to create responsive and efficient GUI applications, avoid freezing and lag, and improve user experience. Our step-by-step guide provides practical examples and best practices for implementing multithreading in your Qt projects. Whether you&#39;re a beginner or an advanced user, our tutorial will help you master the techniques needed to create high-quality and responsive GUI applications with Qt.</summary>
    
    
    
    <category term="tech summary" scheme="https://www.xingyulei.com/categories/tech-summary/"/>
    
    
    <category term="threading" scheme="https://www.xingyulei.com/tags/threading/"/>
    
    <category term="pyqt" scheme="https://www.xingyulei.com/tags/pyqt/"/>
    
    <category term="template" scheme="https://www.xingyulei.com/tags/template/"/>
    
  </entry>
  
  <entry>
    <title>Create Stunning Pie Charts in Qt : A Step-by-Step Tutorial</title>
    <link href="https://www.xingyulei.com/post/qt-pie-chart/"/>
    <id>https://www.xingyulei.com/post/qt-pie-chart/</id>
    <published>2022-04-27T07:00:00.000Z</published>
    <updated>2023-11-03T03:56:46.033Z</updated>
    
    <content type="html"><![CDATA[<h2 id="introduction"><a class="markdownIt-Anchor" href="#introduction"></a> Introduction</h2><p>It’s time to learn new stuff again. This time, I want to implement adata visualization component in my tool: pie charts. I had some experiencewith <code>matplotlib</code> before, but I’m excited to find out that Qthas an add-on module <code>QtCharts</code> that can integrate with Qt application.</p><p>Here are my learning results: on the left side, I created a static and simplistic designand on the right side, a slightly more flashy, animated design.</p><p>In this blog, I will break down how they are created. They are also availablein my <a href="https://github.com/leixingyu/guiUtil/blob/master/template/pieChart.py">guiUtil</a> with full code.</p><table>    <tr>        <td>            <img src="https://i.imgur.com/Gz2ykTF.png" alt="static" width="600px">            <br>            <a href="#example-1">Example #1</a>        </td>        <td>            <img src="https://i.imgur.com/fR6H2PO.gif" alt="animate" width="500px">            <br>            <a href="#example-2">Example #2</a>        </td>    </tr></table><h2 id="installing-qtcharts"><a class="markdownIt-Anchor" href="#installing-qtcharts"></a> Installing <code>QtCharts</code></h2><p><code>QtCharts</code> was first introduced as an add-on module in Qt in version 5.7,so the <a href="https://github.com/mottosso/Qt.py">Qt.py</a> for Python Qt binding doesn’tsupport <code>QtCharts</code> as it isn’t available in PyQt and PySide.</p><ol><li><p>check your PySide2 or PyQt5 version:<code>QtCore.qVersion()</code>. (I’m using PyQt5 version 5.15.2)</p></li><li><p>install the corresponding version of <a href="https://pypi.org/project/PyQtChart/">PyQtChart</a> using</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install PyQtChart</span><br></pre></td></tr></table></figure></li><li><p>finally, test import <code>from PyQt5 import QtCharts</code></p></li></ol><h2 id="the-basics"><a class="markdownIt-Anchor" href="#the-basics"></a> The Basics</h2><h3 id="classes"><a class="markdownIt-Anchor" href="#classes"></a> Classes</h3><p><a href="https://doc.qt.io/qt-5/qchart.html">QChart</a>:<code>QChart</code> refers to the main diagram, in our case the pie chart is a <code>QChart</code> object.</p><p><a href="https://doc.qt.io/qt-5/qpieseries.html">QPieSeries</a>:To draw a pie chart, we’ll need one or more <code>QPieSeries</code> added to our <code>QChart</code> object,to form the circular shape. To build other types of chart, we’ll want to useSeries such as <code>QBoxPlotSeries</code>, <code>QCandlestickSeries</code>,<code>QXYSeries</code>, <code>QAreaSeries</code> or <code>QAbstractBarSeries</code>.</p><p><a href="https://doc.qt.io/qt-5/qpieslice.html">QPieSlice</a>:a <code>QPieSlice</code> object represents a slice inside a <code>QPieSeries</code> object.</p><p><img src="https://i.imgur.com/vxQHPEz.jpg" alt="explain" /></p><h3 id="components"><a class="markdownIt-Anchor" href="#components"></a> Components</h3><p>There are other components that the examples will cover.</p><p><strong>Value</strong> reflects the size/span of each slice, and is added one by one in run-timeto the <code>QPieSeries</code>. We’re able to retrieve useful information suchas percentage and span angle once all the data is added.</p><p><strong>Label</strong> is a crucial component within the scope of the <code>QPieSlice</code>.Label can be displayed in different ways (Inside the slice: <em>LabelInsideHorizontal, LabelInsideTangential, LabelInsideNormal</em>or outside the slice: <em>LabelOutside</em> with labelArm).</p><p><strong>Legend</strong> in default, is attached to <code>QChart</code>, connecting with the labels ofall the <code>QPieSlice</code>. We can separate it by detaching it or setting each individualmarkers (items) of the legend.</p><p>We also defined an immutable data structure to represent the data fedinto the <code>QChart</code>, which we’ll take a look shortly.</p><h2 id="example-1"><a class="markdownIt-Anchor" href="#example-1"></a> Example 1</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MySimpleChart</span>(QtChart.QChart):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, datas, parent=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="built_in">super</span>(MySimpleChart, self).__init__(parent)</span><br><span class="line">        self._datas = datas</span><br><span class="line"></span><br><span class="line">        self.outer = QtChart.QPieSeries()</span><br><span class="line">        self.set_outer_series()</span><br><span class="line">        self.addSeries(self.outer)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_outer_series</span>(<span class="params">self</span>):</span><br><span class="line">        slices = <span class="built_in">list</span>()</span><br><span class="line">        <span class="keyword">for</span> data <span class="keyword">in</span> self._datas:</span><br><span class="line">            slice_ = QtChart.QPieSlice(data.name, data.value)</span><br><span class="line">            slice_.setLabelVisible()</span><br><span class="line">            slice_.setColor(data.primary_color)</span><br><span class="line">            slice_.setLabelBrush(data.primary_color)</span><br><span class="line"></span><br><span class="line">            slices.append(slice_)</span><br><span class="line">            self.outer.append(slice_)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># label styling</span></span><br><span class="line">        <span class="keyword">for</span> slice_ <span class="keyword">in</span> slices:</span><br><span class="line">            label = <span class="string">&quot;&lt;p align=&#x27;center&#x27; style=&#x27;color:&#123;&#125;&#x27;&gt;&#123;&#125;%&lt;/p&gt;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">round</span>(slice_.percentage()*<span class="number">100</span>, <span class="number">2</span>))</span><br><span class="line">            slice_.setLabel(label)</span><br></pre></td></tr></table></figure><p>We start off by subclassing <code>QChart</code>, we then would want to add a <code>QPieSeries</code>as a container for inserting our slices (generated from our data).</p><p>A simplified process:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pie_chart = QChart()</span><br><span class="line">series = QPieSeries()</span><br><span class="line">slice_ = QPieSlice(label, value)</span><br><span class="line"></span><br><span class="line">series.append(slice_)</span><br><span class="line">pie_chart.addSeries(series)</span><br></pre></td></tr></table></figure><p>note: <em>slice</em> is a Python built-in name so I’m against using it as variable name</p><h3 id="labels-and-legend"><a class="markdownIt-Anchor" href="#labels-and-legend"></a> Labels and Legend</h3><p>As we can see from the example above, we have some flexibility withlabel formatting (<code>QLabel</code> methods and HTML formatting),we can also do legend formatting to some extent. Such as alignment and marker shapes.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">self.legend().setAlignment(QtCore.Qt.AlignRight)</span><br><span class="line">self.legend().setMarkerShape(QtChart.QLegend.MarkerShapeCircle)</span><br></pre></td></tr></table></figure><p>we can even separate legend vs. slice label, so they could display differentcontent(but it may be bad being practice to unlink the two)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> index, marker <span class="keyword">in</span> <span class="built_in">enumerate</span>(self.legend().markers()):</span><br><span class="line">   marker.setLabel(self._datas[index].name)</span><br></pre></td></tr></table></figure><h3 id="other"><a class="markdownIt-Anchor" href="#other"></a> Other</h3><p>Adding variation can be easily done by shifting angles of all the slices.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">offset = <span class="number">40</span></span><br><span class="line">self.outer.setPieStartAngle(offset)</span><br><span class="line">self.outer.setPieEndAngle(offset+<span class="number">360</span>)</span><br></pre></td></tr></table></figure><p>If the outside labels are cramped together, we can create additional spacingby extending the label arm:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slice_.setLabelArmLengthFactor(<span class="number">0.4</span>)</span><br></pre></td></tr></table></figure><h2 id="example-2"><a class="markdownIt-Anchor" href="#example-2"></a> Example 2</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyChart</span>(QtChart.QChart):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, datas, parent=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="built_in">super</span>(MyChart, self).__init__(parent)</span><br><span class="line">        self._datas = datas</span><br><span class="line"></span><br><span class="line">        self.legend().hide()</span><br><span class="line">        self.setAnimationOptions(QtChart.QChart.SeriesAnimations)</span><br><span class="line"></span><br><span class="line">        self.outer = QtChart.QPieSeries()</span><br><span class="line">        self.inner = QtChart.QPieSeries()</span><br><span class="line">        self.outer.setHoleSize(<span class="number">0.35</span>)</span><br><span class="line">        self.inner.setPieSize(<span class="number">0.35</span>)</span><br><span class="line">        self.inner.setHoleSize(<span class="number">0.3</span>)</span><br><span class="line"></span><br><span class="line">        self.set_outer_series()</span><br><span class="line">        self.set_inner_series()</span><br><span class="line"></span><br><span class="line">        self.addSeries(self.outer)</span><br><span class="line">        self.addSeries(self.inner)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_outer_series</span>(<span class="params">self</span>):</span><br><span class="line">        slices = <span class="built_in">list</span>()</span><br><span class="line">        <span class="keyword">for</span> data <span class="keyword">in</span> self._datas:</span><br><span class="line">            slice_ = QtChart.QPieSlice(data.name, data.value)</span><br><span class="line">            slice_.setLabelVisible()</span><br><span class="line">            slice_.setColor(data.primary_color)</span><br><span class="line">            slice_.setLabelBrush(data.primary_color)</span><br><span class="line"></span><br><span class="line">            slices.append(slice_)</span><br><span class="line">            self.outer.append(slice_)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># label styling</span></span><br><span class="line">        <span class="keyword">for</span> slice_ <span class="keyword">in</span> slices:</span><br><span class="line">            color = <span class="string">&#x27;black&#x27;</span></span><br><span class="line">            <span class="keyword">if</span> slice_.percentage() &gt; <span class="number">0.1</span>:</span><br><span class="line">                slice_.setLabelPosition(QtChart.QPieSlice.LabelInsideHorizontal)</span><br><span class="line">                color = <span class="string">&#x27;white&#x27;</span></span><br><span class="line"></span><br><span class="line">            label = <span class="string">&quot;&lt;p align=&#x27;center&#x27; style=&#x27;color:&#123;&#125;&#x27;&gt;&#123;&#125;&lt;br&gt;&#123;&#125;%&lt;/p&gt;&quot;</span>.<span class="built_in">format</span>(</span><br><span class="line">                color,</span><br><span class="line">                slice_.label(),</span><br><span class="line">                <span class="built_in">round</span>(slice_.percentage()*<span class="number">100</span>, <span class="number">2</span>)</span><br><span class="line">                )</span><br><span class="line">            slice_.setLabel(label)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_inner_series</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> data <span class="keyword">in</span> self._datas:</span><br><span class="line">            slice_ = self.inner.append(data.name, data.value)</span><br><span class="line">            slice_.setColor(data.secondary_color)</span><br><span class="line">            slice_.setBorderColor(data.secondary_color)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="inner-and-outer-series"><a class="markdownIt-Anchor" href="#inner-and-outer-series"></a> Inner and Outer Series</h3><p>To create a circular/loop shape pie chart, we need to create a holewith <code>setHoleSize()</code>. And the inner loop and outer loop are two separate seriesadjacent to each other.</p><p>In the example, I used a light color for inner loop (50% blend with white)and used solely the outer loop to display labels and values. Also, in order forlabels to be displayed properly, I added a condition so that label willbe displayed outside when the angle span is less than a threshold.</p><h3 id="exploding-animation"><a class="markdownIt-Anchor" href="#exploding-animation"></a> Exploding Animation</h3><p><code>QPieSlice</code> has a built-in <code>hovered</code> signal for us to achieve theexploding effect when mouse hovering over.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">set_outer_series</span>(<span class="params">self</span>):</span><br><span class="line">   ...</span><br><span class="line">   slice_.hovered.connect(partial(self.explode, slice_))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">explode</span>(<span class="params">self, slice_, is_hovered</span>):</span><br><span class="line">    <span class="keyword">if</span> is_hovered:</span><br><span class="line">        start = slice_.startAngle()</span><br><span class="line">        end = slice_.startAngle()+slice_.angleSpan()</span><br><span class="line">        self.inner.setPieStartAngle(end)</span><br><span class="line">        self.inner.setPieEndAngle(start+<span class="number">360</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        self.inner.setPieStartAngle(<span class="number">0</span>)</span><br><span class="line">        self.inner.setPieEndAngle(<span class="number">360</span>)</span><br><span class="line"></span><br><span class="line">    slice_.setExplodeDistanceFactor(<span class="number">0.1</span>)</span><br><span class="line">    slice_.setExploded(is_hovered)</span><br></pre></td></tr></table></figure><p>The outer loop explosion can be set using <code>slice_.setExploded()</code>; The inner loop shiftingis done by offsetting the pie start and end angle.</p><p>Also, make sure we have set <code>QChart.SeriesAnimations</code> on the <code>QChart</code>object.</p><h2 id="bonus"><a class="markdownIt-Anchor" href="#bonus"></a> Bonus</h2><h3 id="custom-data-class"><a class="markdownIt-Anchor" href="#custom-data-class"></a> Custom Data Class</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"></span><br><span class="line">Data = namedtuple(<span class="string">&#x27;Data&#x27;</span>, [<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;value&#x27;</span>, <span class="string">&#x27;primary_color&#x27;</span>, <span class="string">&#x27;secondary_color&#x27;</span>])</span><br><span class="line"></span><br><span class="line">node = Data(<span class="string">&#x27;Node&#x27;</span>, <span class="number">333</span>, QtGui.QColor(<span class="string">&quot;#82d3e5&quot;</span>), QtGui.QColor(<span class="string">&quot;#cfeef5&quot;</span>))</span><br><span class="line">connection = Data(<span class="string">&#x27;Connection&#x27;</span>, <span class="number">105</span>, QtGui.QColor(<span class="string">&quot;#fd635c&quot;</span>), QtGui.QColor(<span class="string">&quot;#fdc4c1&quot;</span>))</span><br><span class="line">other = Data(<span class="string">&#x27;Other&#x27;</span>, <span class="number">20</span>, QtGui.QColor(<span class="string">&quot;#feb543&quot;</span>), QtGui.QColor(<span class="string">&quot;#ffe3b8&quot;</span>))</span><br></pre></td></tr></table></figure><p>A helper data structure for adding items to our pie chart.</p><p>Generally, only the label/name and the value are required.I also assigned specific color values to achieve certain palette,but they can be randomly generated in the <code>QChart</code> class as well.</p><h3 id="putting-it-together"><a class="markdownIt-Anchor" href="#putting-it-together"></a> Putting it Together</h3><p>The last thing we need to do is add a main body andinstantiate a pie chart with some random data. We do this using a <code>QChartView</code> container.</p><blockquote><p>All the code is available at <a href="https://github.com/leixingyu/guiUtil/blob/master/template/pieChart.py">guiUtil</a>.</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChartView</span>(QtWidgets.QMainWindow):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, parent=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="built_in">super</span>(ChartView, self).__init__(parent)</span><br><span class="line">        self.setFixedSize(QtCore.QSize(<span class="number">700</span>, <span class="number">400</span>))</span><br><span class="line"></span><br><span class="line">        datas = [node, connection, other]</span><br><span class="line">        chart = MySimpleChart(datas)</span><br><span class="line"></span><br><span class="line">        chart_view = QtChart.QChartView(chart)</span><br><span class="line">        chart_view.setRenderHint(QtGui.QPainter.Antialiasing)</span><br><span class="line">        self.setCentralWidget(chart_view)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">global</span> win</span><br><span class="line">    app = QtWidgets.QApplication(sys.argv)</span><br><span class="line">    win = ChartView()</span><br><span class="line">    win.show()</span><br><span class="line">    sys.exit(app.exec_())</span><br></pre></td></tr></table></figure><h2 id="reference"><a class="markdownIt-Anchor" href="#reference"></a> Reference</h2><p><a href="https://doc.qt.io/qt-5/qtcharts-nesteddonuts-example.html">Qt Doc - Nested Donut Example</a></p><p><a href="https://doc.qt.io/qt-5/qlegend.html">Qt Doc - QLegend</a></p><p><a href="https://doc.qt.io/qt-5/qchart.html">Qt Doc - QChart</a></p><p><a href="https://doc.qt.io/qt-5/qpieseries.html">Qt Doc - QPieSeries</a></p><p><a href="https://doc.qt.io/qt-5/qpieslice.html">Qt Doc - QPieSlice</a></p><p><a href="https://stackoverflow.com/questions/56727499">Stack Overflow - Attach colors of my choosing to each slice of QPieSeries</a></p>]]></content>
    
    
    <summary type="html">Compare and contrast the best techniques for creating stunning pie charts in Qt with our comprehensive tutorial. Our step-by-step guide provides practical examples and best practices for designing visually appealing and informative charts. Whether you&#39;re a beginner or an advanced user, our tutorial will help you master the techniques needed to create stunning pie charts in Qt.</summary>
    
    
    
    <category term="tech summary" scheme="https://www.xingyulei.com/categories/tech-summary/"/>
    
    
    <category term="pyqt" scheme="https://www.xingyulei.com/tags/pyqt/"/>
    
    <category term="template" scheme="https://www.xingyulei.com/tags/template/"/>
    
  </entry>
  
  <entry>
    <title>Run Python Commands as Admin (with Examples)</title>
    <link href="https://www.xingyulei.com/post/py-admin/"/>
    <id>https://www.xingyulei.com/post/py-admin/</id>
    <published>2022-03-19T07:00:00.000Z</published>
    <updated>2023-11-03T03:51:47.351Z</updated>
    
    <content type="html"><![CDATA[<h2 id="introduction"><a class="markdownIt-Anchor" href="#introduction"></a> Introduction</h2><p>We often find ourselves needing to automate tasks on Windows machine,Although there are many Python libraries out there that supports somecommon Windows operations and even cross-platforms.It is really hard to substitute Window’s Command Prompt and PowerShell,as they are extremely useful in cases where we need to access differentWindows components, configure settings and troubleshooting.</p><h3 id="user-account-control-uac"><a class="markdownIt-Anchor" href="#user-account-control-uac"></a> User Account Control (UAC)</h3><p>Standard user accounts are for day-to-day activities with less permission,while the administrator account has elevated access for all features.</p><p>For my personal machine, I’m operating on adminaccount all time (as the sole user). But Windows, for security reasons,still treats most of my actions as standard account.It only elevates to admin privilege when my operations want to make internal changesto Windows settings and my machine.</p><p>The UAC feature when enabled, prompts theuser when such action occurred and request for admin access. Additionally, for standard user,it means they need to ask for administrator account login.</p><table style="width: 70%">    <tr>        <td>            <img src="https://imgur.com/7PejmM2.png" alt="admin" width="500px">            <br/>When the sign in is an <b>administrator type</b> account<br/>        </td>        <td>            <img src="https://www.adminbyrequest.com/Images/Blogs/UAC%20Prompt.png" alt="std" width="500px">            <br/>When the sign in is a <b>standard type</b> account<br/>        </td>    </tr></table><p>Now, in terms of task automation in Python, we’ll also want tofigure out how to run certain operations with Admin privilege.</p><h3 id="using-subprocess"><a class="markdownIt-Anchor" href="#using-subprocess"></a> Using <code>subprocess</code></h3><p>Like most of us, I have been using <code>subprocess</code> to evoke <code>cmd.exe</code> or <code>powershell.exe</code> as desiredby passing arguments as list into the function.</p><ul><li>Command Prompt: <code>command = ['cmd.exe', '/c', &lt;argument&gt;]</code></li><li>PowerShell: <code>command = ['powershell.exe', '-command', &lt;argument&gt;]</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">runCmd</span>(<span class="params">*args</span>):</span><br><span class="line">    p = subprocess.Popen(</span><br><span class="line">        *args,</span><br><span class="line">        stdout=subprocess.PIPE,</span><br><span class="line">        stderr=subprocess.STDOUT</span><br><span class="line">    )</span><br><span class="line">    out, error = p.communicate()</span><br><span class="line">    <span class="keyword">return</span> out, error</span><br></pre></td></tr></table></figure><p>But this doesn’t grant the process with admin privilege, and won’t notify us with UAC.</p><p>How to achieve this? here are some ways to do it.</p><h2 id="using-shellexecute-runas"><a class="markdownIt-Anchor" href="#using-shellexecute-runas"></a> Using ShellExecute <code>runas</code></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line">commands = <span class="string">u&#x27;/k echo hi&#x27;</span></span><br><span class="line">ctypes.windll.shell32.ShellExecuteW(</span><br><span class="line">        <span class="literal">None</span>,</span><br><span class="line">        <span class="string">u&quot;runas&quot;</span>,</span><br><span class="line">        <span class="string">u&quot;cmd.exe&quot;</span>,</span><br><span class="line">        commands,</span><br><span class="line">        <span class="literal">None</span>,</span><br><span class="line">        <span class="number">1</span></span><br><span class="line">    )</span><br></pre></td></tr></table></figure><p><code>runas</code> from the <a href="https://docs.microsoft.com/en-us/windows/win32/api/shellapi/nf-shellapi-shellexecutew">Windows API</a>launches an application as Administrator.User Account Control (UAC) will prompt the user for consent to run the applicationelevated or enter the credentials of an administrator account used to run the application.</p><p>What about a more pythonic approach?</p><h2 id="using-runas-in-command-prompt"><a class="markdownIt-Anchor" href="#using-runas-in-command-prompt"></a> Using <code>runas</code> in Command Prompt</h2><p><code>runas</code> application runs commandas a different user; it is most commonly used but not limited to perform operationwith administrator account for granting admin access.</p><blockquote><p>Note: the password is handled outside UAC, which may notbe the desired behavior</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">command = [<span class="string">&#x27;cmd.exe&#x27;</span>, <span class="string">&#x27;/c&#x27;</span>, <span class="string">&#x27;runas&#x27;</span>, <span class="string">&#x27;/user:administrator&#x27;</span>, <span class="string">&#x27;regedit&#x27;</span>]</span><br><span class="line">p = subprocess.Popen(command, stdin=subprocess.PIPE)</span><br><span class="line">p.stdin.write(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">p.communicate()</span><br></pre></td></tr></table></figure><h2 id="using-powershell-verb-runas"><a class="markdownIt-Anchor" href="#using-powershell-verb-runas"></a> Using PowerShell <code>-Verb Runas</code></h2><p>This is my preferred method, since it is most flexible and alsoevokes UAC for admin access.</p><ul><li><p><strong>Start-Process</strong></p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Start-Process &lt;executable&gt; -argumentlist &lt;arugments&gt; -Verb Runas</span><br></pre></td></tr></table></figure></li><li><p><strong>Call operator (&amp;)</strong></p><p>by adding call operator, we are able to run commands not limited in the environment path,also not need to worry about spaces in our path.</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp; &#123;Start-Process &lt;executable&gt; -argumentlist &lt;arugments&gt; -Verb Runas&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>-ExecutionPolicy Bypass</strong></p><p>Sometimes, a security setting will prevent PowerShell running a <em>.ps1</em> file,and we’ll need to bypass execution policy:</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Start-Process &lt;executable&gt; -ExecutionPolicy Bypass -File &lt;file&gt;</span><br></pre></td></tr></table></figure></li></ul><p>It is very obvious from the above example,we can basically use PowerShell to wrap aroundanything, including Command Prompt.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Start-Process cmd.exe -argumentlist &#x27;/k &quot;dir&quot;&#x27; -Verb Runas</span><br></pre></td></tr></table></figure><p>To bundle everything together, a working example would look like this in Python:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ps_command = <span class="string">&quot;&amp; &#123;&#123;Start-Process cmd.exe -argumentlist &#x27;/k \&quot;dir\&quot;&#x27; -Verb Runas&#125;&#125;&quot;</span></span><br><span class="line">command = [<span class="string">&#x27;powershell.exe&#x27;</span>, <span class="string">&#x27;-command&#x27;</span>, ps_command]</span><br><span class="line">runCmd(command)</span><br></pre></td></tr></table></figure><p>essentially using <code>subprocess</code> to run PowerShell in admin using <code>-Verb Runas</code>to execute command <code>/k dir</code> in Command Prompt (which also has elevated access).</p><h3 id="redirect-output"><a class="markdownIt-Anchor" href="#redirect-output"></a> Redirect Output</h3><p>By doing the above, we are running an executable within a process.the sacrifice is that it is difficult to pass the output,but here’s a few workarounds:</p><p><strong>Output results to a file</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Start-Process cmd.exe -argumentlist &#x27;/c &quot;dir&quot;&#x27; -redirectStandardOutput &quot;C:\Users\xlei\Desktop\temp.txt&quot;</span><br></pre></td></tr></table></figure><p><strong>Output result to the console</strong></p><p>Just the exit code:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">output = Start-Process cmd.exe -argumentlist <span class="string">&#x27;/c &quot;dir&quot;&#x27;</span> -PassThru -Wait</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">output.ExitCode</span></span><br></pre></td></tr></table></figure><p>A neat function I found <a href="https://stackoverflow.com/a/52629677/15214802">here</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">function Start-ProcessWithOutput</span><br><span class="line">&#123;</span><br><span class="line">    param ([string]$Path,[string[]]$ArgumentList)</span><br><span class="line">    $Output = New-Object -TypeName System.Text.StringBuilder</span><br><span class="line">    $Error = New-Object -TypeName System.Text.StringBuilder</span><br><span class="line">    $psi = New-object System.Diagnostics.ProcessStartInfo </span><br><span class="line">    $psi.CreateNoWindow = $true </span><br><span class="line">    $psi.UseShellExecute = $false </span><br><span class="line">    $psi.RedirectStandardOutput = $true </span><br><span class="line">    $psi.RedirectStandardError = $true </span><br><span class="line">    $psi.FileName = $Path</span><br><span class="line">    if ($ArgumentList.Count -gt 0)</span><br><span class="line">    &#123;</span><br><span class="line">        $psi.Arguments = $ArgumentList</span><br><span class="line">    &#125;</span><br><span class="line">    $process = New-Object System.Diagnostics.Process </span><br><span class="line">    $process.StartInfo = $psi </span><br><span class="line">    [void]$process.Start()</span><br><span class="line">    do</span><br><span class="line">    &#123;</span><br><span class="line">       if (!$process.StandardOutput.EndOfStream)</span><br><span class="line">       &#123;</span><br><span class="line">           [void]$Output.AppendLine($process.StandardOutput.ReadLine())</span><br><span class="line">       &#125;</span><br><span class="line">       if (!$process.StandardError.EndOfStream)</span><br><span class="line">       &#123;</span><br><span class="line">           [void]$Error.AppendLine($process.StandardError.ReadLine())</span><br><span class="line">       &#125;</span><br><span class="line">       Start-Sleep -Milliseconds 10</span><br><span class="line">    &#125; while (!$process.HasExited)</span><br><span class="line"></span><br><span class="line">    #read remainder</span><br><span class="line">    while (!$process.StandardOutput.EndOfStream)</span><br><span class="line">    &#123;</span><br><span class="line">        #write-verbose &#x27;read remaining output&#x27;</span><br><span class="line">        [void]$Output.AppendLine($process.StandardOutput.ReadLine())</span><br><span class="line">    &#125;</span><br><span class="line">    while (!$process.StandardError.EndOfStream)</span><br><span class="line">    &#123;</span><br><span class="line">        #write-verbose &#x27;read remaining error&#x27;</span><br><span class="line">        [void]$Error.AppendLine($process.StandardError.ReadLine())</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return @&#123;ExitCode = $process.ExitCode; Output = $Output.ToString(); Error = $Error.ToString(); ExitTime=$process.ExitTime&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">p = Start-ProcessWithOutput cmd.exe -argumentlist <span class="string">&#x27;/c &quot;dir&quot;&#x27;</span></span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">p.ExitCode</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">p.Output</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">p.Error</span></span><br></pre></td></tr></table></figure><h2 id="run-python-as-admin"><a class="markdownIt-Anchor" href="#run-python-as-admin"></a> Run Python as Admin</h2><p>Running the whole python script in Admin, meaning that the subsequent processeswill have admin access, if this is the behaviour you prefer.</p><script src="https://gist.github.com/leixingyu/a2cc64cec76638d2367cd4c2fc1b94ec.js"></script><h2 id="references"><a class="markdownIt-Anchor" href="#references"></a> References</h2><p><a href="https://superuser.com/questions/615654">Stack Exchange - Run .exe file via Python as Administrator</a></p><p><a href="https://stackoverflow.com/questions/8097354/">Stack Overflow - How do I capture the output into a variable from an external process in PowerShell?</a></p><p><a href="https://stackoverflow.com/questions/8925323/">Stack Overflow - Redirection of standard and error output appending to the same log file</a></p><p><a href="https://stackoverflow.com/questions/11531068/">Stack Overflow - Powershell: Capturing standard out and error with Process object</a></p><p><a href="https://www.windows-commandline.com/windows-runas-command-prompt/">Windows Commandline - Windows runas command syntax and examples</a></p>]]></content>
    
    
    <summary type="html">Discover how to run Python commands with admin privileges using our step-by-step tutorial. Our guide provides practical examples and best practices for elevating your Python scripts and automating system-level tasks. Whether you&#39;re a Windows user or a Linux enthusiast, our tutorial will help you unlock the full potential of Python and enhance your productivity.</summary>
    
    
    
    <category term="tech summary" scheme="https://www.xingyulei.com/categories/tech-summary/"/>
    
    
    <category term="python" scheme="https://www.xingyulei.com/tags/python/"/>
    
    <category term="windows" scheme="https://www.xingyulei.com/tags/windows/"/>
    
    <category term="batch" scheme="https://www.xingyulei.com/tags/batch/"/>
    
  </entry>
  
  <entry>
    <title>Automate IK FK Matching in Maya</title>
    <link href="https://www.xingyulei.com/post/maya-ik-fk-match/"/>
    <id>https://www.xingyulei.com/post/maya-ik-fk-match/</id>
    <published>2022-02-27T08:00:00.000Z</published>
    <updated>2023-11-03T03:50:21.378Z</updated>
    
    <content type="html"><![CDATA[<h2 id="introduction"><a class="markdownIt-Anchor" href="#introduction"></a> Introduction</h2><p>IK/FK matching refers to the ability to match any IK pose to FK pose andvice versa. But how does it work?</p><p>I’m going to summarize the basic approaches I learned along the way.One of them is math-based, and the other being Maya operational-based,which utilizes Maya’s built-in constraint nodes,this is more straight-forward and easy as it does the calculation for us.</p><p>Since we use controllers to drive joint movement in rigs,the general idea of a IK/FK matching is to reverse this process,and find the transformation of a controller based off the joint’s transformation.</p><blockquote><p>Note:There’s no one easy way to deal with all custom rig setups, this isdue to operations like parenting, orienting joint and freezing transformation.Transformation offsets occurs between joint and controller, even in world space.I’ll cover these more complex scenarios as references <a href="#further-reading">here</a>.</p></blockquote><h2 id="fk-matching"><a class="markdownIt-Anchor" href="#fk-matching"></a> FK Matching</h2><img src="https://i.imgur.com/q9kcckN.gif" alt="fk-match" width="800px"><p>FK is all about matching rotation, given that FK controllerconstraints the corresponding joint’s orientation.</p><p>Thus, in reverse, given the result joint’s transform,we should be able to find the FK controller’s rotation. Andknowing how one of them works can translate to all the other joints and FKs(respectively, shoulder, elbow and wrist in arm and clavicle, knee and ankle in leg).</p><p><a name="fk-script"></a></p><h3 id="script"><a class="markdownIt-Anchor" href="#script"></a> Script</h3><ol><li><p>obtain the <strong>world space</strong> rotation of the joint whileit is still in IK mode</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># in IK mode</span></span><br><span class="line">rotation = cmds.xform(jnt, ro=<span class="number">1</span>, ws=<span class="number">1</span>, q=<span class="number">1</span>)</span><br></pre></td></tr></table></figure></li><li><p>switch to FK mode and apply the <strong>world space</strong> rotation onto the FK controller</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># in FK mode</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">snap_fk_to_jnt</span>(<span class="params">ctrl, target_rotation</span>):</span><br><span class="line">    cmds.xform(ctrl, ro=target_rotation, ws=<span class="number">1</span>)</span><br></pre></td></tr></table></figure></li></ol><p><a name="fk-operation"></a></p><h3 id="maya-operation"><a class="markdownIt-Anchor" href="#maya-operation"></a> Maya Operation</h3><p>We can utilize Maya’s constraint to match rotation.Such as, in a three-chain setup, we could let IK joints to rotation constraintthe FK controllers without maintaining offset. But for a single-chain setupwith both FK and IK controllers sharing the joint,doing so will cause cycle evaluation.</p><p>To get around this, we use a temporary empty transform nodethat is <strong>relatively</strong> parented under the joint. This temporarynode (the match node) will be used to constraint the FK controller, and once thematching completes, we can safely delete the constraint and the match node itself.</p><h2 id="ik-matching"><a class="markdownIt-Anchor" href="#ik-matching"></a> IK Matching</h2><img src="https://i.imgur.com/iJIrrML.gif" alt="ik-match" width="800px"><p>IK Matching matches IK controllerto the joint’s transform in FK mode.For IK handle, we need to match both the top joint’s (wrist or ankle) translation and rotation value;For IK pole vector, we only need to match the mid-joint’s (elbow or knee) translation.</p><p>We already figured out how to acquire and match rotation in FK matching,which can be directly used in matching IK handle, so we’ll focus on how tomatch translation below.</p><p><a name="ik-script"></a></p><h3 id="script-2"><a class="markdownIt-Anchor" href="#script-2"></a> Script</h3><ol><li><p>obtain the <strong>world space</strong> translation of the joint whileit is still in FK mode</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># in FK mode</span></span><br><span class="line">translation = cmds.xform(jnt, t=<span class="number">1</span>, ws=<span class="number">1</span>, q=<span class="number">1</span>)</span><br></pre></td></tr></table></figure></li><li><p>switch to IK mode and apply the <strong>world space</strong> translation onto the IK Handle</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># in IK mode</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">snap_ik_to_jnt</span>(<span class="params">ik, target_pos</span>):</span><br><span class="line">    cmds.xform(ik, t=target_pos, ws=<span class="number">1</span>)</span><br></pre></td></tr></table></figure></li></ol><p><a name="ik-operation"></a></p><h3 id="maya-operation-2"><a class="markdownIt-Anchor" href="#maya-operation-2"></a> Maya Operation</h3><p>Similar to FK matching, we create a match node that inherits thetarget joint’s transformation in FK mode;Then we use it to parent constraint the IK handles (position constraint the IK pole)without maintain offset.Once the IKs snaps to the target position, we then safely delete the constraint and the match node.</p><h3 id="pole-vector-one-step-further"><a class="markdownIt-Anchor" href="#pole-vector-one-step-further"></a> Pole Vector: One Step Further</h3><p>In the example above, IK pole vector will directly snap on top of the elbow or knee joint.Doing so will achieve the IK matching effect, but we often want the pole vector to extenda little further outwards, this gives more room for animators and avoids joint flipping.</p><p>To extend the pole vector outwards, we need to acquire the directional vectorfrom mid-point of the root and top joint of the rig chain to the mid-joint.</p><img src="https://i.imgur.com/pIPPm2t.png" width="500px" alt="ik-pole"><p>It is easier to achieve this through script:</p><ol><li><p>convert positional value to vector as Maya doesn’t support operationon position (represented as <code>list[3]</code>)</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root_vec = Vector3(root_pos)</span><br><span class="line">mid_vec = Vector3(mid_pos)</span><br><span class="line">top_vec = Vector3(top_pos)</span><br><span class="line"></span><br><span class="line"><span class="comment"># alternatively, use maya&#x27;s built-in MVector</span></span><br><span class="line"><span class="keyword">from</span> maya.api <span class="keyword">import</span> OpenMaya <span class="keyword">as</span> om</span><br><span class="line">vec = om.MVector(pos[<span class="number">0</span>], pos[<span class="number">1</span>], pos[<span class="number">2</span>])</span><br></pre></td></tr></table></figure></li><li><p>find the mid-point between the root joint and the top joint</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mid_point = (root_vec + top_vec) * <span class="number">0.5</span></span><br></pre></td></tr></table></figure></li><li><p>find the directional vector from mid-point to the mid-joint</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pole_dir = mid_pos - mid_point</span><br></pre></td></tr></table></figure></li><li><p>the pole vector’s target position can be found by extending this directionalvector beyond the mid-joint position with an arbitrary multiplier</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pole_pos = mid_pos + (pole_dir * multiplier)</span><br></pre></td></tr></table></figure></li></ol><h2 id="further-reading"><a class="markdownIt-Anchor" href="#further-reading"></a> Further Reading</h2><p>The above matching logics aren’t bulletproof. What???!!</p><img src="https://i.imgur.com/qgvTH55.gif" width="600px" alt="wrong"><p>Yeah, because not long after releasing my <a href="https://github.com/leixingyu/snapTool">Snap tool</a>,Squirrel Daph found the tool not behaving correctly andkindly sent me the rig for further testing.</p><p>After some troubleshooting, I found that because I built the tool around my auto-generated rig,so there are many things I didn’t account for.The following sections aim to overcome some of my Snap tool’s previous limitations.</p><h3 id="transformation-matrix"><a class="markdownIt-Anchor" href="#transformation-matrix"></a> Transformation Matrix</h3><p>Transformation matrix are commonly used in Computer Graphics,it can be used to represent an object’s transformation in 3D world; Itis an extremely useful knowledge to have in terms of rigging.</p><p>Maya has many built-in ways get the matrix representation of a node’s transformation.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_matrix</span>(<span class="params">node, is_world=<span class="number">1</span></span>):</span><br><span class="line">    <span class="keyword">return</span> om.MMatrix(</span><br><span class="line">        cmds.xform(node, q=<span class="number">1</span>, matrix=<span class="number">1</span>, ws=is_world, os=<span class="keyword">not</span> is_world)</span><br><span class="line">    )</span><br></pre></td></tr></table></figure><p>Converting the Maya matrix representation <code>MMatrix</code> to <code>MTransformationMatrix</code>,gives access to more built-in functions including <a href="#decomposing-matrix">decomposition</a>.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mxform_matrix = om.MTransformationMatrix(mmatrix)</span><br></pre></td></tr></table></figure><p>Or construct by using function set <code>MFnTransform</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_transform_matrix</span>(<span class="params">dag_node</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Get the local transformation matrix of a given dag node</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param dag_node: om.MObject. input maya dag node</span></span><br><span class="line"><span class="string">    :return: om.MTransformationMatrix. local transformation matrix</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    fn_transform = om.MFnTransform(dag_node)</span><br><span class="line">    <span class="keyword">return</span> fn_transform.transformation()</span><br></pre></td></tr></table></figure><p>The differences between <code>om.MMatrix</code> and <code>om.MTransformationMatrix</code>:</p><ul><li><code>om.MMatrix</code> constructed by <code>cmds.xform</code> has access to both local and worldtransformation matrix, but unable to track rotation greater than 360 degrees.</li><li><code>om.MTransformationMatrix</code> using <code>MFnTransform</code> only gets local transformationmatrix, but it stores rotation information greater than 360 degrees.</li></ul><h3 id="translation-offset"><a class="markdownIt-Anchor" href="#translation-offset"></a> Translation Offset</h3><p>When there’s world space offset between IK controller and joint,we would want to account for the offset when calculating the IK result position.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">jnt_pos = Vector(cmds.xform(jnt, ws=<span class="number">1</span>, q=<span class="number">1</span>, t=<span class="number">1</span>))</span><br><span class="line">ik_pos = Vector(cmds.xform(ik, ws=<span class="number">1</span>, q=<span class="number">1</span>, t=<span class="number">1</span>))</span><br><span class="line">offset = jnt_pos - ik_pos</span><br><span class="line"></span><br><span class="line">ik_target_pos = jnt_target_pos - offset</span><br></pre></td></tr></table></figure><h3 id="rotation-offset"><a class="markdownIt-Anchor" href="#rotation-offset"></a> Rotation Offset</h3><p>Rotational offset can be caused by axis in-alignment during constraints,we’ll need to use matrix multiplication to find it instead of simple vector math.</p><img src="https://i.imgur.com/czn3XY1.gif" width="1000px" alt="axis-align"><p>Example of rotation offset between joint and controller</p><h4 id="pre-multiplying-matrix"><a class="markdownIt-Anchor" href="#pre-multiplying-matrix"></a> Pre-multiplying Matrix</h4><blockquote><p>Important:</p><ul><li>the order of matrix multiplication matters</li><li>to get a unit matrix, instead of dividing matrix, wemultiply its inverse matrix</li></ul></blockquote><p>Joint transformation is the result of controller constraints, in whichthe constraint matrix serves as a pre-multiplication matrix.</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>M</mi><mrow><mi>j</mi><mi>o</mi><mi>i</mi><mi>n</mi><mi>t</mi></mrow></msub><mo>=</mo><msub><mi>M</mi><mrow><mi>c</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>t</mi></mrow></msub><mo>∗</mo><msub><mi>M</mi><mrow><mi>c</mi><mi>t</mi><mi>r</mi><mi>l</mi></mrow></msub></mrow><annotation encoding="application/x-tex">M_{joint} = M_{const} * M_{ctrl}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>We are then able to get the constraint matrix by post-multiplying the inverseof controller matrix.</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>M</mi><mrow><mi>j</mi><mi>o</mi><mi>i</mi><mi>n</mi><mi>t</mi></mrow></msub><mo>∗</mo><msubsup><mi>M</mi><mrow><mi>c</mi><mi>t</mi><mi>r</mi><mi>l</mi></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><mo>=</mo><msub><mi>M</mi><mrow><mi>c</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>t</mi></mrow></msub><mo>∗</mo><msub><mi>M</mi><mrow><mi>c</mi><mi>t</mi><mi>r</mi><mi>l</mi></mrow></msub><mo>∗</mo><msubsup><mi>M</mi><mrow><mi>c</mi><mi>t</mi><mi>r</mi><mi>l</mi></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msubsup></mrow><annotation encoding="application/x-tex">{M_{joint}} * M_{ctrl}^{-1} = M_{const} * M_{ctrl} * M_{ctrl}^{-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1555469999999999em;vertical-align:-0.2914389999999999em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-2.408561em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2914389999999999em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1555469999999999em;vertical-align:-0.2914389999999999em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-2.408561em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2914389999999999em;"><span></span></span></span></span></span></span></span></span></span></span></p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>M</mi><mrow><mi>c</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>t</mi></mrow></msub><mo>=</mo><msub><mi>M</mi><mrow><mi>j</mi><mi>o</mi><mi>i</mi><mi>n</mi><mi>t</mi></mrow></msub><mo>∗</mo><msubsup><mi>M</mi><mrow><mi>c</mi><mi>t</mi><mi>r</mi><mi>l</mi></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msubsup></mrow><annotation encoding="application/x-tex">M_{const} = {M_{joint}} * M_{ctrl}^{-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1555469999999999em;vertical-align:-0.2914389999999999em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-2.408561em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2914389999999999em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>In the function below, the result matrix argument would be the joint matrix,and source matrix argument would be the controller matrix.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_pre_mult_matrix</span>(<span class="params">result_mat, source_mat</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Get pre-multiplying matrix</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    :param result_mat: om.MMatrix. the result matrix after multiplication</span></span><br><span class="line"><span class="string">    :param source_mat: om.MMatrix. the source matrix used in pre multiplying</span></span><br><span class="line"><span class="string">    :return: om.MMatrix. matrix used in pre multiplication</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> result_mat * source_mat.inverse()</span><br></pre></td></tr></table></figure><p>Similar process, we are able to find the target controller’s transform based offthe rotational offset and the target joint transform.</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>M</mi><mrow><mi>c</mi><mi>t</mi><mi>r</mi><mi>l</mi></mrow></msub><mo>=</mo><msubsup><mi>M</mi><mrow><mi>c</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>t</mi></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><mo>∗</mo><msub><mi>M</mi><mrow><mi>j</mi><mi>o</mi><mi>i</mi><mi>n</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">M_{ctrl} = M_{const}^{-1} * {M_{joint}} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.1111079999999998em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-2.4530000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">t</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><h4 id="implementation"><a class="markdownIt-Anchor" href="#implementation"></a> Implementation</h4><p>Bringing this back to the context of our IK matching process:</p><p>We know the <strong>current controller</strong> rotation and <strong>current joint</strong> rotation, this will give us theconstraint matrix (rotational offset),</p><p>We also know the <strong>target joint</strong> rotation in world space,Therefore, we can convert this <strong>target joint</strong> rotation to <strong>target controller</strong> rotation in world space.</p><p>Now through script:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># step 1: obtain the constraint matrix</span></span><br><span class="line">current_jnt_rot = matrix.get_matrix(jnt)</span><br><span class="line">current_fk_rot = matrix.get_matrix(fk)</span><br><span class="line">cons_mat = matrix.get_pre_mult_matrix(current_jnt_rot, current_fk_rot)</span><br><span class="line"></span><br><span class="line"><span class="comment"># step 2: get controller&#x27;s target matrix </span></span><br><span class="line">target_ctrl_mat = om.MTransformationMatrix(</span><br><span class="line">  cons_mat.inverse() * target_jnt_mat</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>We can later <a href="#rotation">extract the rotation data</a> from the transformation matrix.</p><h3 id="model-matrix"><a class="markdownIt-Anchor" href="#model-matrix"></a> Model Matrix</h3><p>Model matrix converts transformation matrix from world space to object space,this has no direct usage in the IK/FK matching, as <code>cmds.xform()</code> alreadydoes the work for us. But it’s good to cover as it is very relevant.</p><h4 id="post-multiplying-matrix"><a class="markdownIt-Anchor" href="#post-multiplying-matrix"></a> Post-multiplying Matrix</h4><p>Model matrix is a post-multiplying matrix:</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>M</mi><mrow><mi>w</mi><mi>o</mi><mi>r</mi><mi>l</mi><mi>d</mi></mrow></msub><mo>=</mo><msub><mi>M</mi><mrow><mi>l</mi><mi>o</mi><mi>c</mi><mi>a</mi><mi>l</mi></mrow></msub><mo>∗</mo><msub><mi>M</mi><mrow><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mi>l</mi></mrow></msub></mrow><annotation encoding="application/x-tex">M_{world} = M_{local} * M_{model}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>We now pre-multiply the inverse of the local transform matrix:</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>M</mi><mrow><mi>l</mi><mi>o</mi><mi>c</mi><mi>a</mi><mi>l</mi></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><mo>∗</mo><msub><mi>M</mi><mrow><mi>w</mi><mi>o</mi><mi>r</mi><mi>l</mi><mi>d</mi></mrow></msub><mo>=</mo><msubsup><mi>M</mi><mrow><mi>l</mi><mi>o</mi><mi>c</mi><mi>a</mi><mi>l</mi></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><mo>∗</mo><msub><mi>M</mi><mrow><mi>l</mi><mi>o</mi><mi>c</mi><mi>a</mi><mi>l</mi></mrow></msub><mo>∗</mo><msub><mi>M</mi><mrow><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mi>l</mi></mrow></msub></mrow><annotation encoding="application/x-tex">M_{local}^{-1} * M_{world} = M_{local}^{-1} * M_{local} * M_{model}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1555469999999999em;vertical-align:-0.2914389999999999em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-2.408561em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2914389999999999em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.1555469999999999em;vertical-align:-0.2914389999999999em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-2.408561em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2914389999999999em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>M</mi><mrow><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mi>l</mi></mrow></msub><mo>=</mo><msubsup><mi>M</mi><mrow><mi>l</mi><mi>o</mi><mi>c</mi><mi>a</mi><mi>l</mi></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><mo>∗</mo><msub><mi>M</mi><mrow><mi>w</mi><mi>o</mi><mi>r</mi><mi>l</mi><mi>d</mi></mrow></msub></mrow><annotation encoding="application/x-tex">M_{model} = M_{local}^{-1} *{M_{world}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.1555469999999999em;vertical-align:-0.2914389999999999em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-2.408561em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2914389999999999em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>So similarly we can create the following function, with the result matrix argumentbeing the world transform matrix,and source matrix argument being the local transform matrix.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_post_mult_matrix</span>(<span class="params">result_mat, source_mat</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Get post multiplying matrix</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param result_mat: om.MMatrix. the result matrix after multiplication</span></span><br><span class="line"><span class="string">    :param source_mat: om.MMatrix. the source matrix used in post multiplying</span></span><br><span class="line"><span class="string">    :return: om.MMatrix. matrix used in post multiplication</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> source_mat.inverse() * result_mat</span><br></pre></td></tr></table></figure><h3 id="decomposing-matrix"><a class="markdownIt-Anchor" href="#decomposing-matrix"></a> Decomposing Matrix</h3><p>Decomposing a transformation matrix (<code>om.MTransformationMatrix</code>) refers toacquiring translation, rotation and scale values as individual <code>list[3]</code> type.These values can now be applied using <code>cmds.xform()</code> either in local space orin world space depending on the input transformation matrix.</p><h4 id="translation"><a class="markdownIt-Anchor" href="#translation"></a> Translation</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">translation = matrix.translation(om.MSpace.kWorld)</span><br></pre></td></tr></table></figure><h4 id="scale"><a class="markdownIt-Anchor" href="#scale"></a> Scale</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scale = matrix.scale(om.MSpace.kWorld)</span><br></pre></td></tr></table></figure><h4 id="rotation"><a class="markdownIt-Anchor" href="#rotation"></a> Rotation</h4><p>Extract rotation in axis angles in default <strong>xyz</strong> rotation order.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line">rot_vec = matrix.rotation().asVector()</span><br><span class="line">rotation = [math.degrees(angle) <span class="keyword">for</span> angle <span class="keyword">in</span> (rot_vec.x, rot_vec.y, rot_vec.z)]</span><br></pre></td></tr></table></figure><h2 id="references"><a class="markdownIt-Anchor" href="#references"></a> References</h2><p><a href="http://discourse.techart.online/t/convert-world-space-coordinates-to-object-space-coordinates-in-maya/">Tech Artists Org - Convert world space coordinates to object space coordinates in Maya?</a></p><p><a href="https://math.stackexchange.com/questions/237369/">Stack Exchange - Given this transformation matrix, how do I decompose it into translation, rotation and scale matrices?</a></p><p><a href="https://www.akeric.com/blog/?p=1067">AK Eric - Find Euler rotation values of Maya matrix</a></p><p><a href="https://help.autodesk.com/view/MAYAUL/2018/ENU/?guid=__cpp_ref_class_m_fn_transform_html">Maya Help - MFnTransform Class Reference</a></p><p><a href="https://help.autodesk.com/view/MAYAUL/2018/ENU/?guid=__cpp_ref_class_m_matrix_html">Maya Help - MMatrix Class Reference</a></p><p><a href="https://help.autodesk.com/view/MAYAUL/2018/ENU/?guid=__cpp_ref_class_m_transformation_matrix_html">Maya Help - MTransformationMatrix Class Reference</a></p>]]></content>
    
    
    <summary type="html">Learn how to create realistic and flexible character rigs for games and animations with our tutorial on IK/FK matching in Maya. Our step-by-step guide covers everything from setting up your rig to implementing IK/FK switching for smooth animation. Whether you&#39;re a seasoned pro or just starting out, our tips and tricks will help you take your rigging skills to the next level. Join our community of artists and animators and start creating dynamic characters today!</summary>
    
    
    
    <category term="3d math" scheme="https://www.xingyulei.com/categories/3d-math/"/>
    
    
    <category term="maya" scheme="https://www.xingyulei.com/tags/maya/"/>
    
    <category term="python" scheme="https://www.xingyulei.com/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>Using namedtuple in Python for Beginners</title>
    <link href="https://www.xingyulei.com/post/py-named-tuple/"/>
    <id>https://www.xingyulei.com/post/py-named-tuple/</id>
    <published>2022-01-23T08:00:00.000Z</published>
    <updated>2023-11-03T03:54:17.897Z</updated>
    
    <content type="html"><![CDATA[<p>I recently got side-tracked into exploring the basics of <code>namedtuple()</code> asI got a glimpse of its usage in our engineering codebase. Here’s my summary:</p><h2 id="mutable-and-hashable"><a class="markdownIt-Anchor" href="#mutable-and-hashable"></a> Mutable and Hashable</h2><p>To understand the behavior of <code>namedtuple()</code>, it is best to also visit theconcept of Python object’s mutability and hashability. These two concepts areclosely linked.</p><p><strong>Hashability</strong>: an object’s is hashable when its hash value never changed during its lifetime</p><blockquote><p>Most of Python’s immutable built-in objects are hashable;mutable containers (such as lists or dictionaries) are not;immutable containers (such as tuples and frozensets)are only hashable if their elements are hashable.<strong>Objects</strong> which are <strong>instances</strong> of user-defined classes are hashable by default</p></blockquote><p><strong>Mutability</strong>: an object with a fixed value and cannot be altered is immutable(For example: <code>int</code>, <code>float</code>, <code>string</code>, <code>tuple</code>).in contrast, an object can keep its value while keeping its <code>id()</code> is mutable.(For example: <code>list</code>, <code>dict</code>)</p><h3 id="hash-and-id"><a class="markdownIt-Anchor" href="#hash-and-id"></a> <code>hash()</code> and <code>id()</code></h3><p><strong>identity</strong>: <code>id()</code>, the identity of the two same value variables are the sameIf two objects (that exist at the same time) have the same identity, they’re actually two references to the same object.</p><blockquote><p>The <code>is</code> operator compares items by identity, <code>a is b</code> is equivalent to <code>id(a) == id(b)</code>.</p></blockquote><p><strong>hash value</strong>: <code>hash()</code>, hash value is based off an object’s value, and hash valuemust remain the same for the lifetime of the object. If an object is mutable,then it doesn’t make sense for it to have hash.</p><blockquote><p>The hash value is an integer which is used to quickly compare dictionary keys or sets.</p></blockquote><h3 id="why-hash"><a class="markdownIt-Anchor" href="#why-hash"></a> Why Hash?</h3><p>Hash values are very useful, as they enable quick look-up of valuesin a large collection of values, it’s commonly used in <code>set</code> and <code>dict</code>.</p><p>with <code>if x in elements:</code>:</p><ul><li><p>In a <code>list</code>, Python needs to go through the whole listand compare <code>x</code>'s value with each value in the list elements.</p></li><li><p>In a <code>set</code>, Python keeps track of each element’s hash,Python will get the hash-value for <code>x</code>,look that up in an internal structure and find elements that have the same hash as <code>x</code>.</p></li></ul><p>It also means we can have non-hashable objects in a <code>list</code>,but not in a <code>set</code> or as <strong>keys</strong> in a <code>dict</code>.</p><p><a name='hash-example'></a></p><h3 id="example"><a class="markdownIt-Anchor" href="#example"></a> Example:</h3><p>There is no way to change an <code>int</code> object’s value without re-assigning (copy) itto a different object.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">x = <span class="number">5</span></span><br><span class="line"><span class="comment"># id(x) is equal to 3054677212104</span></span><br><span class="line">x = <span class="number">6</span></span><br><span class="line"><span class="comment"># id(x) is equal to 3054677212080</span></span><br></pre></td></tr></table></figure><p>But for <code>list</code>, we can edit its value after assignment while keeping its <code>id()</code>the same. (note: use <code>list</code> built-in function rather than re-assignment,this is the same for <code>x.sort</code> vs. <code>x=sorted(x)</code>)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">x = [<span class="number">5</span>]</span><br><span class="line"><span class="comment"># ORIGINAL: id(x) is equal to 3054706521672</span></span><br><span class="line">x.append(<span class="number">6</span>)</span><br><span class="line"><span class="comment"># CORRECT: id(x) is equal to 3054706521672</span></span><br><span class="line">x = [<span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line"><span class="comment"># WRONG: id(x) is equal to 3054713375816</span></span><br></pre></td></tr></table></figure><h2 id="namedtuple"><a class="markdownIt-Anchor" href="#namedtuple"></a> NamedTuple</h2><p>A data class are just regular classes that are geared towards storing state,rather than containing a lot of logic, <code>namedtuple()</code> is one kind of data classes.</p><blockquote><p>Every time we create a class that mostly consists of attributes, we make a data class.</p></blockquote><p>With <code>namedtuple()</code>, we can create <strong>immutable</strong> sequence typesthat allow us to access their values using descriptive field namesand the dot notation instead of unclear integer indices.</p><h3 id="initialization"><a class="markdownIt-Anchor" href="#initialization"></a> Initialization</h3><ol><li><strong>typename</strong>: <code>str</code>, class name of the <code>namedtuple</code></li><li><strong>field names</strong>: names that are used to access values in the <code>namedtuple</code>, it can be declared using any of the following:<ul><li>iterable of strings: [“a”, “b”, “c”]</li><li>a string with name seperated by white spaces: “a b c”</li><li>a string with name separated by commas: “a, b, c”</li></ul></li></ol><p>Example:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"></span><br><span class="line">Point = namedtuple(<span class="string">&quot;Point&quot;</span>, [<span class="string">&quot;x&quot;</span>, <span class="string">&quot;y&quot;</span>])</span><br><span class="line"></span><br><span class="line">&gt;&gt; Point</span><br><span class="line"><span class="comment"># &lt;class &#x27;__main__.Point&#x27;&gt;</span></span><br><span class="line">&gt;&gt; Point(<span class="number">2</span>, <span class="number">4</span>)</span><br><span class="line"><span class="comment"># Point(x=2, y=4)</span></span><br></pre></td></tr></table></figure><h3 id="access-and-edit-value"><a class="markdownIt-Anchor" href="#access-and-edit-value"></a> Access and Edit Value</h3><p>It is very straight-forward to access a tuple’s attribute value using dot notation</p><p>this gives <code>namedtuple</code> a great edge against <code>dict</code> or <code>tuple</code>.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Person = namedtuple(<span class="string">&#x27;Person&#x27;</span>, <span class="string">&#x27;name children&#x27;</span>)</span><br><span class="line">jj = Person(<span class="string">&#x27;Johnny J&#x27;</span>, [<span class="string">&#x27;Tobby&#x27;</span>])</span><br><span class="line"></span><br><span class="line">&gt;&gt; jj.children</span><br><span class="line"><span class="comment"># [&#x27;Tobby&#x27;]</span></span><br></pre></td></tr></table></figure><p>Since <code>namedtuple</code> is immutable, we can’t assign value to its attribute;what we can do is to use <code>._replace()</code>; and also, its value can be mutable, likea <code>list</code>.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; jj.children = [<span class="string">&#x27;Tobby&#x27;</span>, <span class="string">&#x27;Wang&#x27;</span>]</span><br><span class="line"><span class="comment"># AttributeError: can&#x27;t set attribute</span></span><br><span class="line"></span><br><span class="line">&gt;&gt; jj.children.append(<span class="string">&#x27;Wang&#x27;</span>)</span><br><span class="line"><span class="comment"># Correct</span></span><br><span class="line"></span><br><span class="line">&gt;&gt; jj = jj._replace(name=<span class="string">&#x27;John J&#x27;</span>)</span><br><span class="line"><span class="comment"># Correct</span></span><br></pre></td></tr></table></figure><h3 id="using-_asdict"><a class="markdownIt-Anchor" href="#using-_asdict"></a> Using <code>._asdict()</code></h3><p>The built-in function <code>._asdict()</code> converts <code>namedtuple</code> into a dictionary.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Person = namedtuple(<span class="string">&quot;Person&quot;</span>, <span class="string">&quot;name age height&quot;</span>)</span><br><span class="line">jane = Person(<span class="string">&quot;Jane&quot;</span>, <span class="number">25</span>, <span class="number">1.75</span>)</span><br><span class="line"></span><br><span class="line">&gt;&gt; jane._asdict()</span><br><span class="line"><span class="comment"># &#123;&#x27;name&#x27;: &#x27;Jane&#x27;, &#x27;age&#x27;: 25, &#x27;height&#x27;: 1.75&#125;</span></span><br></pre></td></tr></table></figure><p>and to generate a namedtuple object from dictionary</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">d = &#123;</span><br><span class="line">   <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Jane&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;age&#x27;</span>: <span class="number">25</span>,</span><br><span class="line">   <span class="string">&#x27;height&#x27;</span>: <span class="number">1.75</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">jane = Person(**d)</span><br></pre></td></tr></table></figure><h2 id="dataclass"><a class="markdownIt-Anchor" href="#dataclass"></a> <code>@dataclass</code></h2><p><code>@dataclass</code> came out after Python 3.7, which is similar to <code>namedtuple</code>, but they are mutable.thus, we can set value to a <code>@dataclass</code> attribute.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass</span><br><span class="line"></span><br><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    age: <span class="built_in">int</span></span><br><span class="line">    country: <span class="built_in">str</span> = <span class="string">&quot;Canada&quot;</span></span><br><span class="line"></span><br><span class="line">jane = Person(<span class="string">&quot;Jane&quot;</span>, <span class="number">25</span>)</span><br><span class="line"></span><br><span class="line">&gt;&gt; jane.name = <span class="string">&quot;Jane Doe&quot;</span></span><br><span class="line">&gt;&gt; jane.name</span><br><span class="line"><span class="string">&#x27;Jane Doe&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="frozen-attribute"><a class="markdownIt-Anchor" href="#frozen-attribute"></a> frozen attribute</h3><p>if we want <code>@dataclass</code> to behave like <code>namedtuple</code> with an un-editable “protected” attribute,just use <code>@dataclass(frozen=True)</code>.</p><h3 id="override-__iter__"><a class="markdownIt-Anchor" href="#override-__iter__"></a> override <code>__iter__()</code></h3><p><code>@dataclass</code> are also not iterable by default, unlike <code>namedtuple</code>. We can achievethat by implementing the special method <code>.__iter__()</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> dataclasses <span class="keyword">import</span> astuple, dataclass</span><br><span class="line"></span><br><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">   ...</span><br><span class="line">   <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">iter</span>(astuple(self))</span><br></pre></td></tr></table></figure><h2 id="subclassing-namedtuple"><a class="markdownIt-Anchor" href="#subclassing-namedtuple"></a> Subclassing <code>namedtuple</code></h2><p>Subclassing <code>namedtuple</code> gives us additional functionality.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">BasePerson = namedtuple(<span class="string">&quot;BasePerson&quot;</span>, <span class="string">&quot;name birthdate country&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>(<span class="title class_ inherited__">BasePerson</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;A namedtuple subclass to hold a person&#x27;s data.&quot;&quot;&quot;</span></span><br><span class="line">    __slots__ = ()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Name: &#123;&#125;, age: &#123;&#125; years old&quot;</span>.<span class="built_in">format</span>(self.name, self.age)</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">age</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> (date.today() - self.birthdate).days // <span class="number">365</span></span><br></pre></td></tr></table></figure><p>In the above example, subclassing from <code>namedtuple</code> provides us better documentation(i.e. <code>Person.__doc__</code>), better string representation (i.e. <code>print jane</code>) and anextra property to access based off a Person’s instance attribute value.</p><h3 id="__new__-constructor"><a class="markdownIt-Anchor" href="#__new__-constructor"></a> <code>__new__()</code> constructor</h3><p><a href="http://zecong.hu/2019/08/10/inheritance-for-namedtuples/">Zechong Hu’s Blog - Inheritance for Python Namedtuples</a></p><p>To override the constructor for <code>namedtuple</code> class with default value:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">BasePerson = namedtuple(<span class="string">&quot;BasePerson&quot;</span>, [<span class="string">&quot;name&quot;</span>, <span class="string">&quot;birthdate&quot;</span> ,<span class="string">&quot;country&quot;</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>(<span class="title class_ inherited__">BasePerson</span>):</span><br><span class="line">    __slots__ = ()</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__new__</span>(<span class="params">cls, name, birthdate=<span class="string">&quot;2000.01.01&quot;</span>, country=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>(Person, cls).__new__(cls, name, birthdate, country)</span><br></pre></td></tr></table></figure><h3 id="__slots__"><a class="markdownIt-Anchor" href="#__slots__"></a> <code>__slots__</code></h3><p>The special attribute <code>__slots__</code> explicitly state what attribute we wantour class instances to have.</p><p>By default, when an instance (object) is created,<code>__dict__</code> is used to store an object’s (writable) attributes.A <strong>dynamic</strong> dictionary:</p><ol><li>requires more memory</li><li>takes longer time to create.</li></ol><p>Because <code>namedtuple</code> makes immutable instances that are lightweight,we need to prevent the creation of <code>__dict__</code> to get the benefit while subclassingby setting <code>__slots__</code> as empty tuple.</p><p>In a more general note, please consider using <code>__slots__</code> when creatingtons of objects, this saves memory and time when instancing.</p><h4 id="comparison-__dict__-vs-__slots__"><a class="markdownIt-Anchor" href="#comparison-__dict__-vs-__slots__"></a> Comparison <code>__dict__</code> vs. <code>__slots__</code></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">   <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">      self.name = name</span><br><span class="line">      self.age = age</span><br><span class="line"></span><br><span class="line">john = Person(<span class="string">&#x27;john&#x27;</span>, <span class="number">15</span>)</span><br><span class="line"></span><br><span class="line">&gt;&gt; john.__dict__</span><br><span class="line"><span class="comment"># &#123;&#x27;age&#x27;: 15, &#x27;name&#x27;: &#x27;john&#x27;&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    __slots__ = [<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;age&#x27;</span>]</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line">john = Person(<span class="string">&#x27;john&#x27;</span>, <span class="number">15</span>)</span><br><span class="line"></span><br><span class="line">&gt;&gt; john.__slots__</span><br><span class="line"><span class="comment"># [&#x27;name&#x27;, &#x27;age&#x27;]</span></span><br><span class="line">&gt;&gt; john.__dict__</span><br><span class="line"><span class="comment"># AttributeError: &#x27;Person&#x27; object has no attribute &#x27;__dict__&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="reference"><a class="markdownIt-Anchor" href="#reference"></a> Reference</h2><p><a href="https://docs.python.org/3/glossary.html">Python Docs - Glossary</a></p><p><a href="https://medium.com/@meghamohan/mutable-and-immutable-side-of-python-c2145cf72747">Medium megha mohan - Mutable vs Immutable Objects in Python</a></p><p><a href="https://realpython.com/python-namedtuple/">Real Python - namedtuple</a></p><p><a href="https://stackoverflow.com/questions/47955263/">Stack Overflow - What are data classes and how are they different from common classes?</a></p><p><a href="https://www.geeksforgeeks.org/python-use-of-__slots__/">Geeks for Geesk - Use of __slots__</a></p><p><a href="https://stackoverflow.com/questions/472000/">Stack Overflow - Usage of __slots__?</a></p><p><a href="https://stackoverflow.com/questions/34402522">Stack Overflow - Difference between hash() and id()</a></p><p><a href="https://stackoverflow.com/questions/38189660/">Stack Overflow - Two variables in Python have same id, but not lists or tuples</a></p><p><a href="https://stackoverflow.com/questions/17585730">Stack Overflow - What does hash do in python?</a></p>]]></content>
    
    
    <summary type="html">Learn how to use namedtuple in Python with our step-by-step guide designed for beginners. Our tutorial provides practical examples and best practices for creating lightweight and memory-efficient data structures in Python. Whether you&#39;re new to programming or an experienced developer, our tutorial will help you master the techniques needed to take advantage of Python&#39;s powerful features and simplify your code.</summary>
    
    
    
    <category term="learning log" scheme="https://www.xingyulei.com/categories/learning-log/"/>
    
    
    <category term="python" scheme="https://www.xingyulei.com/tags/python/"/>
    
    <category term="style" scheme="https://www.xingyulei.com/tags/style/"/>
    
  </entry>
  
  <entry>
    <title>Maya Socket Communication Workflow (2. Streaming Output)</title>
    <link href="https://www.xingyulei.com/post/maya-streaming/"/>
    <id>https://www.xingyulei.com/post/maya-streaming/</id>
    <published>2022-01-09T08:00:00.000Z</published>
    <updated>2023-11-03T03:49:33.090Z</updated>
    
    <content type="html"><![CDATA[<h3 id="maya-connector"><a class="markdownIt-Anchor" href="#maya-connector"></a> Maya Connector</h3><p>I’ve combined the two parts together and created the end result: <a href="https://github.com/leixingyu/mayaConnector">Maya Connector</a> tool.</p><p>The tool will utilize command port to send open streaming command,which establishes the connection and enables the callback.The output is being sent back to the tool and the output is updated in the GUI.</p><p><img src="https://i.imgur.com/89SJibG.gif" alt="maya-connector" /></p><h3 id="introduction"><a class="markdownIt-Anchor" href="#introduction"></a> Introduction</h3><blockquote><p>Make sure to see <a href="https://www.xingyulei.com/post/maya-commandport/">Part 1</a> for more context in socket programming and maya command port</p></blockquote><p>Like mentioned in the previous blog, this chapter is independent for enablingoutput streaming, but would work even better with command port to send command and get activeresponse from Maya.</p><p>This kind of log streaming feature can be helpful not only for monitoringbut for catching errors like when Maya crashes, or to connect with an IDE similar toPyCharm’s plugin <a href="https://github.com/cmcpasserby/MayaCharm">MayaCharm</a> and Sublime’s plugin<a href="https://github.com/justinfx/MayaSublime/">MayaSublime</a></p><h3 id="listening-server-separation"><a class="markdownIt-Anchor" href="#listening-server-separation"></a> Listening Server Separation</h3><p>I’ve been looking at Maya’s command port to see if the return message would besufficient for debugging log, as command port already is a server.</p><p>But it turns out that this approach is not recommended by many, as there’s littlecontrol on the return message as the TCP communication returns one message percommand, more explained in the previous blog.</p><p>The correct way suggested, and widely used is to stream Maya script output backto the external application.</p><p><img src="https://i.imgur.com/MtvlyMe.png" alt="connection graph" /></p><p>As shown in the graph, two separate communications are established instead of utilizingjust the command port.</p><ol><li>external application (client) send command to Maya’s command port (server) where Mayawould process normally. This is achieved through TCP to ensure no loss in sending command.</li><li>Maya’s <code>MCommandMessage</code> callback triggers (client) send the latest output result to external application’s listeningport (server). This is achieved through UDP to keep the connection fast and easy, but mayresult in lost in feedbacks (which isn’t that important)</li></ol><h3 id="procedures"><a class="markdownIt-Anchor" href="#procedures"></a> Procedures</h3><p>to establish listening server, need to use a different port number than the command port numberif we are also connecting to it.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SERVER = <span class="string">&#x27;127.0.0.1&#x27;</span></span><br><span class="line">PORT = <span class="number">5051</span></span><br><span class="line">ADDR = (SERVER, PORT)</span><br><span class="line"></span><br><span class="line">server = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br><span class="line">server.bind(ADDR)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    data = server.recvfrom(<span class="number">1024</span>)</span><br><span class="line">    message = data[<span class="number">0</span>]</span><br><span class="line">    address = data[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(message)</span><br></pre></td></tr></table></figure><p>On the maya client side, there are two parts:</p><ol><li>setup <code>MCommendMessage</code> callback</li><li>stream the data to the listening server</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> maya.OpenMaya <span class="keyword">as</span> om</span><br><span class="line"></span><br><span class="line">SERVER = <span class="string">&#x27;127.0.0.1&#x27;</span></span><br><span class="line">PORT = <span class="number">5051</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;STREAM_CALLBACK&#x27;</span> <span class="keyword">in</span> <span class="built_in">globals</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        om.MMessage.removeCallback(STREAM_CALLBACK)</span><br><span class="line">    <span class="keyword">except</span> RuntimeError:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">STREAM_CALLBACK = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">openStream</span>(<span class="params">addr=(<span class="params">SERVER, PORT</span>)</span>):</span><br><span class="line">    <span class="keyword">global</span> STREAM_CALLBACK</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Enable Streaming ScriptEditor at (&#123;&#125;:&#123;&#125;)\n&quot;</span>.<span class="built_in">format</span>(addr[<span class="number">0</span>], addr[<span class="number">1</span>]))</span><br><span class="line">    STREAM_CALLBACK = om.MCommandMessage.addCommandOutputCallback(streamToConsole, addr)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">closeStream</span>():</span><br><span class="line">    <span class="keyword">global</span> STREAM_CALLBACK</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Disable Streaming ScriptEditor\n&quot;</span>)</span><br><span class="line">    om.MMessage.removeCallback(STREAM_CALLBACK)</span><br><span class="line">    STREAM_CALLBACK = <span class="literal">None</span></span><br></pre></td></tr></table></figure><p>borrowed some code from <a href="">MayaSublime</a> for stringIO</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">streamToConsole</span>(<span class="params">msg, mtype, addr</span>):</span><br><span class="line">    buf = StringIO()</span><br><span class="line">    buf.seek(<span class="number">0</span>)</span><br><span class="line">    buf.truncate()</span><br><span class="line">    buf.write(msg)</span><br><span class="line">    buf.seek(<span class="number">0</span>)</span><br><span class="line">    <span class="comment"># start with trying to send 8kb packets</span></span><br><span class="line">    bufsize = <span class="number">8</span>*<span class="number">1024</span></span><br><span class="line">    <span class="comment"># loop until the buffer is empty</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">while</span> bufsize &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="comment"># save our position in case we error and need to roll back</span></span><br><span class="line">            pos = buf.tell()</span><br><span class="line"></span><br><span class="line">            part = buf.read(bufsize)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> part:</span><br><span class="line">                <span class="comment"># buffer is empty. Nothing else to send</span></span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                client.sendto(part, addr)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="keyword">if</span> e.errno == errno.EMSGSIZE:</span><br><span class="line">                    <span class="comment"># we have hit a message size limit. </span></span><br><span class="line">                    <span class="comment"># scale down and try the packet again</span></span><br><span class="line">                    bufsize /= <span class="number">2</span></span><br><span class="line">                    buf.seek(pos)</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="comment"># some other error</span></span><br><span class="line">                <span class="keyword">raise</span></span><br><span class="line">            <span class="comment"># message sent without error</span></span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h4 id="message-type"><a class="markdownIt-Anchor" href="#message-type"></a> Message Type</h4><p>Command message type support:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> mtype == om.MCommandMessage.kWarning:</span><br><span class="line">    buf.write(<span class="string">&#x27;# Warning: &#x27;</span>)</span><br><span class="line">    buf.write(msg)</span><br><span class="line">    buf.write(<span class="string">&#x27; #\n&#x27;</span>)</span><br><span class="line"><span class="keyword">elif</span> mtype == om.MCommandMessage.kError:</span><br><span class="line">    buf.write(<span class="string">&#x27;// Error: &#x27;</span>)</span><br><span class="line">    buf.write(msg)</span><br><span class="line">    buf.write(<span class="string">&#x27; //\n&#x27;</span>)</span><br><span class="line"><span class="keyword">elif</span> mtype == om.MCommandMessage.kResult:</span><br><span class="line">    buf.write(<span class="string">&#x27;# Result: &#x27;</span>)</span><br><span class="line">    buf.write(msg)</span><br><span class="line">    buf.write(<span class="string">&#x27; #\n&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    buf.write(msg)</span><br></pre></td></tr></table></figure><h4 id="logging-gui"><a class="markdownIt-Anchor" href="#logging-gui"></a> Logging GUI</h4><p>Like a logger, instead of sending output string to standard output, I createda <code>QPlainTextEdit</code> and use <code>insertPlainText(string)</code> to display it.We opened a thread to receive data, so that we still have control over the main tool, andcan send command to maya if wanted.</p><p><strong>Note</strong>: we shouldn’t update the GUI in the listening thread, instead we emita custom signal and pass the return message as argument,we then create a custom slot to handle GUI update.</p><p>so instead of doing:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    data = server.recvfrom(<span class="number">1024</span>)</span><br><span class="line">    message = data[<span class="number">0</span>]</span><br><span class="line">    self.ui_text_edit.insertPlainText(message)</span><br></pre></td></tr></table></figure><p>we should be doing:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    data = server.recvfrom(<span class="number">1024</span>)</span><br><span class="line">    message = data[<span class="number">0</span>]</span><br><span class="line">    self.message_received.emit(message)</span><br></pre></td></tr></table></figure><h4 id="clean-up"><a class="markdownIt-Anchor" href="#clean-up"></a> Clean up</h4><p>During application close, we need to do the following clean up:</p><ol><li>send command to Maya to remove the callback</li><li>close the tool’s UDP listening server</li><li>end the thread to the listening server</li></ol><h3 id="references"><a class="markdownIt-Anchor" href="#references"></a> References</h3><p><a href="https://help.autodesk.com/view/MAYAUL/2016/ENU/?guid=__py_ref_class_open_maya_1_1_m_command_message_html">Maya Help - OpenMaya.MCommandMessage Class Reference</a></p><p><a href="https://groups.google.com/g/python_inside_maya/c/pp_E7rCs7d0">Google Groups - Extracting data from Output Window</a></p><p><a href="https://github.com/cmcpasserby/MayaCharm">Github - MayaCharm</a></p><p><a href="https://github.com/justinfx/MayaSublime/">Github - MayaSublime</a></p>]]></content>
    
    
    <summary type="html">Optimize your Maya workflow with our comprehensive tutorial on console callback and socket communication. Our step-by-step guide provides practical examples and best practices to help you streamline your production pipeline and increase productivity. Whether you&#39;re a beginner or an advanced user, our tutorial will help you master the techniques needed to improve your Maya skills</summary>
    
    
    
    <category term="maya communication" scheme="https://www.xingyulei.com/categories/maya-communication/"/>
    
    
    <category term="maya" scheme="https://www.xingyulei.com/tags/maya/"/>
    
    <category term="python" scheme="https://www.xingyulei.com/tags/python/"/>
    
    <category term="socket" scheme="https://www.xingyulei.com/tags/socket/"/>
    
    <category term="threading" scheme="https://www.xingyulei.com/tags/threading/"/>
    
  </entry>
  
</feed>
